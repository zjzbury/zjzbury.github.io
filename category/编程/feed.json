{
    "version": "https://jsonfeed.org/version/1",
    "title": "JAVA • All posts by \"编程\" category",
    "description": "爱编程，爱生活",
    "home_page_url": "http://www.startanew.cn",
    "items": [
        {
            "id": "http://www.startanew.cn/2020/12/30/JavaScript%E5%A4%8D%E5%88%B6%E6%96%87%E6%9C%AC/",
            "url": "http://www.startanew.cn/2020/12/30/JavaScript%E5%A4%8D%E5%88%B6%E6%96%87%E6%9C%AC/",
            "title": "JavaScript复制文本",
            "date_published": "2020-12-30T06:14:46.000Z",
            "content_html": "<h3 id=\"javascript代码\"><a class=\"markdownIt-Anchor\" href=\"#javascript代码\">#</a> JavaScript 代码</h3>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">copy</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> input = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">&#x27;input&#x27;</span>);</span><br><span class=\"line\">    input.setAttribute(<span class=\"string\">&#x27;readonly&#x27;</span>, <span class=\"string\">&#x27;readonly&#x27;</span>); <span class=\"comment\">// 防止手机上弹出软键盘</span></span><br><span class=\"line\">    input.setAttribute(<span class=\"string\">&#x27;value&#x27;</span>,  $(<span class=\"string\">&quot;#id&quot;</span>).text()); <span class=\"comment\">//赋值</span></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(input);</span><br><span class=\"line\">    input.select();<span class=\"comment\">//选中</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> res = <span class=\"built_in\">document</span>.execCommand(<span class=\"string\">&#x27;copy&#x27;</span>);  <span class=\"comment\">//拷贝</span></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.removeChild(input);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (res)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;复制成功&quot;</span>);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;复制失败&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "javascript"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/12/30/%E9%9A%8F%E6%9C%BA%E7%94%9F%E6%88%90%E5%AF%86%E7%A0%81/",
            "url": "http://www.startanew.cn/2020/12/30/%E9%9A%8F%E6%9C%BA%E7%94%9F%E6%88%90%E5%AF%86%E7%A0%81/",
            "title": "随机生成密码",
            "date_published": "2020-12-30T05:10:37.000Z",
            "content_html": "<h3 id=\"java代码\"><a class=\"markdownIt-Anchor\" href=\"#java代码\">#</a> java 代码</h3>\n<p><span class=\"rainbow\">工具类</span></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RandomStringUtils</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">char</span>[] codeSequence = <span class=\"keyword\">new</span> <span class=\"keyword\">char</span>[]&#123;<span class=\"string\">&#x27;1&#x27;</span>, <span class=\"string\">&#x27;2&#x27;</span>, <span class=\"string\">&#x27;3&#x27;</span>, <span class=\"string\">&#x27;4&#x27;</span>, <span class=\"string\">&#x27;5&#x27;</span>, <span class=\"string\">&#x27;6&#x27;</span>, <span class=\"string\">&#x27;7&#x27;</span>, <span class=\"string\">&#x27;8&#x27;</span>, <span class=\"string\">&#x27;9&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;A&#x27;</span>, <span class=\"string\">&#x27;B&#x27;</span>, <span class=\"string\">&#x27;C&#x27;</span>, <span class=\"string\">&#x27;D&#x27;</span>, <span class=\"string\">&#x27;E&#x27;</span>, <span class=\"string\">&#x27;F&#x27;</span>, <span class=\"string\">&#x27;G&#x27;</span>, <span class=\"string\">&#x27;H&#x27;</span>, <span class=\"string\">&#x27;I&#x27;</span>, <span class=\"string\">&#x27;J&#x27;</span>, <span class=\"string\">&#x27;K&#x27;</span>, <span class=\"string\">&#x27;L&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;N&#x27;</span>, <span class=\"string\">&#x27;P&#x27;</span>, <span class=\"string\">&#x27;Q&#x27;</span>, <span class=\"string\">&#x27;R&#x27;</span>, <span class=\"string\">&#x27;S&#x27;</span>, <span class=\"string\">&#x27;T&#x27;</span>, <span class=\"string\">&#x27;U&#x27;</span>, <span class=\"string\">&#x27;V&#x27;</span>, <span class=\"string\">&#x27;W&#x27;</span>, <span class=\"string\">&#x27;X&#x27;</span>, <span class=\"string\">&#x27;Y&#x27;</span>, <span class=\"string\">&#x27;Z&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;c&#x27;</span>, <span class=\"string\">&#x27;d&#x27;</span>, <span class=\"string\">&#x27;e&#x27;</span>, <span class=\"string\">&#x27;f&#x27;</span>, <span class=\"string\">&#x27;g&#x27;</span>, <span class=\"string\">&#x27;h&#x27;</span>, <span class=\"string\">&#x27;i&#x27;</span>, <span class=\"string\">&#x27;j&#x27;</span>, <span class=\"string\">&#x27;k&#x27;</span>, <span class=\"string\">&#x27;l&#x27;</span>, <span class=\"string\">&#x27;m&#x27;</span>, <span class=\"string\">&#x27;n&#x27;</span>, <span class=\"string\">&#x27;p&#x27;</span>, <span class=\"string\">&#x27;q&#x27;</span>, <span class=\"string\">&#x27;r&#x27;</span>, <span class=\"string\">&#x27;s&#x27;</span>, <span class=\"string\">&#x27;t&#x27;</span>, <span class=\"string\">&#x27;u&#x27;</span>, <span class=\"string\">&#x27;v&#x27;</span>, <span class=\"string\">&#x27;w&#x27;</span>, <span class=\"string\">&#x27;x&#x27;</span>, <span class=\"string\">&#x27;y&#x27;</span>, <span class=\"string\">&#x27;z&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;.&#x27;</span>,<span class=\"string\">&#x27;$&#x27;</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取随机密码</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> digits 位数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span>  String <span class=\"title\">getCode</span><span class=\"params\">(<span class=\"keyword\">int</span>  digits)</span> </span>&#123;</span><br><span class=\"line\">        Random random = <span class=\"keyword\">new</span> Random();</span><br><span class=\"line\">        StringBuilder randomCode = <span class=\"keyword\">new</span> StringBuilder();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; digits; i++) &#123;</span><br><span class=\"line\">            randomCode.append(String.valueOf(codeSequence[random.nextInt(codeSequence.length)]));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> randomCode.toString();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>",
            "tags": [
                "springboot",
                "javaweb"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/11/12/XMLHttpRequest%20%E5%BC%82%E6%AD%A5%E4%B8%8B%E8%BD%BD/",
            "url": "http://www.startanew.cn/2020/11/12/XMLHttpRequest%20%E5%BC%82%E6%AD%A5%E4%B8%8B%E8%BD%BD/",
            "title": "XMLHttpRequest 异步下载",
            "date_published": "2020-11-12T12:41:00.000Z",
            "content_html": "<h3 id=\"原文链接-httpswwwjianshucomp1e189c14aa98\"><a class=\"markdownIt-Anchor\" href=\"#原文链接-httpswwwjianshucomp1e189c14aa98\">#</a> 原文链接 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC8xZTE4OWMxNGFhOTg=\">https://www.jianshu.com/p/1e189c14aa98</span></h3>\n<h5 id=\"网络请求\"><a class=\"markdownIt-Anchor\" href=\"#网络请求\">#</a> 网络请求</h5>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">get</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> url = <span class=\"string\">&quot;请求地址&quot;</span>;</span><br><span class=\"line\">    xhr.open(<span class=\"string\">&quot;POST&quot;</span>, url);</span><br><span class=\"line\">    xhr.setRequestHeader(<span class=\"string\">&quot;Content-Type&quot;</span>, <span class=\"string\">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class=\"line\">    xhr.responseType = <span class=\"string\">&quot;blob&quot;</span>;</span><br><span class=\"line\">    xhr.addEventListener(<span class=\"string\">&quot;loadstart&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">ev</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 开始下载事件：下载进度条的显示</span></span><br><span class=\"line\">        $(<span class=\"string\">&quot;#progress-dialog&quot;</span>).modal(<span class=\"string\">&#x27;show&#x27;</span>)</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    xhr.addEventListener(<span class=\"string\">&quot;load&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">ev</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 下载完成事件：处理下载文件</span></span><br><span class=\"line\">        processRequest(xhr);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    xhr.addEventListener(<span class=\"string\">&quot;progress&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ev</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 下载中事件：计算下载进度</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> max   = ev.total;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> value = ev.loaded;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> width = value/max*<span class=\"number\">100</span>;</span><br><span class=\"line\">       </span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">     xhr.addEventListener(<span class=\"string\">&quot;loadend&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ev</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 结束下载事件：下载进度条的关闭</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    xhr.addEventListener(<span class=\"string\">&quot;error&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ev</span>) </span>&#123;</span><br><span class=\"line\">      </span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    xhr.addEventListener(<span class=\"string\">&quot;abort&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ev</span>) </span>&#123;</span><br><span class=\"line\">     </span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    xhr.send(<span class=\"built_in\">JSON</span>.stringify(&#123;</span><br><span class=\"line\">       <span class=\"comment\">//参数</span></span><br><span class=\"line\">    &#125;));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h5 id=\"下载文件\"><a class=\"markdownIt-Anchor\" href=\"#下载文件\">#</a> 下载文件</h5>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">processRequest</span>(<span class=\"params\">xhr</span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(xhr)</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (xhr.status == <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> response = xhr.response;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> contentType = xhr.getResponseHeader(<span class=\"string\">&quot;Content-Type&quot;</span>);</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(contentType.split(<span class=\"string\">&quot;;&quot;</span>)[<span class=\"number\">0</span>] == <span class=\"string\">&quot;application/json&quot;</span>)&#123;</span><br><span class=\"line\">              <span class=\"keyword\">var</span> reader = <span class=\"keyword\">new</span> FileReader();</span><br><span class=\"line\">              reader.readAsText(response);</span><br><span class=\"line\">              reader.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">oFREvent</span>) </span>&#123;</span><br><span class=\"line\">                  <span class=\"comment\">// 后端返回的json数据</span></span><br><span class=\"line\">              &#125;;</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (contentType.split(<span class=\"string\">&quot;;&quot;</span>)[<span class=\"number\">0</span>] == <span class=\"string\">&quot;application/octet-stream&quot;</span>)&#123;</span><br><span class=\"line\">              <span class=\"keyword\">var</span> fileName =  xhr.getResponseHeader(<span class=\"string\">&quot;content-disposition&quot;</span>).split(<span class=\"string\">&quot;=&quot;</span>)[<span class=\"number\">1</span>];</span><br><span class=\"line\">              saveFile(response, <span class=\"built_in\">decodeURI</span>(fileName))</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> response = xhr.response;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> contentType = xhr.getResponseHeader(<span class=\"string\">&quot;Content-Type&quot;</span>)</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(contentType.split(<span class=\"string\">&quot;;&quot;</span>)[<span class=\"number\">0</span>] == <span class=\"string\">&quot;application/json&quot;</span>)&#123;</span><br><span class=\"line\">              <span class=\"keyword\">var</span> reader = <span class=\"keyword\">new</span> FileReader();</span><br><span class=\"line\">              reader.readAsText(response);</span><br><span class=\"line\">              reader.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">oFREvent</span>) </span>&#123;</span><br><span class=\"line\">                  <span class=\"comment\">//请求异常</span></span><br><span class=\"line\">              &#125;;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h5 id=\"保存文件\"><a class=\"markdownIt-Anchor\" href=\"#保存文件\">#</a> 保存文件</h5>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">saveFile</span>(<span class=\"params\">blob, fileName</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> b = getBrowser();</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (b == <span class=\"string\">&quot;Chrome&quot;</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> link = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">&#x27;a&#x27;</span>);</span><br><span class=\"line\">          <span class=\"keyword\">var</span> file = <span class=\"keyword\">new</span> Blob([blob], &#123;<span class=\"attr\">type</span>: <span class=\"string\">&#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;</span>&#125;);</span><br><span class=\"line\">          link.href = <span class=\"built_in\">window</span>.URL.createObjectURL(file);</span><br><span class=\"line\">          link.download = fileName;</span><br><span class=\"line\">          link.click();</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (b == <span class=\"string\">&quot;Firefox&quot;</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> file = <span class=\"keyword\">new</span> File([blob], fileName, &#123;<span class=\"attr\">type</span>: <span class=\"string\">&#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;</span>&#125;);</span><br><span class=\"line\">          <span class=\"keyword\">var</span> url = URL.createObjectURL(file);</span><br><span class=\"line\">          <span class=\"comment\">//window.location.href = url;</span></span><br><span class=\"line\">          parent.location.href = url;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (b == <span class=\"string\">&quot;IE&quot;</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> file = <span class=\"keyword\">new</span> Blob([blob], &#123;<span class=\"attr\">type</span>: <span class=\"string\">&#x27;application/force-download&#x27;</span>&#125;);</span><br><span class=\"line\">          <span class=\"built_in\">window</span>.navigator.msSaveBlob(file, fileName);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h5 id=\"判断浏览器\"><a class=\"markdownIt-Anchor\" href=\"#判断浏览器\">#</a> 判断浏览器</h5>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getBrowser</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> ua = <span class=\"built_in\">window</span>.navigator.userAgent;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> isIE = !!<span class=\"built_in\">window</span>.ActiveXObject || <span class=\"string\">&quot;ActiveXObject&quot;</span> <span class=\"keyword\">in</span> <span class=\"built_in\">window</span>;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> isFirefox = ua.indexOf(<span class=\"string\">&quot;Firefox&quot;</span>) != -<span class=\"number\">1</span>;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> isOpera = <span class=\"built_in\">window</span>.opr != <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> isChrome = ua.indexOf(<span class=\"string\">&quot;Chrome&quot;</span>) &amp;&amp; <span class=\"built_in\">window</span>.chrome;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> isSafari = ua.indexOf(<span class=\"string\">&quot;Safari&quot;</span>) != -<span class=\"number\">1</span> &amp;&amp; ua.indexOf(<span class=\"string\">&quot;Version&quot;</span>) != -<span class=\"number\">1</span>;</span><br><span class=\"line\">       <span class=\"keyword\">if</span> (isIE) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> <span class=\"string\">&quot;IE&quot;</span>;</span><br><span class=\"line\">       &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (isFirefox) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> <span class=\"string\">&quot;Firefox&quot;</span>;</span><br><span class=\"line\">       &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (isOpera) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> <span class=\"string\">&quot;Opera&quot;</span>;</span><br><span class=\"line\">       &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (isChrome) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> <span class=\"string\">&quot;Chrome&quot;</span>;</span><br><span class=\"line\">       &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (isSafari) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> <span class=\"string\">&quot;Safari&quot;</span>;</span><br><span class=\"line\">       &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> <span class=\"string\">&quot;Unkown&quot;</span>;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "js"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/11/12/Excel%E5%AF%BC%E5%87%BA/",
            "url": "http://www.startanew.cn/2020/11/12/Excel%E5%AF%BC%E5%87%BA/",
            "title": "Excel导出",
            "date_published": "2020-11-12T07:16:08.000Z",
            "content_html": "<h3 id=\"后端代码\"><a class=\"markdownIt-Anchor\" href=\"#后端代码\">#</a> 后端代码</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Excel 生成代码 </span></span><br><span class=\"line\"><span class=\"comment\">//   -------------------------------</span></span><br><span class=\"line\"><span class=\"comment\">// 发送到前端</span></span><br><span class=\"line\">ByteArrayOutputStream os = <span class=\"keyword\">new</span> ByteArrayOutputStream();</span><br><span class=\"line\">       ServletOutputStream sout = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">       BufferedInputStream bis = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">       BufferedOutputStream bos = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">       InputStream is = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">       <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">           wb.write(os);</span><br><span class=\"line\">           <span class=\"keyword\">byte</span>[] content = os.toByteArray();</span><br><span class=\"line\">           is = <span class=\"keyword\">new</span> ByteArrayInputStream(content);</span><br><span class=\"line\">           <span class=\"comment\">// 设置response参数，可以打开下载页面</span></span><br><span class=\"line\">           response.reset();</span><br><span class=\"line\">           response.setContentType(<span class=\"string\">&quot;application/octet-stream;charset=UTF-8&quot;</span>);</span><br><span class=\"line\">           response.setHeader(<span class=\"string\">&quot;Content-Disposition&quot;</span>, <span class=\"string\">&quot;attachment;filename=&quot;</span> + URLEncoder.encode(excelName, <span class=\"string\">&quot;utf-8&quot;</span>));</span><br><span class=\"line\">           response.setHeader(<span class=\"string\">&quot;Content-Length&quot;</span>, String.valueOf(is.available()));</span><br><span class=\"line\">           response.setCharacterEncoding(<span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">           sout = response.getOutputStream();</span><br><span class=\"line\">           bis = <span class=\"keyword\">new</span> BufferedInputStream(is);</span><br><span class=\"line\">           bos = <span class=\"keyword\">new</span> BufferedOutputStream(sout);</span><br><span class=\"line\">           <span class=\"keyword\">byte</span>[] buff = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[<span class=\"number\">2048</span>];</span><br><span class=\"line\">           <span class=\"keyword\">int</span> bytesRead;</span><br><span class=\"line\">           <span class=\"keyword\">while</span> (-<span class=\"number\">1</span> != (bytesRead = bis.read(buff, <span class=\"number\">0</span>, buff.length))) &#123;</span><br><span class=\"line\">               bos.write(buff, <span class=\"number\">0</span>, bytesRead);</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">       &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">           <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (bis != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                   bis.close();</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (bos != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                   bos.close();</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (os != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                   os.close();</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (is != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                   is.close();</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (sout != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                   sout.close();</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">           &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"前端下载\"><a class=\"markdownIt-Anchor\" href=\"#前端下载\">#</a> 前端下载</h3>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">window</span>.location.href=<span class=\"string\">&quot;下载地址&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>",
            "tags": [
                "springboot",
                "javaweb"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/10/24/Log4j2%E5%85%A5%E9%97%A8/",
            "url": "http://www.startanew.cn/2020/10/24/Log4j2%E5%85%A5%E9%97%A8/",
            "title": "Log4j2入门",
            "date_published": "2020-10-24T14:34:58.000Z",
            "content_html": "<h3 id=\"添加依赖\"><a class=\"markdownIt-Anchor\" href=\"#添加依赖\">#</a> 添加依赖</h3>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- Log4j2 门面API--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.11.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- Log4j2 日志实现 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.11.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"java代码\"><a class=\"markdownIt-Anchor\" href=\"#java代码\">#</a> JAVA 代码</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Log4j2Test</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger LOGGER = LogManager.getLogger(Log4j2Test.class);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testQuick</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">                LOGGER.fatal(<span class=\"string\">&quot;fatal&quot;</span>);</span><br><span class=\"line\">                LOGGER.error(<span class=\"string\">&quot;error&quot;</span>);</span><br><span class=\"line\">                LOGGER.warn(<span class=\"string\">&quot;warn&quot;</span>);</span><br><span class=\"line\">                LOGGER.info(<span class=\"string\">&quot;info&quot;</span>);</span><br><span class=\"line\">                LOGGER.debug(<span class=\"string\">&quot;debug&quot;</span>);</span><br><span class=\"line\">                LOGGER.trace(<span class=\"string\">&quot;trace&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"使用slf4j作为日志的门面使用log4j2作为日志的实现\"><a class=\"markdownIt-Anchor\" href=\"#使用slf4j作为日志的门面使用log4j2作为日志的实现\">#</a> 使用 slf4j 作为日志的门面，使用 log4j2 作为日志的实现</h3>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- Log4j2 门面API--&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.apache.logging.log4j&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;log4j-api&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;2.11.1&lt;&#x2F;version&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br><span class=\"line\">&lt;!-- Log4j2 日志实现 --&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.apache.logging.log4j&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;log4j-core&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;2.11.1&lt;&#x2F;version&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br><span class=\"line\">&lt;!--使用slf4j作为日志的门面,使用log4j2来记录日志 --&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.slf4j&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;slf4j-api&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;1.7.25&lt;&#x2F;version&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br><span class=\"line\">&lt;!--为slf4j绑定日志实现 log4j2的适配器 --&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.apache.logging.log4j&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;log4j-slf4j-impl&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;2.10.0&lt;&#x2F;version&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"log4j2配置\"><a class=\"markdownIt-Anchor\" href=\"#log4j2配置\">#</a> Log4j2 配置</h3>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class=\"line\">&lt;!--</span><br><span class=\"line\">    status&#x3D;&quot;warn&quot; 日志框架本身的输出日志级别</span><br><span class=\"line\">    monitorInterval&#x3D;&quot;5&quot; 自动加载配置文件的间隔时间，不低于 5 秒</span><br><span class=\"line\">--&gt;</span><br><span class=\"line\">&lt;Configuration status&#x3D;&quot;debug&quot; monitorInterval&#x3D;&quot;5&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!--</span><br><span class=\"line\">        集中配置属性进行管理</span><br><span class=\"line\">        使用时通过:$&#123;name&#125;</span><br><span class=\"line\">    --&gt;</span><br><span class=\"line\">    &lt;properties&gt;</span><br><span class=\"line\">        &lt;property name&#x3D;&quot;LOG_HOME&quot;&gt;&#x2F;logs&lt;&#x2F;property&gt;</span><br><span class=\"line\">    &lt;&#x2F;properties&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!--日志处理--&gt;</span><br><span class=\"line\">    &lt;Appenders&gt;</span><br><span class=\"line\">        &lt;!--控制台输出 appender--&gt;</span><br><span class=\"line\">        &lt;Console name&#x3D;&quot;Console&quot; target&#x3D;&quot;SYSTEM_ERR&quot;&gt;</span><br><span class=\"line\">            &lt;PatternLayout pattern&#x3D;&quot;%d&#123;HH:mm:ss.SSS&#125; [%t] [%-5level] %c&#123;36&#125;:%L --- %m%n&quot; &#x2F;&gt;</span><br><span class=\"line\">        &lt;&#x2F;Console&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!--日志文件输出 appender--&gt;</span><br><span class=\"line\">        &lt;File name&#x3D;&quot;file&quot; fileName&#x3D;&quot;$&#123;LOG_HOME&#125;&#x2F;myfile.log&quot;&gt;</span><br><span class=\"line\">            &lt;PatternLayout pattern&#x3D;&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l %c&#123;36&#125; - %m%n&quot; &#x2F;&gt;</span><br><span class=\"line\">        &lt;&#x2F;File&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!--&lt;Async name&#x3D;&quot;Async&quot;&gt;--&gt;</span><br><span class=\"line\">            &lt;!--&lt;AppenderRef ref&#x3D;&quot;file&quot;&#x2F;&gt;--&gt;</span><br><span class=\"line\">        &lt;!--&lt;&#x2F;Async&gt;--&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!--使用随机读写刘的日志文件输出 appender，性能提高--&gt;</span><br><span class=\"line\">        &lt;RandomAccessFile name&#x3D;&quot;accessFile&quot; fileName&#x3D;&quot;$&#123;LOG_HOME&#125;&#x2F;myAcclog.log&quot;&gt;</span><br><span class=\"line\">            &lt;PatternLayout pattern&#x3D;&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l %c&#123;36&#125; - %m%n&quot; &#x2F;&gt;</span><br><span class=\"line\">        &lt;&#x2F;RandomAccessFile&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!--按照一定规则拆分的日志文件的 appender--&gt;</span><br><span class=\"line\">        &lt;RollingFile name&#x3D;&quot;rollingFile&quot; fileName&#x3D;&quot;$&#123;LOG_HOME&#125;&#x2F;myrollog.log&quot;</span><br><span class=\"line\">                     filePattern&#x3D;&quot;&#x2F;logs&#x2F;$$&#123;date:yyyy-MM-dd&#125;&#x2F;myrollog-%d&#123;yyyy-MM-dd-HH-mm&#125;-%i.log&quot;&gt;</span><br><span class=\"line\">            &lt;!--日志级别过滤器--&gt;</span><br><span class=\"line\">            &lt;ThresholdFilter level&#x3D;&quot;debug&quot; onMatch&#x3D;&quot;ACCEPT&quot; onMismatch&#x3D;&quot;DENY&quot; &#x2F;&gt;</span><br><span class=\"line\">            &lt;!--日志消息格式--&gt;</span><br><span class=\"line\">            &lt;PatternLayout pattern&#x3D;&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l %c&#123;36&#125; - %msg%n&quot; &#x2F;&gt;</span><br><span class=\"line\">            &lt;Policies&gt;</span><br><span class=\"line\">                &lt;!--在系统启动时，出发拆分规则，生产一个新的日志文件--&gt;</span><br><span class=\"line\">                &lt;OnStartupTriggeringPolicy &#x2F;&gt;</span><br><span class=\"line\">                &lt;!--按照文件大小拆分，10MB --&gt;</span><br><span class=\"line\">                &lt;SizeBasedTriggeringPolicy size&#x3D;&quot;10 MB&quot; &#x2F;&gt;</span><br><span class=\"line\">                &lt;!--按照时间节点拆分，规则根据filePattern定义的--&gt;</span><br><span class=\"line\">                &lt;TimeBasedTriggeringPolicy &#x2F;&gt;</span><br><span class=\"line\">            &lt;&#x2F;Policies&gt;</span><br><span class=\"line\">            &lt;!--在同一个目录下，文件的个数限定为 30 个，超过进行覆盖--&gt;</span><br><span class=\"line\">            &lt;DefaultRolloverStrategy max&#x3D;&quot;30&quot; &#x2F;&gt;</span><br><span class=\"line\">        &lt;&#x2F;RollingFile&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;&#x2F;Appenders&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!--logger 定义--&gt;</span><br><span class=\"line\">    &lt;Loggers&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!--自定义异步 logger 对象</span><br><span class=\"line\">            includeLocation&#x3D;&quot;false&quot; 关闭日志记录的行号信息</span><br><span class=\"line\">            additivity&#x3D;&quot;false&quot; 不在继承 rootlogger 对象</span><br><span class=\"line\">        --&gt;</span><br><span class=\"line\">        &lt;AsyncLogger name&#x3D;&quot;cn.startanew&quot; level&#x3D;&quot;trace&quot; includeLocation&#x3D;&quot;false&quot; additivity&#x3D;&quot;false&quot;&gt;</span><br><span class=\"line\">            &lt;AppenderRef ref&#x3D;&quot;Console&quot;&#x2F;&gt;</span><br><span class=\"line\">        &lt;&#x2F;AsyncLogger&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!--使用 rootLogger 配置 日志级别 level&#x3D;&quot;trace&quot;--&gt;</span><br><span class=\"line\">        &lt;Root level&#x3D;&quot;trace&quot;&gt;</span><br><span class=\"line\">            &lt;!--指定日志使用的处理器--&gt;</span><br><span class=\"line\">            &lt;AppenderRef ref&#x3D;&quot;Console&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">            &lt;!--使用异步 appender--&gt;</span><br><span class=\"line\">            &lt;AppenderRef ref&#x3D;&quot;Async&quot; &#x2F;&gt;</span><br><span class=\"line\">        &lt;&#x2F;Root&gt;</span><br><span class=\"line\">    &lt;&#x2F;Loggers&gt;</span><br><span class=\"line\">&lt;&#x2F;Configuration&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"log4j2异步日志\"><a class=\"markdownIt-Anchor\" href=\"#log4j2异步日志\">#</a> Log4j2 异步日志</h3>\n<p><code>配置异步日志需要添加依赖</code></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--异步日志依赖--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lmax<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>disruptor<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.3.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><code> AsyncAppender方式</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Appenders&gt;</span><br><span class=\"line\">    &lt;!--控制台输出 appender--&gt;</span><br><span class=\"line\">    &lt;Console name&#x3D;&quot;Console&quot; target&#x3D;&quot;SYSTEM_ERR&quot;&gt;</span><br><span class=\"line\">        &lt;PatternLayout pattern&#x3D;&quot;%d&#123;HH:mm:ss.SSS&#125; [%t] [%-5level] %c&#123;36&#125;:%L --- %m%n&quot; &#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;Console&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!--日志文件输出 appender--&gt;</span><br><span class=\"line\">    &lt;File name&#x3D;&quot;file&quot; fileName&#x3D;&quot;$&#123;LOG_HOME&#125;&#x2F;myfile.log&quot;&gt;</span><br><span class=\"line\">        &lt;PatternLayout pattern&#x3D;&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l %c&#123;36&#125; - %m%n&quot; &#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;File&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;Async name&#x3D;&quot;Async&quot;&gt;</span><br><span class=\"line\">        &lt;AppenderRef ref&#x3D;&quot;file&quot;&#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;Async&gt;</span><br><span class=\"line\">&lt;&#x2F;Appenders&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"> &lt;Loggers&gt;</span><br><span class=\"line\">        &lt;!--自定义异步 logger 对象</span><br><span class=\"line\">            includeLocation&#x3D;&quot;false&quot; 关闭日志记录的行号信息</span><br><span class=\"line\">            additivity&#x3D;&quot;false&quot; 不在继承 rootlogger 对象</span><br><span class=\"line\">        --&gt;</span><br><span class=\"line\">        &lt;AsyncLogger name&#x3D;&quot;cn.startanew&quot; level&#x3D;&quot;trace&quot; includeLocation&#x3D;&quot;false&quot; additivity&#x3D;&quot;false&quot;&gt;</span><br><span class=\"line\">            &lt;AppenderRef ref&#x3D;&quot;Console&quot;&#x2F;&gt;</span><br><span class=\"line\">        &lt;&#x2F;AsyncLogger&gt;</span><br><span class=\"line\">    &lt;&#x2F;Loggers&gt;</span><br></pre></td></tr></table></figure>\n<p><code>AsyncLogger方式</code></p>\n<ol>\n<li>全局异步<br>\n <code>添加一个log4j2.component.properties 配置</code></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Log4jContextSelector=org.apache.logging.log4j.core.async.AsyncLoggerContextSelecto</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>混合异步</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!--日志处理--&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">Appenders</span>&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--日志文件输出 appender--&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">File</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;file&quot;</span> <span class=\"attr\">fileName</span>=<span class=\"string\">&quot;$&#123;LOG_HOME&#125;/myfile.log&quot;</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">PatternLayout</span> <span class=\"attr\">pattern</span>=<span class=\"string\">&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l %c&#123;36&#125; - %m%n&quot;</span> /&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">File</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">Async</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Async&quot;</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;file&quot;</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">Async</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">Appenders</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--logger 定义--&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">Loggers</span>&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--自定义异步 logger 对象</span></span><br><span class=\"line\"><span class=\"comment\">          includeLocation=&quot;false&quot; 关闭日志记录的行号信息</span></span><br><span class=\"line\"><span class=\"comment\">          additivity=&quot;false&quot; 不在继承 rootlogger 对象</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">AsyncLogger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;cn.startanew&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;trace&quot;</span> <span class=\"attr\">includeLocation</span>=<span class=\"string\">&quot;false&quot;</span> <span class=\"attr\">additivity</span>=<span class=\"string\">&quot;false&quot;</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;Console&quot;</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">AsyncLogger</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--使用 rootLogger 配置 日志级别 level=&quot;trace&quot;--&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">Root</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;trace&quot;</span>&gt;</span></span><br><span class=\"line\">          <span class=\"comment\">&lt;!--指定日志使用的处理器--&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;Console&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">&lt;!--使用异步 appender--&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;Async&quot;</span> /&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">Root</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">Loggers</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"spring-boot-使用log4j2\"><a class=\"markdownIt-Anchor\" href=\"#spring-boot-使用log4j2\">#</a> spring  boot  使用 log4j2</h3>\n<p>项目地址:<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3pqemJ1cnkvbG9nNGotbGVhcm4uZ2l0\">https://github.com/zjzbury/log4j-learn.git</span></p>\n",
            "tags": [
                "springboot",
                "javaweb"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/10/22/CompletableFuture-%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1/",
            "url": "http://www.startanew.cn/2020/10/22/CompletableFuture-%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1/",
            "title": "CompletableFuture  异步任务",
            "date_published": "2020-10-22T12:29:40.000Z",
            "content_html": "<h3 id=\"异步任务学习笔记\"><a class=\"markdownIt-Anchor\" href=\"#异步任务学习笔记\">#</a> 异步任务学习笔记</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@SpringBootTest</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo3ApplicationTests</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">contextLoads</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        run();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        CompletableFuture&lt;Void&gt; f1 = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Thread.sleep(<span class=\"number\">3000</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;第一个异步任务&quot;</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        CompletableFuture&lt;Void&gt; f2 = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Thread.sleep(<span class=\"number\">2000</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;第二个异步任务&quot;</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        CompletableFuture.allOf(f1, f2).join();</span><br><span class=\"line\"></span><br><span class=\"line\">        f2.whenComplete(((aVoid, throwable) -&gt; &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;void f2&quot;</span> + aVoid);</span><br><span class=\"line\">        &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">        f1.whenComplete(((aVoid, throwable) -&gt; &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;void f1&quot;</span> + aVoid);</span><br><span class=\"line\">        &#125;));</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;CompletableFuture Test runAsync&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"consumer用法\"><a class=\"markdownIt-Anchor\" href=\"#consumer用法\">#</a> Consumer 用法</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Foo</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer first;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">getFirst</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> first;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setFirst</span><span class=\"params\">(Integer first)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.first = first;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">    Foo f = <span class=\"keyword\">new</span> Foo();</span><br><span class=\"line\">    Consumer&lt;Foo&gt; consumer_fun = foo-&gt;foo.setFirst(<span class=\"number\">1</span>);</span><br><span class=\"line\">    consumer_fun.accept(f);</span><br><span class=\"line\">    System.out.println(f.getFirst());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>",
            "tags": [
                "java"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/10/16/springboot-%E9%9B%86%E6%88%90redis%E7%BC%93%E5%AD%98/",
            "url": "http://www.startanew.cn/2020/10/16/springboot-%E9%9B%86%E6%88%90redis%E7%BC%93%E5%AD%98/",
            "title": "springboot 集成redis缓存",
            "date_published": "2020-10-16T08:34:02.000Z",
            "content_html": "<h3 id=\"pom文件\"><a class=\"markdownIt-Anchor\" href=\"#pom文件\">#</a> pom 文件</h3>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-boot-starter-cache&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"yml配置\"><a class=\"markdownIt-Anchor\" href=\"#yml配置\">#</a> yml 配置</h3>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">spring:</span><br><span class=\"line\">  redis:</span><br><span class=\"line\">    database: 0</span><br><span class=\"line\">    host: localhost</span><br><span class=\"line\">    port: 6379</span><br><span class=\"line\">    jedis:</span><br><span class=\"line\">      pool:</span><br><span class=\"line\">        max-active: 8</span><br><span class=\"line\">        max-wait: 1ms</span><br><span class=\"line\">        max-idle: 8</span><br><span class=\"line\">        min-idle: 0</span><br><span class=\"line\">    timeout: 5000</span><br><span class=\"line\">  cache:</span><br><span class=\"line\">    type: redis</span><br></pre></td></tr></table></figure>\n<h3 id=\"redisconfig-配置\"><a class=\"markdownIt-Anchor\" href=\"#redisconfig-配置\">#</a> redisConfig 配置</h3>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Configuration</span><br><span class=\"line\">public class RedisConfig  extends CachingConfigurerSupport &#123;</span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public CacheManager cacheManager(RedisConnectionFactory factory) &#123;</span><br><span class=\"line\">        &#x2F;&#x2F;对象的序列化</span><br><span class=\"line\">        RedisSerializationContext.SerializationPair valueSerializationPair</span><br><span class=\"line\">                &#x3D; RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer());</span><br><span class=\"line\">        &#x2F;&#x2F;全局redis缓存过期时间</span><br><span class=\"line\">        RedisCacheConfiguration redisCacheConfiguration &#x3D; RedisCacheConfiguration.defaultCacheConfig()</span><br><span class=\"line\">                .serializeValuesWith(valueSerializationPair);</span><br><span class=\"line\"></span><br><span class=\"line\">        Set&lt;String&gt; cacheNames &#x3D; new HashSet&lt;&gt;();</span><br><span class=\"line\">        cacheNames.add(&quot;testCache&quot;);</span><br><span class=\"line\">        cacheNames.add(&quot;testCache2&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">        ConcurrentHashMap&lt;String, RedisCacheConfiguration&gt; configMap &#x3D; new ConcurrentHashMap&lt;&gt;();</span><br><span class=\"line\">        configMap.put(&quot;testCache&quot;, redisCacheConfiguration.entryTtl(Duration.ofSeconds(30)));&#x2F;&#x2F;有效期30秒</span><br><span class=\"line\">        configMap.put(&quot;testCache2&quot;, redisCacheConfiguration);&#x2F;&#x2F;永久</span><br><span class=\"line\">        return RedisCacheManager.builder(factory).initialCacheNames(cacheNames).withInitialCacheConfigurations(configMap).build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    private Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer() &#123;</span><br><span class=\"line\">        Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer &#x3D; new Jackson2JsonRedisSerializer&lt;&gt;(Object.class);</span><br><span class=\"line\">        jackson2JsonRedisSerializer.setObjectMapper(objectMapper());</span><br><span class=\"line\">        return jackson2JsonRedisSerializer;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    private ObjectMapper objectMapper() &#123;</span><br><span class=\"line\">        ObjectMapper objectMapper &#x3D; new ObjectMapper();</span><br><span class=\"line\">        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class=\"line\">        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class=\"line\">        return objectMapper;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    @Bean   &#x2F;&#x2F;在没有指定缓存Key的情况下，key生成策略</span><br><span class=\"line\">    public KeyGenerator keyGenerator() &#123;</span><br><span class=\"line\">        return new KeyGenerator() &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public Object generate(Object target, Method method, Object... params) &#123;</span><br><span class=\"line\">                StringBuilder sb &#x3D; new StringBuilder();</span><br><span class=\"line\">                sb.append(target.getClass().getName());</span><br><span class=\"line\">                sb.append(&quot;#&quot; + method.getName());</span><br><span class=\"line\">                for (Object obj : params) &#123;</span><br><span class=\"line\">                    sb.append(obj.toString());</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                return sb.toString();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"service层用法\"><a class=\"markdownIt-Anchor\" href=\"#service层用法\">#</a> service 层用法</h3>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Service</span><br><span class=\"line\">@CacheConfig(cacheNames &#x3D; &quot;testCache&quot;)</span><br><span class=\"line\">public class CachingServiceImpl  implements CachingService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    @Cacheable(key &#x3D; &quot;#i&quot;)  </span><br><span class=\"line\">    public int getId(int i) &#123;</span><br><span class=\"line\">        System.out.println(&quot;执行 getId  i &#x3D; &quot; + i);</span><br><span class=\"line\">        return i*1000;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    @CachePut(key &#x3D; &quot;#i&quot;)</span><br><span class=\"line\">    public int update(int i) &#123;</span><br><span class=\"line\">        System.out.println(&quot;执行  update  i &#x3D; &quot; + i);</span><br><span class=\"line\">        return i*3000;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    @CacheEvict(key &#x3D; &quot;#i&quot;)</span><br><span class=\"line\">    public int delete(int i) &#123;</span><br><span class=\"line\">        return i;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>",
            "tags": [
                "springboot",
                "javaweb"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/10/15/java-%E6%B1%89%E5%AD%97%E8%BD%AC%E6%8B%BC%E9%9F%B3/",
            "url": "http://www.startanew.cn/2020/10/15/java-%E6%B1%89%E5%AD%97%E8%BD%AC%E6%8B%BC%E9%9F%B3/",
            "title": "java 汉字转拼音",
            "date_published": "2020-10-15T13:55:00.000Z",
            "content_html": "<h3 id=\"pom文件\"><a class=\"markdownIt-Anchor\" href=\"#pom文件\">#</a> pom 文件</h3>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">        &lt;groupId&gt;com.belerweb&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;pinyin4j&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">        &lt;version&gt;2.5.1&lt;&#x2F;version&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"代码\"><a class=\"markdownIt-Anchor\" href=\"#代码\">#</a> 代码</h3>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static String getFullSpell(String chinese) &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; 用StringBuffer（字符串缓冲）来接收处理的数据</span><br><span class=\"line\">    StringBuffer sb &#x3D; new StringBuffer();</span><br><span class=\"line\">    &#x2F;&#x2F;字符串转换字节数组</span><br><span class=\"line\">    char[] arr &#x3D; chinese.toCharArray();</span><br><span class=\"line\">    HanyuPinyinOutputFormat defaultFormat &#x3D; new HanyuPinyinOutputFormat();</span><br><span class=\"line\">    &#x2F;&#x2F;转换类型（大写or小写）</span><br><span class=\"line\">    defaultFormat.setCaseType(HanyuPinyinCaseType.LOWERCASE);</span><br><span class=\"line\">    &#x2F;&#x2F;定义中文声调的输出格式</span><br><span class=\"line\">    defaultFormat.setToneType(HanyuPinyinToneType.WITHOUT_TONE);</span><br><span class=\"line\">    &#x2F;&#x2F;定义字符的输出格式</span><br><span class=\"line\">    defaultFormat.setVCharType(HanyuPinyinVCharType.WITH_U_AND_COLON);</span><br><span class=\"line\">    for (int i &#x3D; 0; i &lt; arr.length; i++) &#123;</span><br><span class=\"line\">        &#x2F;&#x2F;判断是否是汉子字符</span><br><span class=\"line\">        if (arr[i] &gt; 128) &#123;</span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                sb.append(capitalize(PinyinHelper.toHanyuPinyinStringArray(arr[i], defaultFormat)[0]));</span><br><span class=\"line\">            &#125; catch (BadHanyuPinyinOutputFormatCombination e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            &#x2F;&#x2F; 如果不是汉字字符，直接拼接</span><br><span class=\"line\">            sb.append(arr[i]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return sb.toString();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * 首字母大写</span><br><span class=\"line\"> * @param str</span><br><span class=\"line\"> * @return</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">public static String capitalize(String str) &#123;</span><br><span class=\"line\">    char ch[];</span><br><span class=\"line\">    ch &#x3D; str.toCharArray();</span><br><span class=\"line\">    if (ch[0] &gt;&#x3D; &#39;a&#39; &amp;&amp; ch[0] &lt;&#x3D; &#39;z&#39;) &#123;</span><br><span class=\"line\">        ch[0] &#x3D; (char) (ch[0] - 32);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    String newString &#x3D; new String(ch);</span><br><span class=\"line\">    return newString;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>",
            "tags": [
                "java"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/07/14/%E8%A7%A3%E5%86%B3SpringBoot%E9%9B%86%E6%88%90WebSocket%E6%89%93%E5%8C%85%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98/",
            "url": "http://www.startanew.cn/2020/07/14/%E8%A7%A3%E5%86%B3SpringBoot%E9%9B%86%E6%88%90WebSocket%E6%89%93%E5%8C%85%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98/",
            "title": "解决SpringBoot集成WebSocket打包失败问题",
            "date_published": "2020-07-14T01:00:22.000Z",
            "content_html": "<h5 id=\"第一种\"><a class=\"markdownIt-Anchor\" href=\"#第一种\">#</a> 第一种:</h5>\n<ul>\n<li>\n<p>在打包时使用 mvn clean package -DskipTests 就可以完美打包，运行.</p>\n</li>\n<li>\n<p>这种每次打包时都需要输入命令，比较繁琐，个人倾向第二种，在 pom 中添加配置即可</p>\n</li>\n</ul>\n<a id=\"more\"></a>\n<h5 id=\"第二种\"><a class=\"markdownIt-Anchor\" href=\"#第二种\">#</a> 第二种:</h5>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">在pom文件的&lt;bulid&gt;的&lt;plugins&gt;中加入如下配置,即可直接package成功</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;plugin&gt;</span><br><span class=\"line\">   &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">   &lt;artifactId&gt;maven-surefire-plugin&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">   &lt;configuration&gt;</span><br><span class=\"line\">   &lt;skip&gt;true&lt;&#x2F;skip&gt;</span><br><span class=\"line\">   &lt;&#x2F;configuration&gt;</span><br><span class=\"line\">&lt;&#x2F;plugin&gt;</span><br></pre></td></tr></table></figure>",
            "tags": [
                "springboot",
                "javaweb"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/07/14/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%89%E8%A3%85docker/",
            "url": "http://www.startanew.cn/2020/07/14/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%89%E8%A3%85docker/",
            "title": "树莓派安装docker",
            "date_published": "2020-07-14T00:55:56.000Z",
            "content_html": "<ol>\n<li>url -fsSL <span class=\"exturl\" data-url=\"aHR0cHM6Ly9nZXQuZG9ja2VyLmNvbQ==\">https://get.docker.com</span> -o <span class=\"exturl\" data-url=\"aHR0cDovL2dldC1kb2NrZXIuc2g=\">get-docker.sh</span>    下载安装脚本</li>\n<li>sh <span class=\"exturl\" data-url=\"aHR0cDovL2dldC1kb2NrZXIuc2g=\">get-docker.sh</span> –mirror Aliyun       执行安装脚本</li>\n<li>安装完成后  配置免 sudo  执行 docker</li>\n</ol>\n<a id=\"more\"></a>\n<ol start=\"4\">\n<li>sudo groupadd docker #添加 docker 用户组</li>\n<li>sudo gpasswd -a $USER docker #将登陆用户加入到 docker 用户组中</li>\n<li>newgrp docker #更新用户组</li>\n<li>docker ps #测试 docker 命令是否可以使用</li>\n</ol>\n",
            "tags": [
                "树莓派"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/07/14/%E5%AE%89%E5%8D%93%E6%88%AA%E5%B1%8F%E5%8A%9F%E8%83%BD%E4%B8%8E%E5%8A%A0%E8%BD%BDsd%E5%8D%A1%E7%9A%84html/",
            "url": "http://www.startanew.cn/2020/07/14/%E5%AE%89%E5%8D%93%E6%88%AA%E5%B1%8F%E5%8A%9F%E8%83%BD%E4%B8%8E%E5%8A%A0%E8%BD%BDsd%E5%8D%A1%E7%9A%84html/",
            "title": "安卓截屏功能与加载sd卡的html",
            "date_published": "2020-07-14T00:53:56.000Z",
            "content_html": "<ul>\n<li>代码如下:</li>\n</ul>\n<a id=\"more\"></a>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.medua.loadhtml;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> android.Manifest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.annotation.SuppressLint;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.app.Activity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.content.Context;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.content.Intent;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.content.pm.PackageManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.content.res.Resources;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.graphics.Bitmap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.graphics.PixelFormat;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.hardware.display.DisplayManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.hardware.display.VirtualDisplay;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.media.Image;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.media.ImageReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.media.projection.MediaProjection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.media.projection.MediaProjectionManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.os.Build;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.os.Bundle;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.util.Log;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.view.View;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.webkit.WebSettings;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.webkit.WebView;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.widget.Button;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.widget.Toast;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> androidx.annotation.NonNull;</span><br><span class=\"line\"><span class=\"keyword\">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> androidx.core.app.ActivityCompat;</span><br><span class=\"line\"><span class=\"keyword\">import</span> androidx.core.content.ContextCompat;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.FileOutputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.text.SimpleDateFormat;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Date;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Locale;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> <span class=\"keyword\">extends</span> <span class=\"title\">AppCompatActivity</span> <span class=\"keyword\">implements</span> <span class=\"title\">View</span>.<span class=\"title\">OnClickListener</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> PERMISSION_REQ_ID = <span class=\"number\">22</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String[] REQUESTED_PERMISSIONS = &#123;</span><br><span class=\"line\">            Manifest.permission.READ_EXTERNAL_STORAGE,</span><br><span class=\"line\">            Manifest.permission.WRITE_EXTERNAL_STORAGE</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> WebView webView;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Button butImg;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState);</span><br><span class=\"line\">        setContentView(R.layout.activity_main);</span><br><span class=\"line\">        initView();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (checkSelfPermission(REQUESTED_PERMISSIONS[<span class=\"number\">0</span>], PERMISSION_REQ_ID) &amp;&amp;</span><br><span class=\"line\">                checkSelfPermission(REQUESTED_PERMISSIONS[<span class=\"number\">1</span>], PERMISSION_REQ_ID)) &#123;</span><br><span class=\"line\">            setHtml();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//申请sd卡读写权限</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> <span class=\"title\">checkSelfPermission</span><span class=\"params\">(String permission, <span class=\"keyword\">int</span> requestCode)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ContextCompat.checkSelfPermission(<span class=\"keyword\">this</span>, permission) !=</span><br><span class=\"line\">                PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class=\"line\">            ActivityCompat.requestPermissions(<span class=\"keyword\">this</span>, REQUESTED_PERMISSIONS, requestCode);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onRequestPermissionsResult</span><span class=\"params\">(<span class=\"keyword\">int</span> requestCode,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                                           <span class=\"meta\">@NonNull</span> String[] permissions, <span class=\"meta\">@NonNull</span> <span class=\"keyword\">int</span>[] grantResults)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (requestCode == PERMISSION_REQ_ID) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (grantResults[<span class=\"number\">0</span>] != PackageManager.PERMISSION_GRANTED ||</span><br><span class=\"line\">                    grantResults[<span class=\"number\">1</span>] != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class=\"line\">                Toast.makeText(MainActivity.<span class=\"keyword\">this</span>, <span class=\"string\">&quot;暂无权限！！！&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                setHtml();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//加载sd卡里的html文件</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">initView</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        webView = (WebView) findViewById(R.id.webView);</span><br><span class=\"line\">        WebSettings ws = webView.getSettings();</span><br><span class=\"line\">        ws.setJavaScriptEnabled(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">        butImg = (Button) findViewById(R.id.butImg);</span><br><span class=\"line\">        butImg.setOnClickListener(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">setHtml</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        webView.loadUrl(<span class=\"string\">&quot;file://&quot;</span> + <span class=\"string\">&quot;/storage/emulated/0/loadHtml/index.html&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@SuppressLint(&quot;WrongConstant&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onClick</span><span class=\"params\">(View v)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (v.getId()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> R.id.butImg:</span><br><span class=\"line\">                createImage(v);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//截屏功能实现</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">createImage</span><span class=\"params\">(View v)</span> </span>&#123;</span><br><span class=\"line\">        SimpleDateFormat sdf = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">&quot;yyyy-MM-dd_HH-mm-ss&quot;</span>, Locale.US);</span><br><span class=\"line\">        String fname = <span class=\"string\">&quot;/sdcard/&quot;</span> + sdf.format(<span class=\"keyword\">new</span> Date()) + <span class=\"string\">&quot;.png&quot;</span>;</span><br><span class=\"line\">        View view = v.getRootView();</span><br><span class=\"line\">        view.setDrawingCacheEnabled(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">        view.buildDrawingCache();</span><br><span class=\"line\">        Bitmap bitmap = view.getDrawingCache();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (bitmap != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;bitmap got!&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                FileOutputStream out = <span class=\"keyword\">new</span> FileOutputStream(fname);</span><br><span class=\"line\">                bitmap.compress(Bitmap.CompressFormat.PNG, <span class=\"number\">100</span>, out);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>",
            "tags": [
                "android"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/07/14/jwt%E7%A7%81%E9%92%A5%E7%94%9F%E6%88%90/",
            "url": "http://www.startanew.cn/2020/07/14/jwt%E7%A7%81%E9%92%A5%E7%94%9F%E6%88%90/",
            "title": "jwt私钥生成",
            "date_published": "2020-07-14T00:41:17.000Z",
            "content_html": "<ul>\n<li>第一步：生成私钥，这里我们指定私钥的长度为 2048</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl genrsa -out rsa_private_key.pem 2048</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>  \n<ul>\n<li>第二步：根据私钥生成对应的公钥：下面两个都可以</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1: openssl rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem</span><br><span class=\"line\">2: openssl rsa -in rsa_private_key.pem -pubout -out rsa_public_key_2048.pub </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul>\n<li>第三步：私钥转化成 pkcs8 格式，尖括号的意思是：将转化好的私钥写到 rsa_private_key_pkcs8.pem 文件里</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl pkcs8 -topk8 -inform PEM -in rsa_private_key.pem -outform PEM -nocrypt &gt; rsa_private_key_pkcs8.pem</span><br></pre></td></tr></table></figure>\n<p>链接 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC9kMWJkMWRiYTIzYTM=\">https://www.jianshu.com/p/d1bd1dba23a3</span></p>\n",
            "tags": [
                "springboot"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/07/14/redis5-0-5%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/",
            "url": "http://www.startanew.cn/2020/07/14/redis5-0-5%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/",
            "title": "redis5.0.5集群搭建",
            "date_published": "2020-07-14T00:34:50.000Z",
            "content_html": "<h4 id=\"配置文件详解配置文件见文章后面\"><a class=\"markdownIt-Anchor\" href=\"#配置文件详解配置文件见文章后面\">#</a> 配置文件详解（配置文件见文章后面）</h4>\n<ul>\n<li>修改如下内容</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port 6379</span><br><span class=\"line\">daemonize yes</span><br><span class=\"line\">pidfile &#x2F;var&#x2F;run&#x2F;redis_6379.pid</span><br><span class=\"line\">cluster-enabled yes</span><br><span class=\"line\">cluster-node-timeout 15000</span><br><span class=\"line\">cluster-config-file  nodes-6379.conf </span><br></pre></td></tr></table></figure>\n<ul>\n<li>其他节点只需修改端口和文件名，依次按此进行配置即可，配置完成后启动这些节点</li>\n<li>启动 redis</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;redis-server redis6379&#x2F;redis.conf</span><br><span class=\"line\">.&#x2F;redis-server redis6380&#x2F;redis.conf</span><br><span class=\"line\">.&#x2F;redis-server redis6381&#x2F;redis.conf</span><br><span class=\"line\">.&#x2F;redis-server redis6382&#x2F;redis.conf</span><br><span class=\"line\">.&#x2F;redis-server redis6383&#x2F;redis.conf</span><br><span class=\"line\">.&#x2F;redis-server redis6384&#x2F;redis.conf</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>  \n<ul>\n<li>ps -ef|grep redis  查看启动状态</li>\n</ul>\n<h4 id=\"配置集群\"><a class=\"markdownIt-Anchor\" href=\"#配置集群\">#</a> 配置集群</h4>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;redis-cli --cluster create 127.0.0.1:6379 127.0.0.1:6380 127.0.0.1:6381 127.0.0.1:6382 </span><br><span class=\"line\">127.0.0.1:6383 127.0.0.1:6384 --cluster-replicas 1</span><br></pre></td></tr></table></figure>\n<ul>\n<li>其中 - replicas 1 表示每个主节点 1 个从节点<br>\n效果图如下:</li>\n</ul>\n<center>\n <img data-src=\"http://vps.startanew.cn/1594687118428yce0hwom.png\" >\n</center>   \n<center>\n <img data-src=\"http://vps.startanew.cn/159468712652932603ftw.png\" >\n</center>   \n<h4 id=\"测试集群\"><a class=\"markdownIt-Anchor\" href=\"#测试集群\">#</a> 测试集群</h4>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;redis-cli -h 127.0.0.1 -c -p 6379</span><br></pre></td></tr></table></figure>\n<h4 id=\"节点扩容\"><a class=\"markdownIt-Anchor\" href=\"#节点扩容\">#</a> 节点扩容</h4>\n<ul>\n<li>查看节点列表:<br>\ncluster nodes 节点扩容：</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;redis-cli --cluster add-node 127.0.0.1:6385 127.0.0.1:6379</span><br></pre></td></tr></table></figure>\n<ul>\n<li>添加从节点:</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;redis-cli --cluster add-node 127.0.0.1:6386 127.0.0.1:6379 --cluster-slave --cluster-master-id   -------</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul>\n<li>为新节点分配数据:</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;redis-cli --cluster reshard 127.0.0.1:6385</span><br><span class=\"line\">#### 节点缩减</span><br><span class=\"line\">缩减从节点</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;redis-cli --cluster del-node 127.0.0.1:6386 7c24e205301b38caa1ff3cd8b270a1ceb7249a2e</span><br><span class=\"line\">主节点slot转移</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;redis-cli --cluster reshard 127.0.0.1:6385</span><br><span class=\"line\">缩减主节点</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;redis-cli --cluster del-node 127.0.0.1:6385 22e8a8e97d6f7cc7d627e577a986384d4d181a4f</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"配置文件\"><a class=\"markdownIt-Anchor\" href=\"#配置文件\">#</a> 配置文件</h4>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br><span class=\"line\">695</span><br><span class=\"line\">696</span><br><span class=\"line\">697</span><br><span class=\"line\">698</span><br><span class=\"line\">699</span><br><span class=\"line\">700</span><br><span class=\"line\">701</span><br><span class=\"line\">702</span><br><span class=\"line\">703</span><br><span class=\"line\">704</span><br><span class=\"line\">705</span><br><span class=\"line\">706</span><br><span class=\"line\">707</span><br><span class=\"line\">708</span><br><span class=\"line\">709</span><br><span class=\"line\">710</span><br><span class=\"line\">711</span><br><span class=\"line\">712</span><br><span class=\"line\">713</span><br><span class=\"line\">714</span><br><span class=\"line\">715</span><br><span class=\"line\">716</span><br><span class=\"line\">717</span><br><span class=\"line\">718</span><br><span class=\"line\">719</span><br><span class=\"line\">720</span><br><span class=\"line\">721</span><br><span class=\"line\">722</span><br><span class=\"line\">723</span><br><span class=\"line\">724</span><br><span class=\"line\">725</span><br><span class=\"line\">726</span><br><span class=\"line\">727</span><br><span class=\"line\">728</span><br><span class=\"line\">729</span><br><span class=\"line\">730</span><br><span class=\"line\">731</span><br><span class=\"line\">732</span><br><span class=\"line\">733</span><br><span class=\"line\">734</span><br><span class=\"line\">735</span><br><span class=\"line\">736</span><br><span class=\"line\">737</span><br><span class=\"line\">738</span><br><span class=\"line\">739</span><br><span class=\"line\">740</span><br><span class=\"line\">741</span><br><span class=\"line\">742</span><br><span class=\"line\">743</span><br><span class=\"line\">744</span><br><span class=\"line\">745</span><br><span class=\"line\">746</span><br><span class=\"line\">747</span><br><span class=\"line\">748</span><br><span class=\"line\">749</span><br><span class=\"line\">750</span><br><span class=\"line\">751</span><br><span class=\"line\">752</span><br><span class=\"line\">753</span><br><span class=\"line\">754</span><br><span class=\"line\">755</span><br><span class=\"line\">756</span><br><span class=\"line\">757</span><br><span class=\"line\">758</span><br><span class=\"line\">759</span><br><span class=\"line\">760</span><br><span class=\"line\">761</span><br><span class=\"line\">762</span><br><span class=\"line\">763</span><br><span class=\"line\">764</span><br><span class=\"line\">765</span><br><span class=\"line\">766</span><br><span class=\"line\">767</span><br><span class=\"line\">768</span><br><span class=\"line\">769</span><br><span class=\"line\">770</span><br><span class=\"line\">771</span><br><span class=\"line\">772</span><br><span class=\"line\">773</span><br><span class=\"line\">774</span><br><span class=\"line\">775</span><br><span class=\"line\">776</span><br><span class=\"line\">777</span><br><span class=\"line\">778</span><br><span class=\"line\">779</span><br><span class=\"line\">780</span><br><span class=\"line\">781</span><br><span class=\"line\">782</span><br><span class=\"line\">783</span><br><span class=\"line\">784</span><br><span class=\"line\">785</span><br><span class=\"line\">786</span><br><span class=\"line\">787</span><br><span class=\"line\">788</span><br><span class=\"line\">789</span><br><span class=\"line\">790</span><br><span class=\"line\">791</span><br><span class=\"line\">792</span><br><span class=\"line\">793</span><br><span class=\"line\">794</span><br><span class=\"line\">795</span><br><span class=\"line\">796</span><br><span class=\"line\">797</span><br><span class=\"line\">798</span><br><span class=\"line\">799</span><br><span class=\"line\">800</span><br><span class=\"line\">801</span><br><span class=\"line\">802</span><br><span class=\"line\">803</span><br><span class=\"line\">804</span><br><span class=\"line\">805</span><br><span class=\"line\">806</span><br><span class=\"line\">807</span><br><span class=\"line\">808</span><br><span class=\"line\">809</span><br><span class=\"line\">810</span><br><span class=\"line\">811</span><br><span class=\"line\">812</span><br><span class=\"line\">813</span><br><span class=\"line\">814</span><br><span class=\"line\">815</span><br><span class=\"line\">816</span><br><span class=\"line\">817</span><br><span class=\"line\">818</span><br><span class=\"line\">819</span><br><span class=\"line\">820</span><br><span class=\"line\">821</span><br><span class=\"line\">822</span><br><span class=\"line\">823</span><br><span class=\"line\">824</span><br><span class=\"line\">825</span><br><span class=\"line\">826</span><br><span class=\"line\">827</span><br><span class=\"line\">828</span><br><span class=\"line\">829</span><br><span class=\"line\">830</span><br><span class=\"line\">831</span><br><span class=\"line\">832</span><br><span class=\"line\">833</span><br><span class=\"line\">834</span><br><span class=\"line\">835</span><br><span class=\"line\">836</span><br><span class=\"line\">837</span><br><span class=\"line\">838</span><br><span class=\"line\">839</span><br><span class=\"line\">840</span><br><span class=\"line\">841</span><br><span class=\"line\">842</span><br><span class=\"line\">843</span><br><span class=\"line\">844</span><br><span class=\"line\">845</span><br><span class=\"line\">846</span><br><span class=\"line\">847</span><br><span class=\"line\">848</span><br><span class=\"line\">849</span><br><span class=\"line\">850</span><br><span class=\"line\">851</span><br><span class=\"line\">852</span><br><span class=\"line\">853</span><br><span class=\"line\">854</span><br><span class=\"line\">855</span><br><span class=\"line\">856</span><br><span class=\"line\">857</span><br><span class=\"line\">858</span><br><span class=\"line\">859</span><br><span class=\"line\">860</span><br><span class=\"line\">861</span><br><span class=\"line\">862</span><br><span class=\"line\">863</span><br><span class=\"line\">864</span><br><span class=\"line\">865</span><br><span class=\"line\">866</span><br><span class=\"line\">867</span><br><span class=\"line\">868</span><br><span class=\"line\">869</span><br><span class=\"line\">870</span><br><span class=\"line\">871</span><br><span class=\"line\">872</span><br><span class=\"line\">873</span><br><span class=\"line\">874</span><br><span class=\"line\">875</span><br><span class=\"line\">876</span><br><span class=\"line\">877</span><br><span class=\"line\">878</span><br><span class=\"line\">879</span><br><span class=\"line\">880</span><br><span class=\"line\">881</span><br><span class=\"line\">882</span><br><span class=\"line\">883</span><br><span class=\"line\">884</span><br><span class=\"line\">885</span><br><span class=\"line\">886</span><br><span class=\"line\">887</span><br><span class=\"line\">888</span><br><span class=\"line\">889</span><br><span class=\"line\">890</span><br><span class=\"line\">891</span><br><span class=\"line\">892</span><br><span class=\"line\">893</span><br><span class=\"line\">894</span><br><span class=\"line\">895</span><br><span class=\"line\">896</span><br><span class=\"line\">897</span><br><span class=\"line\">898</span><br><span class=\"line\">899</span><br><span class=\"line\">900</span><br><span class=\"line\">901</span><br><span class=\"line\">902</span><br><span class=\"line\">903</span><br><span class=\"line\">904</span><br><span class=\"line\">905</span><br><span class=\"line\">906</span><br><span class=\"line\">907</span><br><span class=\"line\">908</span><br><span class=\"line\">909</span><br><span class=\"line\">910</span><br><span class=\"line\">911</span><br><span class=\"line\">912</span><br><span class=\"line\">913</span><br><span class=\"line\">914</span><br><span class=\"line\">915</span><br><span class=\"line\">916</span><br><span class=\"line\">917</span><br><span class=\"line\">918</span><br><span class=\"line\">919</span><br><span class=\"line\">920</span><br><span class=\"line\">921</span><br><span class=\"line\">922</span><br><span class=\"line\">923</span><br><span class=\"line\">924</span><br><span class=\"line\">925</span><br><span class=\"line\">926</span><br><span class=\"line\">927</span><br><span class=\"line\">928</span><br><span class=\"line\">929</span><br><span class=\"line\">930</span><br><span class=\"line\">931</span><br><span class=\"line\">932</span><br><span class=\"line\">933</span><br><span class=\"line\">934</span><br><span class=\"line\">935</span><br><span class=\"line\">936</span><br><span class=\"line\">937</span><br><span class=\"line\">938</span><br><span class=\"line\">939</span><br><span class=\"line\">940</span><br><span class=\"line\">941</span><br><span class=\"line\">942</span><br><span class=\"line\">943</span><br><span class=\"line\">944</span><br><span class=\"line\">945</span><br><span class=\"line\">946</span><br><span class=\"line\">947</span><br><span class=\"line\">948</span><br><span class=\"line\">949</span><br><span class=\"line\">950</span><br><span class=\"line\">951</span><br><span class=\"line\">952</span><br><span class=\"line\">953</span><br><span class=\"line\">954</span><br><span class=\"line\">955</span><br><span class=\"line\">956</span><br><span class=\"line\">957</span><br><span class=\"line\">958</span><br><span class=\"line\">959</span><br><span class=\"line\">960</span><br><span class=\"line\">961</span><br><span class=\"line\">962</span><br><span class=\"line\">963</span><br><span class=\"line\">964</span><br><span class=\"line\">965</span><br><span class=\"line\">966</span><br><span class=\"line\">967</span><br><span class=\"line\">968</span><br><span class=\"line\">969</span><br><span class=\"line\">970</span><br><span class=\"line\">971</span><br><span class=\"line\">972</span><br><span class=\"line\">973</span><br><span class=\"line\">974</span><br><span class=\"line\">975</span><br><span class=\"line\">976</span><br><span class=\"line\">977</span><br><span class=\"line\">978</span><br><span class=\"line\">979</span><br><span class=\"line\">980</span><br><span class=\"line\">981</span><br><span class=\"line\">982</span><br><span class=\"line\">983</span><br><span class=\"line\">984</span><br><span class=\"line\">985</span><br><span class=\"line\">986</span><br><span class=\"line\">987</span><br><span class=\"line\">988</span><br><span class=\"line\">989</span><br><span class=\"line\">990</span><br><span class=\"line\">991</span><br><span class=\"line\">992</span><br><span class=\"line\">993</span><br><span class=\"line\">994</span><br><span class=\"line\">995</span><br><span class=\"line\">996</span><br><span class=\"line\">997</span><br><span class=\"line\">998</span><br><span class=\"line\">999</span><br><span class=\"line\">1000</span><br><span class=\"line\">1001</span><br><span class=\"line\">1002</span><br><span class=\"line\">1003</span><br><span class=\"line\">1004</span><br><span class=\"line\">1005</span><br><span class=\"line\">1006</span><br><span class=\"line\">1007</span><br><span class=\"line\">1008</span><br><span class=\"line\">1009</span><br><span class=\"line\">1010</span><br><span class=\"line\">1011</span><br><span class=\"line\">1012</span><br><span class=\"line\">1013</span><br><span class=\"line\">1014</span><br><span class=\"line\">1015</span><br><span class=\"line\">1016</span><br><span class=\"line\">1017</span><br><span class=\"line\">1018</span><br><span class=\"line\">1019</span><br><span class=\"line\">1020</span><br><span class=\"line\">1021</span><br><span class=\"line\">1022</span><br><span class=\"line\">1023</span><br><span class=\"line\">1024</span><br><span class=\"line\">1025</span><br><span class=\"line\">1026</span><br><span class=\"line\">1027</span><br><span class=\"line\">1028</span><br><span class=\"line\">1029</span><br><span class=\"line\">1030</span><br><span class=\"line\">1031</span><br><span class=\"line\">1032</span><br><span class=\"line\">1033</span><br><span class=\"line\">1034</span><br><span class=\"line\">1035</span><br><span class=\"line\">1036</span><br><span class=\"line\">1037</span><br><span class=\"line\">1038</span><br><span class=\"line\">1039</span><br><span class=\"line\">1040</span><br><span class=\"line\">1041</span><br><span class=\"line\">1042</span><br><span class=\"line\">1043</span><br><span class=\"line\">1044</span><br><span class=\"line\">1045</span><br><span class=\"line\">1046</span><br><span class=\"line\">1047</span><br><span class=\"line\">1048</span><br><span class=\"line\">1049</span><br><span class=\"line\">1050</span><br><span class=\"line\">1051</span><br><span class=\"line\">1052</span><br><span class=\"line\">1053</span><br><span class=\"line\">1054</span><br><span class=\"line\">1055</span><br><span class=\"line\">1056</span><br><span class=\"line\">1057</span><br><span class=\"line\">1058</span><br><span class=\"line\">1059</span><br><span class=\"line\">1060</span><br><span class=\"line\">1061</span><br><span class=\"line\">1062</span><br><span class=\"line\">1063</span><br><span class=\"line\">1064</span><br><span class=\"line\">1065</span><br><span class=\"line\">1066</span><br><span class=\"line\">1067</span><br><span class=\"line\">1068</span><br><span class=\"line\">1069</span><br><span class=\"line\">1070</span><br><span class=\"line\">1071</span><br><span class=\"line\">1072</span><br><span class=\"line\">1073</span><br><span class=\"line\">1074</span><br><span class=\"line\">1075</span><br><span class=\"line\">1076</span><br><span class=\"line\">1077</span><br><span class=\"line\">1078</span><br><span class=\"line\">1079</span><br><span class=\"line\">1080</span><br><span class=\"line\">1081</span><br><span class=\"line\">1082</span><br><span class=\"line\">1083</span><br><span class=\"line\">1084</span><br><span class=\"line\">1085</span><br><span class=\"line\">1086</span><br><span class=\"line\">1087</span><br><span class=\"line\">1088</span><br><span class=\"line\">1089</span><br><span class=\"line\">1090</span><br><span class=\"line\">1091</span><br><span class=\"line\">1092</span><br><span class=\"line\">1093</span><br><span class=\"line\">1094</span><br><span class=\"line\">1095</span><br><span class=\"line\">1096</span><br><span class=\"line\">1097</span><br><span class=\"line\">1098</span><br><span class=\"line\">1099</span><br><span class=\"line\">1100</span><br><span class=\"line\">1101</span><br><span class=\"line\">1102</span><br><span class=\"line\">1103</span><br><span class=\"line\">1104</span><br><span class=\"line\">1105</span><br><span class=\"line\">1106</span><br><span class=\"line\">1107</span><br><span class=\"line\">1108</span><br><span class=\"line\">1109</span><br><span class=\"line\">1110</span><br><span class=\"line\">1111</span><br><span class=\"line\">1112</span><br><span class=\"line\">1113</span><br><span class=\"line\">1114</span><br><span class=\"line\">1115</span><br><span class=\"line\">1116</span><br><span class=\"line\">1117</span><br><span class=\"line\">1118</span><br><span class=\"line\">1119</span><br><span class=\"line\">1120</span><br><span class=\"line\">1121</span><br><span class=\"line\">1122</span><br><span class=\"line\">1123</span><br><span class=\"line\">1124</span><br><span class=\"line\">1125</span><br><span class=\"line\">1126</span><br><span class=\"line\">1127</span><br><span class=\"line\">1128</span><br><span class=\"line\">1129</span><br><span class=\"line\">1130</span><br><span class=\"line\">1131</span><br><span class=\"line\">1132</span><br><span class=\"line\">1133</span><br><span class=\"line\">1134</span><br><span class=\"line\">1135</span><br><span class=\"line\">1136</span><br><span class=\"line\">1137</span><br><span class=\"line\">1138</span><br><span class=\"line\">1139</span><br><span class=\"line\">1140</span><br><span class=\"line\">1141</span><br><span class=\"line\">1142</span><br><span class=\"line\">1143</span><br><span class=\"line\">1144</span><br><span class=\"line\">1145</span><br><span class=\"line\">1146</span><br><span class=\"line\">1147</span><br><span class=\"line\">1148</span><br><span class=\"line\">1149</span><br><span class=\"line\">1150</span><br><span class=\"line\">1151</span><br><span class=\"line\">1152</span><br><span class=\"line\">1153</span><br><span class=\"line\">1154</span><br><span class=\"line\">1155</span><br><span class=\"line\">1156</span><br><span class=\"line\">1157</span><br><span class=\"line\">1158</span><br><span class=\"line\">1159</span><br><span class=\"line\">1160</span><br><span class=\"line\">1161</span><br><span class=\"line\">1162</span><br><span class=\"line\">1163</span><br><span class=\"line\">1164</span><br><span class=\"line\">1165</span><br><span class=\"line\">1166</span><br><span class=\"line\">1167</span><br><span class=\"line\">1168</span><br><span class=\"line\">1169</span><br><span class=\"line\">1170</span><br><span class=\"line\">1171</span><br><span class=\"line\">1172</span><br><span class=\"line\">1173</span><br><span class=\"line\">1174</span><br><span class=\"line\">1175</span><br><span class=\"line\">1176</span><br><span class=\"line\">1177</span><br><span class=\"line\">1178</span><br><span class=\"line\">1179</span><br><span class=\"line\">1180</span><br><span class=\"line\">1181</span><br><span class=\"line\">1182</span><br><span class=\"line\">1183</span><br><span class=\"line\">1184</span><br><span class=\"line\">1185</span><br><span class=\"line\">1186</span><br><span class=\"line\">1187</span><br><span class=\"line\">1188</span><br><span class=\"line\">1189</span><br><span class=\"line\">1190</span><br><span class=\"line\">1191</span><br><span class=\"line\">1192</span><br><span class=\"line\">1193</span><br><span class=\"line\">1194</span><br><span class=\"line\">1195</span><br><span class=\"line\">1196</span><br><span class=\"line\">1197</span><br><span class=\"line\">1198</span><br><span class=\"line\">1199</span><br><span class=\"line\">1200</span><br><span class=\"line\">1201</span><br><span class=\"line\">1202</span><br><span class=\"line\">1203</span><br><span class=\"line\">1204</span><br><span class=\"line\">1205</span><br><span class=\"line\">1206</span><br><span class=\"line\">1207</span><br><span class=\"line\">1208</span><br><span class=\"line\">1209</span><br><span class=\"line\">1210</span><br><span class=\"line\">1211</span><br><span class=\"line\">1212</span><br><span class=\"line\">1213</span><br><span class=\"line\">1214</span><br><span class=\"line\">1215</span><br><span class=\"line\">1216</span><br><span class=\"line\">1217</span><br><span class=\"line\">1218</span><br><span class=\"line\">1219</span><br><span class=\"line\">1220</span><br><span class=\"line\">1221</span><br><span class=\"line\">1222</span><br><span class=\"line\">1223</span><br><span class=\"line\">1224</span><br><span class=\"line\">1225</span><br><span class=\"line\">1226</span><br><span class=\"line\">1227</span><br><span class=\"line\">1228</span><br><span class=\"line\">1229</span><br><span class=\"line\">1230</span><br><span class=\"line\">1231</span><br><span class=\"line\">1232</span><br><span class=\"line\">1233</span><br><span class=\"line\">1234</span><br><span class=\"line\">1235</span><br><span class=\"line\">1236</span><br><span class=\"line\">1237</span><br><span class=\"line\">1238</span><br><span class=\"line\">1239</span><br><span class=\"line\">1240</span><br><span class=\"line\">1241</span><br><span class=\"line\">1242</span><br><span class=\"line\">1243</span><br><span class=\"line\">1244</span><br><span class=\"line\">1245</span><br><span class=\"line\">1246</span><br><span class=\"line\">1247</span><br><span class=\"line\">1248</span><br><span class=\"line\">1249</span><br><span class=\"line\">1250</span><br><span class=\"line\">1251</span><br><span class=\"line\">1252</span><br><span class=\"line\">1253</span><br><span class=\"line\">1254</span><br><span class=\"line\">1255</span><br><span class=\"line\">1256</span><br><span class=\"line\">1257</span><br><span class=\"line\">1258</span><br><span class=\"line\">1259</span><br><span class=\"line\">1260</span><br><span class=\"line\">1261</span><br><span class=\"line\">1262</span><br><span class=\"line\">1263</span><br><span class=\"line\">1264</span><br><span class=\"line\">1265</span><br><span class=\"line\">1266</span><br><span class=\"line\">1267</span><br><span class=\"line\">1268</span><br><span class=\"line\">1269</span><br><span class=\"line\">1270</span><br><span class=\"line\">1271</span><br><span class=\"line\">1272</span><br><span class=\"line\">1273</span><br><span class=\"line\">1274</span><br><span class=\"line\">1275</span><br><span class=\"line\">1276</span><br><span class=\"line\">1277</span><br><span class=\"line\">1278</span><br><span class=\"line\">1279</span><br><span class=\"line\">1280</span><br><span class=\"line\">1281</span><br><span class=\"line\">1282</span><br><span class=\"line\">1283</span><br><span class=\"line\">1284</span><br><span class=\"line\">1285</span><br><span class=\"line\">1286</span><br><span class=\"line\">1287</span><br><span class=\"line\">1288</span><br><span class=\"line\">1289</span><br><span class=\"line\">1290</span><br><span class=\"line\">1291</span><br><span class=\"line\">1292</span><br><span class=\"line\">1293</span><br><span class=\"line\">1294</span><br><span class=\"line\">1295</span><br><span class=\"line\">1296</span><br><span class=\"line\">1297</span><br><span class=\"line\">1298</span><br><span class=\"line\">1299</span><br><span class=\"line\">1300</span><br><span class=\"line\">1301</span><br><span class=\"line\">1302</span><br><span class=\"line\">1303</span><br><span class=\"line\">1304</span><br><span class=\"line\">1305</span><br><span class=\"line\">1306</span><br><span class=\"line\">1307</span><br><span class=\"line\">1308</span><br><span class=\"line\">1309</span><br><span class=\"line\">1310</span><br><span class=\"line\">1311</span><br><span class=\"line\">1312</span><br><span class=\"line\">1313</span><br><span class=\"line\">1314</span><br><span class=\"line\">1315</span><br><span class=\"line\">1316</span><br><span class=\"line\">1317</span><br><span class=\"line\">1318</span><br><span class=\"line\">1319</span><br><span class=\"line\">1320</span><br><span class=\"line\">1321</span><br><span class=\"line\">1322</span><br><span class=\"line\">1323</span><br><span class=\"line\">1324</span><br><span class=\"line\">1325</span><br><span class=\"line\">1326</span><br><span class=\"line\">1327</span><br><span class=\"line\">1328</span><br><span class=\"line\">1329</span><br><span class=\"line\">1330</span><br><span class=\"line\">1331</span><br><span class=\"line\">1332</span><br><span class=\"line\">1333</span><br><span class=\"line\">1334</span><br><span class=\"line\">1335</span><br><span class=\"line\">1336</span><br><span class=\"line\">1337</span><br><span class=\"line\">1338</span><br><span class=\"line\">1339</span><br><span class=\"line\">1340</span><br><span class=\"line\">1341</span><br><span class=\"line\">1342</span><br><span class=\"line\">1343</span><br><span class=\"line\">1344</span><br><span class=\"line\">1345</span><br><span class=\"line\">1346</span><br><span class=\"line\">1347</span><br><span class=\"line\">1348</span><br><span class=\"line\">1349</span><br><span class=\"line\">1350</span><br><span class=\"line\">1351</span><br><span class=\"line\">1352</span><br><span class=\"line\">1353</span><br><span class=\"line\">1354</span><br><span class=\"line\">1355</span><br><span class=\"line\">1356</span><br><span class=\"line\">1357</span><br><span class=\"line\">1358</span><br><span class=\"line\">1359</span><br><span class=\"line\">1360</span><br><span class=\"line\">1361</span><br><span class=\"line\">1362</span><br><span class=\"line\">1363</span><br><span class=\"line\">1364</span><br><span class=\"line\">1365</span><br><span class=\"line\">1366</span><br><span class=\"line\">1367</span><br><span class=\"line\">1368</span><br><span class=\"line\">1369</span><br><span class=\"line\">1370</span><br><span class=\"line\">1371</span><br><span class=\"line\">1372</span><br><span class=\"line\">1373</span><br><span class=\"line\">1374</span><br><span class=\"line\">1375</span><br><span class=\"line\">1376</span><br><span class=\"line\">1377</span><br><span class=\"line\">1378</span><br><span class=\"line\">1379</span><br><span class=\"line\">1380</span><br><span class=\"line\">1381</span><br><span class=\"line\">1382</span><br><span class=\"line\">1383</span><br><span class=\"line\">1384</span><br><span class=\"line\">1385</span><br><span class=\"line\">1386</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Redis configuration file example.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Note that in order to read the configuration file, Redis must be</span><br><span class=\"line\"># started with the file path as first argument:</span><br><span class=\"line\">#</span><br><span class=\"line\"># .&#x2F;redis-server &#x2F;path&#x2F;to&#x2F;redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\"># Note on units: when memory size is needed, it is possible to specify</span><br><span class=\"line\"># it in the usual form of 1k 5GB 4M and so forth:</span><br><span class=\"line\">#</span><br><span class=\"line\"># 1k &#x3D;&gt; 1000 bytes</span><br><span class=\"line\"># 1kb &#x3D;&gt; 1024 bytes</span><br><span class=\"line\"># 1m &#x3D;&gt; 1000000 bytes</span><br><span class=\"line\"># 1mb &#x3D;&gt; 1024*1024 bytes</span><br><span class=\"line\"># 1g &#x3D;&gt; 1000000000 bytes</span><br><span class=\"line\"># 1gb &#x3D;&gt; 1024*1024*1024 bytes</span><br><span class=\"line\">#</span><br><span class=\"line\"># units are case insensitive so 1GB 1Gb 1gB are all the same.</span><br><span class=\"line\"></span><br><span class=\"line\">################################## INCLUDES ###################################</span><br><span class=\"line\"></span><br><span class=\"line\"># Include one or more other config files here. This is useful if you</span><br><span class=\"line\"># have a standard template that goes to all Redis servers but also need</span><br><span class=\"line\"># to customize a few per-server settings. Include files can include</span><br><span class=\"line\"># other files, so use this wisely.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Notice option &quot;include&quot; won&#39;t be rewritten by command &quot;CONFIG REWRITE&quot;</span><br><span class=\"line\"># from admin or Redis Sentinel. Since Redis always uses the last processed</span><br><span class=\"line\"># line as value of a configuration directive, you&#39;d better put includes</span><br><span class=\"line\"># at the beginning of this file to avoid overwriting config change at runtime.</span><br><span class=\"line\">#</span><br><span class=\"line\"># If instead you are interested in using includes to override configuration</span><br><span class=\"line\"># options, it is better to use include as the last line.</span><br><span class=\"line\">#</span><br><span class=\"line\"># include &#x2F;path&#x2F;to&#x2F;local.conf</span><br><span class=\"line\"># include &#x2F;path&#x2F;to&#x2F;other.conf</span><br><span class=\"line\"></span><br><span class=\"line\">################################## MODULES #####################################</span><br><span class=\"line\"></span><br><span class=\"line\"># Load modules at startup. If the server is not able to load modules</span><br><span class=\"line\"># it will abort. It is possible to use multiple loadmodule directives.</span><br><span class=\"line\">#</span><br><span class=\"line\"># loadmodule &#x2F;path&#x2F;to&#x2F;my_module.so</span><br><span class=\"line\"># loadmodule &#x2F;path&#x2F;to&#x2F;other_module.so</span><br><span class=\"line\"></span><br><span class=\"line\">################################## NETWORK #####################################</span><br><span class=\"line\"></span><br><span class=\"line\"># By default, if no &quot;bind&quot; configuration directive is specified, Redis listens</span><br><span class=\"line\"># for connections from all the network interfaces available on the server.</span><br><span class=\"line\"># It is possible to listen to just one or multiple selected interfaces using</span><br><span class=\"line\"># the &quot;bind&quot; configuration directive, followed by one or more IP addresses.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Examples:</span><br><span class=\"line\">#</span><br><span class=\"line\"># bind 192.168.1.100 10.0.0.1</span><br><span class=\"line\"># bind 127.0.0.1 ::1</span><br><span class=\"line\">#</span><br><span class=\"line\"># ~~~ WARNING ~~~ If the computer running Redis is directly exposed to the</span><br><span class=\"line\"># internet, binding to all the interfaces is dangerous and will expose the</span><br><span class=\"line\"># instance to everybody on the internet. So by default we uncomment the</span><br><span class=\"line\"># following bind directive, that will force Redis to listen only into</span><br><span class=\"line\"># the IPv4 loopback interface address (this means Redis will be able to</span><br><span class=\"line\"># accept connections only from clients running into the same computer it</span><br><span class=\"line\"># is running).</span><br><span class=\"line\">#</span><br><span class=\"line\"># IF YOU ARE SURE YOU WANT YOUR INSTANCE TO LISTEN TO ALL THE INTERFACES</span><br><span class=\"line\"># JUST COMMENT THE FOLLOWING LINE.</span><br><span class=\"line\"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class=\"line\">bind 0.0.0.0</span><br><span class=\"line\"></span><br><span class=\"line\"># Protected mode is a layer of security protection, in order to avoid that</span><br><span class=\"line\"># Redis instances left open on the internet are accessed and exploited.</span><br><span class=\"line\">#</span><br><span class=\"line\"># When protected mode is on and if:</span><br><span class=\"line\">#</span><br><span class=\"line\"># 1) The server is not binding explicitly to a set of addresses using the</span><br><span class=\"line\"># &quot;bind&quot; directive.</span><br><span class=\"line\"># 2) No password is configured.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The server only accepts connections from clients connecting from the</span><br><span class=\"line\"># IPv4 and IPv6 loopback addresses 127.0.0.1 and ::1, and from Unix domain</span><br><span class=\"line\"># sockets.</span><br><span class=\"line\">#</span><br><span class=\"line\"># By default protected mode is enabled. You should disable it only if</span><br><span class=\"line\"># you are sure you want clients from other hosts to connect to Redis</span><br><span class=\"line\"># even if no authentication is configured, nor a specific set of interfaces</span><br><span class=\"line\"># are explicitly listed using the &quot;bind&quot; directive.</span><br><span class=\"line\">protected-mode no</span><br><span class=\"line\"></span><br><span class=\"line\"># Accept connections on the specified port, default is 6379 (IANA #815344).</span><br><span class=\"line\"># If port 0 is specified Redis will not listen on a TCP socket.</span><br><span class=\"line\">port 6379</span><br><span class=\"line\"></span><br><span class=\"line\"># TCP listen() backlog.</span><br><span class=\"line\">#</span><br><span class=\"line\"># In high requests-per-second environments you need an high backlog in order</span><br><span class=\"line\"># to avoid slow clients connections issues. Note that the Linux kernel</span><br><span class=\"line\"># will silently truncate it to the value of &#x2F;proc&#x2F;sys&#x2F;net&#x2F;core&#x2F;somaxconn so</span><br><span class=\"line\"># make sure to raise both the value of somaxconn and tcp_max_syn_backlog</span><br><span class=\"line\"># in order to get the desired effect.</span><br><span class=\"line\">tcp-backlog 511</span><br><span class=\"line\"></span><br><span class=\"line\"># Unix socket.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Specify the path for the Unix socket that will be used to listen for</span><br><span class=\"line\"># incoming connections. There is no default, so Redis will not listen</span><br><span class=\"line\"># on a unix socket when not specified.</span><br><span class=\"line\">#</span><br><span class=\"line\"># unixsocket &#x2F;tmp&#x2F;redis.sock</span><br><span class=\"line\"># unixsocketperm 700</span><br><span class=\"line\"></span><br><span class=\"line\"># Close the connection after a client is idle for N seconds (0 to disable)</span><br><span class=\"line\">timeout 0</span><br><span class=\"line\"></span><br><span class=\"line\"># TCP keepalive.</span><br><span class=\"line\">#</span><br><span class=\"line\"># If non-zero, use SO_KEEPALIVE to send TCP ACKs to clients in absence</span><br><span class=\"line\"># of communication. This is useful for two reasons:</span><br><span class=\"line\">#</span><br><span class=\"line\"># 1) Detect dead peers.</span><br><span class=\"line\"># 2) Take the connection alive from the point of view of network</span><br><span class=\"line\"># equipment in the middle.</span><br><span class=\"line\">#</span><br><span class=\"line\"># On Linux, the specified value (in seconds) is the period used to send ACKs.</span><br><span class=\"line\"># Note that to close the connection the double of the time is needed.</span><br><span class=\"line\"># On other kernels the period depends on the kernel configuration.</span><br><span class=\"line\">#</span><br><span class=\"line\"># A reasonable value for this option is 300 seconds, which is the new</span><br><span class=\"line\"># Redis default starting with Redis 3.2.1.</span><br><span class=\"line\">tcp-keepalive 300</span><br><span class=\"line\"></span><br><span class=\"line\">################################# GENERAL #####################################</span><br><span class=\"line\"></span><br><span class=\"line\"># By default Redis does not run as a daemon. Use &#39;yes&#39; if you need it.</span><br><span class=\"line\"># Note that Redis will write a pid file in &#x2F;var&#x2F;run&#x2F;redis.pid when daemonized.</span><br><span class=\"line\"># allkeys-random -&gt; Remove a random key, any key.</span><br><span class=\"line\"># volatile-ttl -&gt; Remove the key with the nearest expire time (minor TTL)</span><br><span class=\"line\">pidfile &#x2F;var&#x2F;run&#x2F;redis_6379.pid</span><br><span class=\"line\">daemonize yes</span><br><span class=\"line\"></span><br><span class=\"line\"># If you run Redis from upstart or systemd, Redis can interact with your</span><br><span class=\"line\"># supervision tree. Options:</span><br><span class=\"line\"># supervised no - no supervision interaction</span><br><span class=\"line\"># supervised upstart - signal upstart by putting Redis into SIGSTOP mode</span><br><span class=\"line\"># supervised systemd - signal systemd by writing READY&#x3D;1 to $NOTIFY_SOCKET</span><br><span class=\"line\"># supervised auto - detect upstart or systemd method based on</span><br><span class=\"line\"># UPSTART_JOB or NOTIFY_SOCKET environment variables</span><br><span class=\"line\"># Note: these supervision methods only signal &quot;process is ready.&quot;</span><br><span class=\"line\"># They do not enable continuous liveness pings back to your supervisor.</span><br><span class=\"line\">supervised no</span><br><span class=\"line\"></span><br><span class=\"line\"># If a pid file is specified, Redis writes it where specified at startup</span><br><span class=\"line\"># and removes it at exit.</span><br><span class=\"line\">#</span><br><span class=\"line\"># When the server runs non daemonized, no pid file is created if none is</span><br><span class=\"line\"># specified in the configuration. When the server is daemonized, the pid file</span><br><span class=\"line\"># is used even if not specified, defaulting to &quot;&#x2F;var&#x2F;run&#x2F;redis.pid&quot;.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Creating a pid file is best effort: if Redis is not able to create it</span><br><span class=\"line\"># nothing bad happens, the server will start and run normally.</span><br><span class=\"line\">pidfile &#x2F;var&#x2F;run&#x2F;redis_6379.pid</span><br><span class=\"line\"></span><br><span class=\"line\"># Specify the server verbosity level.</span><br><span class=\"line\"># This can be one of:</span><br><span class=\"line\"># debug (a lot of information, useful for development&#x2F;testing)</span><br><span class=\"line\"># verbose (many rarely useful info, but not a mess like the debug level)</span><br><span class=\"line\"># notice (moderately verbose, what you want in production probably)</span><br><span class=\"line\"># warning (only very important &#x2F; critical messages are logged)</span><br><span class=\"line\">loglevel notice</span><br><span class=\"line\"></span><br><span class=\"line\"># Specify the log file name. Also the empty string can be used to force</span><br><span class=\"line\"># Redis to log on the standard output. Note that if you use standard</span><br><span class=\"line\"># output for logging but daemonize, logs will be sent to &#x2F;dev&#x2F;null</span><br><span class=\"line\">logfile &quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># To enable logging to the system logger, just set &#39;syslog-enabled&#39; to yes,</span><br><span class=\"line\"># and optionally update the other syslog parameters to suit your needs.</span><br><span class=\"line\"># syslog-enabled no</span><br><span class=\"line\"></span><br><span class=\"line\"># Specify the syslog identity.</span><br><span class=\"line\"># syslog-ident redis</span><br><span class=\"line\"></span><br><span class=\"line\"># Specify the syslog facility. Must be USER or between LOCAL0-LOCAL7.</span><br><span class=\"line\"># syslog-facility local0</span><br><span class=\"line\"></span><br><span class=\"line\"># Set the number of databases. The default database is DB 0, you can select</span><br><span class=\"line\"># a different one on a per-connection basis using SELECT &lt;dbid&gt; where</span><br><span class=\"line\"># dbid is a number between 0 and &#39;databases&#39;-1</span><br><span class=\"line\">databases 16</span><br><span class=\"line\"></span><br><span class=\"line\"># By default Redis shows an ASCII art logo only when started to log to the</span><br><span class=\"line\"># standard output and if the standard output is a TTY. Basically this means</span><br><span class=\"line\"># that normally a logo is displayed only in interactive sessions.</span><br><span class=\"line\">#</span><br><span class=\"line\"># However it is possible to force the pre-4.0 behavior and always show a</span><br><span class=\"line\"># ASCII art logo in startup logs by setting the following option to yes.</span><br><span class=\"line\">always-show-logo yes</span><br><span class=\"line\"></span><br><span class=\"line\">################################ SNAPSHOTTING ################################</span><br><span class=\"line\">#</span><br><span class=\"line\"># Save the DB on disk:</span><br><span class=\"line\">#</span><br><span class=\"line\"># save &lt;seconds&gt; &lt;changes&gt;</span><br><span class=\"line\">#</span><br><span class=\"line\"># Will save the DB if both the given number of seconds and the given</span><br><span class=\"line\"># number of write operations against the DB occurred.</span><br><span class=\"line\">#</span><br><span class=\"line\"># In the example below the behaviour will be to save:</span><br><span class=\"line\"># after 900 sec (15 min) if at least 1 key changed</span><br><span class=\"line\"># after 300 sec (5 min) if at least 10 keys changed</span><br><span class=\"line\"># after 60 sec if at least 10000 keys changed</span><br><span class=\"line\">#</span><br><span class=\"line\"># Note: you can disable saving completely by commenting out all &quot;save&quot; lines.</span><br><span class=\"line\">#</span><br><span class=\"line\"># It is also possible to remove all the previously configured save</span><br><span class=\"line\"># points by adding a save directive with a single empty string argument</span><br><span class=\"line\"># like in the following example:</span><br><span class=\"line\">#</span><br><span class=\"line\"># save &quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">save 900 1</span><br><span class=\"line\">save 300 10</span><br><span class=\"line\">save 60 10000</span><br><span class=\"line\"></span><br><span class=\"line\"># By default Redis will stop accepting writes if RDB snapshots are enabled</span><br><span class=\"line\"># (at least one save point) and the latest background save failed.</span><br><span class=\"line\"># This will make the user aware (in a hard way) that data is not persisting</span><br><span class=\"line\"># on disk properly, otherwise chances are that no one will notice and some</span><br><span class=\"line\"># disaster will happen.</span><br><span class=\"line\">#</span><br><span class=\"line\"># If the background saving process will start working again Redis will</span><br><span class=\"line\"># automatically allow writes again.</span><br><span class=\"line\">#</span><br><span class=\"line\"># However if you have setup your proper monitoring of the Redis server</span><br><span class=\"line\"># and persistence, you may want to disable this feature so that Redis will</span><br><span class=\"line\"># continue to work as usual even if there are problems with disk,</span><br><span class=\"line\"># permissions, and so forth.</span><br><span class=\"line\">stop-writes-on-bgsave-error yes</span><br><span class=\"line\"></span><br><span class=\"line\"># Compress string objects using LZF when dump .rdb databases?</span><br><span class=\"line\"># For default that&#39;s set to &#39;yes&#39; as it&#39;s almost always a win.</span><br><span class=\"line\"># If you want to save some CPU in the saving child set it to &#39;no&#39; but</span><br><span class=\"line\"># the dataset will likely be bigger if you have compressible values or keys.</span><br><span class=\"line\">rdbcompression yes</span><br><span class=\"line\"></span><br><span class=\"line\"># Since version 5 of RDB a CRC64 checksum is placed at the end of the file.</span><br><span class=\"line\"># This makes the format more resistant to corruption but there is a performance</span><br><span class=\"line\"># hit to pay (around 10%) when saving and loading RDB files, so you can disable it</span><br><span class=\"line\"># for maximum performances.</span><br><span class=\"line\">#</span><br><span class=\"line\"># RDB files created with checksum disabled have a checksum of zero that will</span><br><span class=\"line\"># tell the loading code to skip the check.</span><br><span class=\"line\">rdbchecksum yes</span><br><span class=\"line\"></span><br><span class=\"line\"># The filename where to dump the DB</span><br><span class=\"line\">dbfilename dump-6379.rdb</span><br><span class=\"line\"></span><br><span class=\"line\"># The working directory.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The DB will be written inside this directory, with the filename specified</span><br><span class=\"line\"># above using the &#39;dbfilename&#39; configuration directive.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The Append Only File will also be created inside this directory.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Note that you must specify a directory here, not a file name.</span><br><span class=\"line\">dir .&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">################################# REPLICATION #################################</span><br><span class=\"line\"></span><br><span class=\"line\"># Master-Replica replication. Use replicaof to make a Redis instance a copy of</span><br><span class=\"line\"># another Redis server. A few things to understand ASAP about Redis replication.</span><br><span class=\"line\">#</span><br><span class=\"line\"># +------------------+ +---------------+</span><br><span class=\"line\"># | Master | ---&gt; | Replica |</span><br><span class=\"line\"># | (receive writes) | | (exact copy) |</span><br><span class=\"line\"># +------------------+ +---------------+</span><br><span class=\"line\">#</span><br><span class=\"line\"># 1) Redis replication is asynchronous, but you can configure a master to</span><br><span class=\"line\"># stop accepting writes if it appears to be not connected with at least</span><br><span class=\"line\"># a given number of replicas.</span><br><span class=\"line\"># 2) Redis replicas are able to perform a partial resynchronization with the</span><br><span class=\"line\"># master if the replication link is lost for a relatively small amount of</span><br><span class=\"line\"># time. You may want to configure the replication backlog size (see the next</span><br><span class=\"line\"># sections of this file) with a sensible value depending on your needs.</span><br><span class=\"line\"># 3) Replication is automatic and does not need user intervention. After a</span><br><span class=\"line\"># network partition replicas automatically try to reconnect to masters</span><br><span class=\"line\"># and resynchronize with them.</span><br><span class=\"line\">#</span><br><span class=\"line\"># replicaof &lt;masterip&gt; &lt;masterport&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"># If the master is password protected (using the &quot;requirepass&quot; configuration</span><br><span class=\"line\"># directive below) it is possible to tell the replica to authenticate before</span><br><span class=\"line\"># starting the replication synchronization process, otherwise the master will</span><br><span class=\"line\"># refuse the replica request.</span><br><span class=\"line\">#</span><br><span class=\"line\"># masterauth &lt;master-password&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"># When a replica loses its connection with the master, or when the replication</span><br><span class=\"line\"># is still in progress, the replica can act in two different ways:</span><br><span class=\"line\">#</span><br><span class=\"line\"># 1) if replica-serve-stale-data is set to &#39;yes&#39; (the default) the replica will</span><br><span class=\"line\"># still reply to client requests, possibly with out of date data, or the</span><br><span class=\"line\"># data set may just be empty if this is the first synchronization.</span><br><span class=\"line\">#</span><br><span class=\"line\"># 2) if replica-serve-stale-data is set to &#39;no&#39; the replica will reply with</span><br><span class=\"line\"># an error &quot;SYNC with master in progress&quot; to all the kind of commands</span><br><span class=\"line\"># but to INFO, replicaOF, AUTH, PING, SHUTDOWN, REPLCONF, ROLE, CONFIG,</span><br><span class=\"line\"># SUBSCRIBE, UNSUBSCRIBE, PSUBSCRIBE, PUNSUBSCRIBE, PUBLISH, PUBSUB,</span><br><span class=\"line\"># COMMAND, POST, HOST: and LATENCY.</span><br><span class=\"line\">#</span><br><span class=\"line\">replica-serve-stale-data yes</span><br><span class=\"line\"></span><br><span class=\"line\"># You can configure a replica instance to accept writes or not. Writing against</span><br><span class=\"line\"># a replica instance may be useful to store some ephemeral data (because data</span><br><span class=\"line\"># written on a replica will be easily deleted after resync with the master) but</span><br><span class=\"line\"># may also cause problems if clients are writing to it because of a</span><br><span class=\"line\"># misconfiguration.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Since Redis 2.6 by default replicas are read-only.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Note: read only replicas are not designed to be exposed to untrusted clients</span><br><span class=\"line\"># on the internet. It&#39;s just a protection layer against misuse of the instance.</span><br><span class=\"line\"># Still a read only replica exports by default all the administrative commands</span><br><span class=\"line\"># such as CONFIG, DEBUG, and so forth. To a limited extent you can improve</span><br><span class=\"line\"># security of read only replicas using &#39;rename-command&#39; to shadow all the</span><br><span class=\"line\"># administrative &#x2F; dangerous commands.</span><br><span class=\"line\">replica-read-only yes</span><br><span class=\"line\"></span><br><span class=\"line\"># Replication SYNC strategy: disk or socket.</span><br><span class=\"line\">#</span><br><span class=\"line\"># -------------------------------------------------------</span><br><span class=\"line\"># WARNING: DISKLESS REPLICATION IS EXPERIMENTAL CURRENTLY</span><br><span class=\"line\"># -------------------------------------------------------</span><br><span class=\"line\">#</span><br><span class=\"line\"># New replicas and reconnecting replicas that are not able to continue the replication</span><br><span class=\"line\"># process just receiving differences, need to do what is called a &quot;full</span><br><span class=\"line\"># synchronization&quot;. An RDB file is transmitted from the master to the replicas.</span><br><span class=\"line\"># The transmission can happen in two different ways:</span><br><span class=\"line\">#</span><br><span class=\"line\"># 1) Disk-backed: The Redis master creates a new process that writes the RDB</span><br><span class=\"line\"># file on disk. Later the file is transferred by the parent</span><br><span class=\"line\"># process to the replicas incrementally.</span><br><span class=\"line\"># 2) Diskless: The Redis master creates a new process that directly writes the</span><br><span class=\"line\"># RDB file to replica sockets, without touching the disk at all.</span><br><span class=\"line\">#</span><br><span class=\"line\">#</span><br><span class=\"line\">#</span><br><span class=\"line\">#</span><br><span class=\"line\">#</span><br><span class=\"line\">#</span><br><span class=\"line\">#</span><br><span class=\"line\">#</span><br><span class=\"line\">#</span><br><span class=\"line\">#</span><br><span class=\"line\">#</span><br><span class=\"line\">#</span><br><span class=\"line\">#</span><br><span class=\"line\">#</span><br><span class=\"line\"># With disk-backed replication, while the RDB file is generated, more replicas</span><br><span class=\"line\"># can be queued and served with the RDB file as soon as the current child producing</span><br><span class=\"line\"># the RDB file finishes its work. With diskless replication instead once</span><br><span class=\"line\"># the transfer starts, new replicas arriving will be queued and a new transfer</span><br><span class=\"line\"># will start when the current one terminates.</span><br><span class=\"line\">#</span><br><span class=\"line\"># When diskless replication is used, the master waits a configurable amount of</span><br><span class=\"line\"># time (in seconds) before starting the transfer in the hope that multiple replicas</span><br><span class=\"line\"># will arrive and the transfer can be parallelized.</span><br><span class=\"line\">#</span><br><span class=\"line\"># With slow disks and fast (large bandwidth) networks, diskless replication</span><br><span class=\"line\"># works better.</span><br><span class=\"line\">repl-diskless-sync no</span><br><span class=\"line\"></span><br><span class=\"line\"># When diskless replication is enabled, it is possible to configure the delay</span><br><span class=\"line\"># the server waits in order to spawn the child that transfers the RDB via socket</span><br><span class=\"line\"># to the replicas.</span><br><span class=\"line\">#</span><br><span class=\"line\"># This is important since once the transfer starts, it is not possible to serve</span><br><span class=\"line\"># new replicas arriving, that will be queued for the next RDB transfer, so the server</span><br><span class=\"line\"># waits a delay in order to let more replicas arrive.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The delay is specified in seconds, and by default is 5 seconds. To disable</span><br><span class=\"line\"># it entirely just set it to 0 seconds and the transfer will start ASAP.</span><br><span class=\"line\">repl-diskless-sync-delay 5</span><br><span class=\"line\"></span><br><span class=\"line\"># Replicas send PINGs to server in a predefined interval. It&#39;s possible to change</span><br><span class=\"line\"># this interval with the repl_ping_replica_period option. The default value is 10</span><br><span class=\"line\"># seconds.</span><br><span class=\"line\">#</span><br><span class=\"line\"># repl-ping-replica-period 10</span><br><span class=\"line\"></span><br><span class=\"line\"># The following option sets the replication timeout for:</span><br><span class=\"line\">#</span><br><span class=\"line\"># 1) Bulk transfer I&#x2F;O during SYNC, from the point of view of replica.</span><br><span class=\"line\"># 2) Master timeout from the point of view of replicas (data, pings).</span><br><span class=\"line\"># 3) Replica timeout from the point of view of masters (REPLCONF ACK pings).</span><br><span class=\"line\">#</span><br><span class=\"line\"># It is important to make sure that this value is greater than the value</span><br><span class=\"line\"># specified for repl-ping-replica-period otherwise a timeout will be detected</span><br><span class=\"line\"># every time there is low traffic between the master and the replica.</span><br><span class=\"line\">#</span><br><span class=\"line\"># repl-timeout 60</span><br><span class=\"line\"></span><br><span class=\"line\"># Disable TCP_NODELAY on the replica socket after SYNC?</span><br><span class=\"line\">#</span><br><span class=\"line\"># If you select &quot;yes&quot; Redis will use a smaller number of TCP packets and</span><br><span class=\"line\"># less bandwidth to send data to replicas. But this can add a delay for</span><br><span class=\"line\"># the data to appear on the replica side, up to 40 milliseconds with</span><br><span class=\"line\"># Linux kernels using a default configuration.</span><br><span class=\"line\">#</span><br><span class=\"line\"># If you select &quot;no&quot; the delay for data to appear on the replica side will</span><br><span class=\"line\"># be reduced but more bandwidth will be used for replication.</span><br><span class=\"line\">#</span><br><span class=\"line\"># By default we optimize for low latency, but in very high traffic conditions</span><br><span class=\"line\"># or when the master and replicas are many hops away, turning this to &quot;yes&quot; may</span><br><span class=\"line\"># be a good idea.</span><br><span class=\"line\">repl-disable-tcp-nodelay no</span><br><span class=\"line\"></span><br><span class=\"line\"># Set the replication backlog size. The backlog is a buffer that accumulates</span><br><span class=\"line\"># replica data when replicas are disconnected for some time, so that when a replica</span><br><span class=\"line\"># wants to reconnect again, often a full resync is not needed, but a partial</span><br><span class=\"line\"># resync is enough, just passing the portion of data the replica missed while</span><br><span class=\"line\"># disconnected.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The bigger the replication backlog, the longer the time the replica can be</span><br><span class=\"line\"># disconnected and later be able to perform a partial resynchronization.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The backlog is only allocated once there is at least a replica connected.</span><br><span class=\"line\">#</span><br><span class=\"line\"># repl-backlog-size 1mb</span><br><span class=\"line\"></span><br><span class=\"line\"># After a master has no longer connected replicas for some time, the backlog</span><br><span class=\"line\"># will be freed. The following option configures the amount of seconds that</span><br><span class=\"line\"># need to elapse, starting from the time the last replica disconnected, for</span><br><span class=\"line\"># the backlog buffer to be freed.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Note that replicas never free the backlog for timeout, since they may be</span><br><span class=\"line\"># promoted to masters later, and should be able to correctly &quot;partially</span><br><span class=\"line\"># resynchronize&quot; with the replicas: hence they should always accumulate backlog.</span><br><span class=\"line\">#</span><br><span class=\"line\"># A value of 0 means to never release the backlog.</span><br><span class=\"line\">#</span><br><span class=\"line\"># repl-backlog-ttl 3600</span><br><span class=\"line\"></span><br><span class=\"line\"># The replica priority is an integer number published by Redis in the INFO output.</span><br><span class=\"line\"># It is used by Redis Sentinel in order to select a replica to promote into a</span><br><span class=\"line\"># master if the master is no longer working correctly.</span><br><span class=\"line\">#</span><br><span class=\"line\"># A replica with a low priority number is considered better for promotion, so</span><br><span class=\"line\"># for instance if there are three replicas with priority 10, 100, 25 Sentinel will</span><br><span class=\"line\"># pick the one with priority 10, that is the lowest.</span><br><span class=\"line\">#</span><br><span class=\"line\"># However a special priority of 0 marks the replica as not able to perform the</span><br><span class=\"line\"># role of master, so a replica with priority of 0 will never be selected by</span><br><span class=\"line\"># Redis Sentinel for promotion.</span><br><span class=\"line\">#</span><br><span class=\"line\"># By default the priority is 100.</span><br><span class=\"line\">replica-priority 100</span><br><span class=\"line\"></span><br><span class=\"line\"># It is possible for a master to stop accepting writes if there are less than</span><br><span class=\"line\"># N replicas connected, having a lag less or equal than M seconds.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The N replicas need to be in &quot;online&quot; state.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The lag in seconds, that must be &lt;&#x3D; the specified value, is calculated from</span><br><span class=\"line\"># the last ping received from the replica, that is usually sent every second.</span><br><span class=\"line\">#</span><br><span class=\"line\"># This option does not GUARANTEE that N replicas will accept the write, but</span><br><span class=\"line\"># will limit the window of exposure for lost writes in case not enough replicas</span><br><span class=\"line\"># are available, to the specified number of seconds.</span><br><span class=\"line\">#</span><br><span class=\"line\"># For example to require at least 3 replicas with a lag &lt;&#x3D; 10 seconds use:</span><br><span class=\"line\">#</span><br><span class=\"line\"># min-replicas-to-write 3</span><br><span class=\"line\"># min-replicas-max-lag 10</span><br><span class=\"line\">#</span><br><span class=\"line\"># Setting one or the other to 0 disables the feature.</span><br><span class=\"line\">#</span><br><span class=\"line\"># By default min-replicas-to-write is set to 0 (feature disabled) and</span><br><span class=\"line\"># min-replicas-max-lag is set to 10.</span><br><span class=\"line\"></span><br><span class=\"line\"># A Redis master is able to list the address and port of the attached</span><br><span class=\"line\"># replicas in different ways. For example the &quot;INFO replication&quot; section</span><br><span class=\"line\"># offers this information, which is used, among other tools, by</span><br><span class=\"line\"># Redis Sentinel in order to discover replica instances.</span><br><span class=\"line\"># Another place where this info is available is in the output of the</span><br><span class=\"line\"># &quot;ROLE&quot; command of a master.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The listed IP and address normally reported by a replica is obtained</span><br><span class=\"line\"># in the following way:</span><br><span class=\"line\">#</span><br><span class=\"line\"># IP: The address is auto detected by checking the peer address</span><br><span class=\"line\"># of the socket used by the replica to connect with the master.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Port: The port is communicated by the replica during the replication</span><br><span class=\"line\"># handshake, and is normally the port that the replica is using to</span><br><span class=\"line\"># listen for connections.</span><br><span class=\"line\">#</span><br><span class=\"line\"># However when port forwarding or Network Address Translation (NAT) is</span><br><span class=\"line\"># used, the replica may be actually reachable via different IP and port</span><br><span class=\"line\"># pairs. The following two options can be used by a replica in order to</span><br><span class=\"line\"># report to its master a specific set of IP and port, so that both INFO</span><br><span class=\"line\"># and ROLE will report those values.</span><br><span class=\"line\">#</span><br><span class=\"line\"># There is no need to use both the options if you need to override just</span><br><span class=\"line\"># the port or the IP address.</span><br><span class=\"line\">#</span><br><span class=\"line\"># replica-announce-ip 5.5.5.5</span><br><span class=\"line\"># replica-announce-port 1234</span><br><span class=\"line\"></span><br><span class=\"line\">################################## SECURITY ###################################</span><br><span class=\"line\"></span><br><span class=\"line\"># Require clients to issue AUTH &lt;PASSWORD&gt; before processing any other</span><br><span class=\"line\"># commands. This might be useful in environments in which you do not trust</span><br><span class=\"line\"># others with access to the host running redis-server.</span><br><span class=\"line\">#</span><br><span class=\"line\"># This should stay commented out for backward compatibility and because most</span><br><span class=\"line\"># people do not need auth (e.g. they run their own servers).</span><br><span class=\"line\">#</span><br><span class=\"line\"># Warning: since Redis is pretty fast an outside user can try up to</span><br><span class=\"line\"># 150k passwords per second against a good box. This means that you should</span><br><span class=\"line\"># use a very strong password otherwise it will be very easy to break.</span><br><span class=\"line\">#</span><br><span class=\"line\"># requirepass foobared</span><br><span class=\"line\"></span><br><span class=\"line\"># Command renaming.</span><br><span class=\"line\">#</span><br><span class=\"line\"># It is possible to change the name of dangerous commands in a shared</span><br><span class=\"line\"># environment. For instance the CONFIG command may be renamed into something</span><br><span class=\"line\"># hard to guess so that it will still be available for internal-use tools</span><br><span class=\"line\"># but not available for general clients.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Example:</span><br><span class=\"line\">#</span><br><span class=\"line\"># rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</span><br><span class=\"line\">#</span><br><span class=\"line\"># It is also possible to completely kill a command by renaming it into</span><br><span class=\"line\"># an empty string:</span><br><span class=\"line\">#</span><br><span class=\"line\"># rename-command CONFIG &quot;&quot;</span><br><span class=\"line\">#</span><br><span class=\"line\"># Please note that changing the name of commands that are logged into the</span><br><span class=\"line\"># AOF file or transmitted to replicas may cause problems.</span><br><span class=\"line\"></span><br><span class=\"line\">################################### CLIENTS ####################################</span><br><span class=\"line\"></span><br><span class=\"line\"># Set the max number of connected clients at the same time. By default</span><br><span class=\"line\"># this limit is set to 10000 clients, however if the Redis server is not</span><br><span class=\"line\"># able to configure the process file limit to allow for the specified limit</span><br><span class=\"line\"># the max number of allowed clients is set to the current file limit</span><br><span class=\"line\"># minus 32 (as Redis reserves a few file descriptors for internal uses).</span><br><span class=\"line\">#</span><br><span class=\"line\"># Once the limit is reached Redis will close all the new connections sending</span><br><span class=\"line\"># an error &#39;max number of clients reached&#39;.</span><br><span class=\"line\">#</span><br><span class=\"line\"># maxclients 10000</span><br><span class=\"line\"></span><br><span class=\"line\">############################## MEMORY MANAGEMENT ################################</span><br><span class=\"line\"></span><br><span class=\"line\"># Set a memory usage limit to the specified amount of bytes.</span><br><span class=\"line\"># When the memory limit is reached Redis will try to remove keys</span><br><span class=\"line\"># according to the eviction policy selected (see maxmemory-policy).</span><br><span class=\"line\">#</span><br><span class=\"line\"># If Redis can&#39;t remove keys according to the policy, or if the policy is</span><br><span class=\"line\"># set to &#39;noeviction&#39;, Redis will start to reply with errors to commands</span><br><span class=\"line\"># that would use more memory, like SET, LPUSH, and so on, and will continue</span><br><span class=\"line\"># to reply to read-only commands like GET.</span><br><span class=\"line\">#</span><br><span class=\"line\"># This option is usually useful when using Redis as an LRU or LFU cache, or to</span><br><span class=\"line\"># set a hard memory limit for an instance (using the &#39;noeviction&#39; policy).</span><br><span class=\"line\">#</span><br><span class=\"line\"># WARNING: If you have replicas attached to an instance with maxmemory on,</span><br><span class=\"line\"># the size of the output buffers needed to feed the replicas are subtracted</span><br><span class=\"line\"># from the used memory count, so that network problems &#x2F; resyncs will</span><br><span class=\"line\"># not trigger a loop where keys are evicted, and in turn the output</span><br><span class=\"line\"># buffer of replicas is full with DELs of keys evicted triggering the deletion</span><br><span class=\"line\"># of more keys, and so forth until the database is completely emptied.</span><br><span class=\"line\">#</span><br><span class=\"line\"># In short... if you have replicas attached it is suggested that you set a lower</span><br><span class=\"line\"># limit for maxmemory so that there is some free RAM on the system for replica</span><br><span class=\"line\"># output buffers (but this is not needed if the policy is &#39;noeviction&#39;).</span><br><span class=\"line\">#</span><br><span class=\"line\"># maxmemory &lt;bytes&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"># MAXMEMORY POLICY: how Redis will select what to remove when maxmemory</span><br><span class=\"line\"># is reached. You can select among five behaviors:</span><br><span class=\"line\">#</span><br><span class=\"line\"># volatile-lru -&gt; Evict using approximated LRU among the keys with an expire set.</span><br><span class=\"line\"># allkeys-lru -&gt; Evict any key using approximated LRU.</span><br><span class=\"line\"># volatile-lfu -&gt; Evict using approximated LFU among the keys with an expire set.</span><br><span class=\"line\"># allkeys-lfu -&gt; Evict any key using approximated LFU.</span><br><span class=\"line\"># volatile-random -&gt; Remove a random key among the ones with an expire set.</span><br><span class=\"line\"></span><br><span class=\"line\"># noeviction -&gt; Don&#39;t evict anything, just return an error on write operations.</span><br><span class=\"line\">#</span><br><span class=\"line\"># LRU means Least Recently Used</span><br><span class=\"line\"># LFU means Least Frequently Used</span><br><span class=\"line\">#</span><br><span class=\"line\"># Both LRU, LFU and volatile-ttl are implemented using approximated</span><br><span class=\"line\"># randomized algorithms.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Note: with any of the above policies, Redis will return an error on write</span><br><span class=\"line\"># operations, when there are no suitable keys for eviction.</span><br><span class=\"line\">#</span><br><span class=\"line\"># At the date of writing these commands are: set setnx setex append</span><br><span class=\"line\"># incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd</span><br><span class=\"line\"># sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby</span><br><span class=\"line\"># zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby</span><br><span class=\"line\"># getset mset msetnx exec sort</span><br><span class=\"line\">#</span><br><span class=\"line\"># The default is:</span><br><span class=\"line\">#</span><br><span class=\"line\"># maxmemory-policy noeviction</span><br><span class=\"line\"></span><br><span class=\"line\"># LRU, LFU and minimal TTL algorithms are not precise algorithms but approximated</span><br><span class=\"line\"># algorithms (in order to save memory), so you can tune it for speed or</span><br><span class=\"line\"># accuracy. For default Redis will check five keys and pick the one that was</span><br><span class=\"line\"># used less recently, you can change the sample size using the following</span><br><span class=\"line\"># configuration directive.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The default of 5 produces good enough results. 10 Approximates very closely</span><br><span class=\"line\"># true LRU but costs more CPU. 3 is faster but not very accurate.</span><br><span class=\"line\">#</span><br><span class=\"line\"># maxmemory-samples 5</span><br><span class=\"line\"></span><br><span class=\"line\"># Starting from Redis 5, by default a replica will ignore its maxmemory setting</span><br><span class=\"line\"># (unless it is promoted to master after a failover or manually). It means</span><br><span class=\"line\"># that the eviction of keys will be just handled by the master, sending the</span><br><span class=\"line\"># DEL commands to the replica as keys evict in the master side.</span><br><span class=\"line\">#</span><br><span class=\"line\"># This behavior ensures that masters and replicas stay consistent, and is usually</span><br><span class=\"line\"># what you want, however if your replica is writable, or you want the replica to have</span><br><span class=\"line\"># a different memory setting, and you are sure all the writes performed to the</span><br><span class=\"line\"># replica are idempotent, then you may change this default (but be sure to understand</span><br><span class=\"line\"># what you are doing).</span><br><span class=\"line\">#</span><br><span class=\"line\"># Note that since the replica by default does not evict, it may end using more</span><br><span class=\"line\"># memory than the one set via maxmemory (there are certain buffers that may</span><br><span class=\"line\"># be larger on the replica, or data structures may sometimes take more memory and so</span><br><span class=\"line\"># forth). So make sure you monitor your replicas and make sure they have enough</span><br><span class=\"line\"># memory to never hit a real out-of-memory condition before the master hits</span><br><span class=\"line\"># the configured maxmemory setting.</span><br><span class=\"line\">#</span><br><span class=\"line\"># replica-ignore-maxmemory yes</span><br><span class=\"line\"></span><br><span class=\"line\">############################# LAZY FREEING ####################################</span><br><span class=\"line\"></span><br><span class=\"line\"># Redis has two primitives to delete keys. One is called DEL and is a blocking</span><br><span class=\"line\"># deletion of the object. It means that the server stops processing new commands</span><br><span class=\"line\"># in order to reclaim all the memory associated with an object in a synchronous</span><br><span class=\"line\"># way. If the key deleted is associated with a small object, the time needed</span><br><span class=\"line\"># in order to execute the DEL command is very small and comparable to most other</span><br><span class=\"line\"># O(1) or O(log_N) commands in Redis. However if the key is associated with an</span><br><span class=\"line\"># aggregated value containing millions of elements, the server can block for</span><br><span class=\"line\"># a long time (even seconds) in order to complete the operation.</span><br><span class=\"line\">#</span><br><span class=\"line\"># For the above reasons Redis also offers non blocking deletion primitives</span><br><span class=\"line\"># such as UNLINK (non blocking DEL) and the ASYNC option of FLUSHALL and</span><br><span class=\"line\"># FLUSHDB commands, in order to reclaim memory in background. Those commands</span><br><span class=\"line\"># are executed in constant time. Another thread will incrementally free the</span><br><span class=\"line\"># object in the background as fast as possible.</span><br><span class=\"line\">#</span><br><span class=\"line\"># DEL, UNLINK and ASYNC option of FLUSHALL and FLUSHDB are user-controlled.</span><br><span class=\"line\"># It&#39;s up to the design of the application to understand when it is a good</span><br><span class=\"line\"># idea to use one or the other. However the Redis server sometimes has to</span><br><span class=\"line\"># delete keys or flush the whole database as a side effect of other operations.</span><br><span class=\"line\"># Specifically Redis deletes objects independently of a user call in the</span><br><span class=\"line\"># following scenarios:</span><br><span class=\"line\">#</span><br><span class=\"line\"># 1) On eviction, because of the maxmemory and maxmemory policy configurations,</span><br><span class=\"line\"># in order to make room for new data, without going over the specified</span><br><span class=\"line\"># memory limit.</span><br><span class=\"line\"># 2) Because of expire: when a key with an associated time to live (see the</span><br><span class=\"line\"># EXPIRE command) must be deleted from memory.</span><br><span class=\"line\"># 3) Because of a side effect of a command that stores data on a key that may</span><br><span class=\"line\"># already exist. For example the RENAME command may delete the old key</span><br><span class=\"line\"># content when it is replaced with another one. Similarly SUNIONSTORE</span><br><span class=\"line\"># or SORT with STORE option may delete existing keys. The SET command</span><br><span class=\"line\"># itself removes any old content of the specified key in order to replace</span><br><span class=\"line\"># it with the specified string.</span><br><span class=\"line\"># 4) During replication, when a replica performs a full resynchronization with</span><br><span class=\"line\"># its master, the content of the whole database is removed in order to</span><br><span class=\"line\"># load the RDB file just transferred.</span><br><span class=\"line\">#</span><br><span class=\"line\"># In all the above cases the default is to delete objects in a blocking way,</span><br><span class=\"line\"># like if DEL was called. However you can configure each case specifically</span><br><span class=\"line\"># in order to instead release memory in a non-blocking way like if UNLINK</span><br><span class=\"line\"># was called, using the following configuration directives:</span><br><span class=\"line\"></span><br><span class=\"line\">lazyfree-lazy-eviction no</span><br><span class=\"line\">lazyfree-lazy-expire no</span><br><span class=\"line\">lazyfree-lazy-server-del no</span><br><span class=\"line\">replica-lazy-flush no</span><br><span class=\"line\"></span><br><span class=\"line\">############################## APPEND ONLY MODE ###############################</span><br><span class=\"line\"></span><br><span class=\"line\"># By default Redis asynchronously dumps the dataset on disk. This mode is</span><br><span class=\"line\"># good enough in many applications, but an issue with the Redis process or</span><br><span class=\"line\"># a power outage may result into a few minutes of writes lost (depending on</span><br><span class=\"line\"># the configured save points).</span><br><span class=\"line\">#</span><br><span class=\"line\"># The Append Only File is an alternative persistence mode that provides</span><br><span class=\"line\"># much better durability. For instance using the default data fsync policy</span><br><span class=\"line\"># (see later in the config file) Redis can lose just one second of writes in a</span><br><span class=\"line\"># dramatic event like a server power outage, or a single write if something</span><br><span class=\"line\"># wrong with the Redis process itself happens, but the operating system is</span><br><span class=\"line\"># still running correctly.</span><br><span class=\"line\">#</span><br><span class=\"line\"># AOF and RDB persistence can be enabled at the same time without problems.</span><br><span class=\"line\"># If the AOF is enabled on startup Redis will load the AOF, that is the file</span><br><span class=\"line\"># with the better durability guarantees.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Please check http:&#x2F;&#x2F;redis.io&#x2F;topics&#x2F;persistence for more information.</span><br><span class=\"line\"></span><br><span class=\"line\">appendonly no</span><br><span class=\"line\"></span><br><span class=\"line\"># The name of the append only file (default: &quot;appendonly.aof&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">appendfilename &quot;appendonly.aof&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># The fsync() call tells the Operating System to actually write data on disk</span><br><span class=\"line\"># instead of waiting for more data in the output buffer. Some OS will really flush</span><br><span class=\"line\"># data on disk, some other OS will just try to do it ASAP.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Redis supports three different modes:</span><br><span class=\"line\">#</span><br><span class=\"line\"># no: don&#39;t fsync, just let the OS flush the data when it wants. Faster.</span><br><span class=\"line\"># always: fsync after every write to the append only log. Slow, Safest.</span><br><span class=\"line\"># everysec: fsync only one time every second. Compromise.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The default is &quot;everysec&quot;, as that&#39;s usually the right compromise between</span><br><span class=\"line\"># speed and data safety. It&#39;s up to you to understand if you can relax this to</span><br><span class=\"line\"># &quot;no&quot; that will let the operating system flush the output buffer when</span><br><span class=\"line\"># it wants, for better performances (but if you can live with the idea of</span><br><span class=\"line\"># some data loss consider the default persistence mode that&#39;s snapshotting),</span><br><span class=\"line\"># or on the contrary, use &quot;always&quot; that&#39;s very slow but a bit safer than</span><br><span class=\"line\"># everysec.</span><br><span class=\"line\">#</span><br><span class=\"line\"># More details please check the following article:</span><br><span class=\"line\"># http:&#x2F;&#x2F;antirez.com&#x2F;post&#x2F;redis-persistence-demystified.html</span><br><span class=\"line\">#</span><br><span class=\"line\"># If unsure, use &quot;everysec&quot;.</span><br><span class=\"line\"></span><br><span class=\"line\"># appendfsync always</span><br><span class=\"line\">appendfsync everysec</span><br><span class=\"line\"># appendfsync no</span><br><span class=\"line\"></span><br><span class=\"line\"># When the AOF fsync policy is set to always or everysec, and a background</span><br><span class=\"line\"># saving process (a background save or AOF log background rewriting) is</span><br><span class=\"line\"># performing a lot of I&#x2F;O against the disk, in some Linux configurations</span><br><span class=\"line\"># Redis may block too long on the fsync() call. Note that there is no fix for</span><br><span class=\"line\"># this currently, as even performing fsync in a different thread will block</span><br><span class=\"line\"># our synchronous write(2) call.</span><br><span class=\"line\">#</span><br><span class=\"line\"># In order to mitigate this problem it&#39;s possible to use the following option</span><br><span class=\"line\"># that will prevent fsync() from being called in the main process while a</span><br><span class=\"line\"># BGSAVE or BGREWRITEAOF is in progress.</span><br><span class=\"line\">#</span><br><span class=\"line\"># This means that while another child is saving, the durability of Redis is</span><br><span class=\"line\"># the same as &quot;appendfsync none&quot;. In practical terms, this means that it is</span><br><span class=\"line\"># possible to lose up to 30 seconds of log in the worst scenario (with the</span><br><span class=\"line\"># default Linux settings).</span><br><span class=\"line\">#</span><br><span class=\"line\"># If you have latency problems turn this to &quot;yes&quot;. Otherwise leave it as</span><br><span class=\"line\"># &quot;no&quot; that is the safest pick from the point of view of durability.</span><br><span class=\"line\"></span><br><span class=\"line\">no-appendfsync-on-rewrite no</span><br><span class=\"line\"></span><br><span class=\"line\"># Automatic rewrite of the append only file.</span><br><span class=\"line\"># Redis is able to automatically rewrite the log file implicitly calling</span><br><span class=\"line\"># BGREWRITEAOF when the AOF log size grows by the specified percentage.</span><br><span class=\"line\">#</span><br><span class=\"line\"># This is how it works: Redis remembers the size of the AOF file after the</span><br><span class=\"line\"># latest rewrite (if no rewrite has happened since the restart, the size of</span><br><span class=\"line\"># the AOF at startup is used).</span><br><span class=\"line\">#</span><br><span class=\"line\"># This base size is compared to the current size. If the current size is</span><br><span class=\"line\"># bigger than the specified percentage, the rewrite is triggered. Also</span><br><span class=\"line\"># you need to specify a minimal size for the AOF file to be rewritten, this</span><br><span class=\"line\"># is useful to avoid rewriting the AOF file even if the percentage increase</span><br><span class=\"line\"># is reached but it is still pretty small.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Specify a percentage of zero in order to disable the automatic AOF</span><br><span class=\"line\"># rewrite feature.</span><br><span class=\"line\"></span><br><span class=\"line\">auto-aof-rewrite-percentage 100</span><br><span class=\"line\">auto-aof-rewrite-min-size 64mb</span><br><span class=\"line\"></span><br><span class=\"line\"># An AOF file may be found to be truncated at the end during the Redis</span><br><span class=\"line\"># startup process, when the AOF data gets loaded back into memory.</span><br><span class=\"line\"># This may happen when the system where Redis is running</span><br><span class=\"line\"># crashes, especially when an ext4 filesystem is mounted without the</span><br><span class=\"line\"># data&#x3D;ordered option (however this can&#39;t happen when Redis itself</span><br><span class=\"line\"># crashes or aborts but the operating system still works correctly).</span><br><span class=\"line\">#</span><br><span class=\"line\"># Redis can either exit with an error when this happens, or load as much</span><br><span class=\"line\"># data as possible (the default now) and start if the AOF file is found</span><br><span class=\"line\"># to be truncated at the end. The following option controls this behavior.</span><br><span class=\"line\">#</span><br><span class=\"line\"># If aof-load-truncated is set to yes, a truncated AOF file is loaded and</span><br><span class=\"line\"># the Redis server starts emitting a log to inform the user of the event.</span><br><span class=\"line\"># Otherwise if the option is set to no, the server aborts with an error</span><br><span class=\"line\"># and refuses to start. When the option is set to no, the user requires</span><br><span class=\"line\"># to fix the AOF file using the &quot;redis-check-aof&quot; utility before to restart</span><br><span class=\"line\"># the server.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Note that if the AOF file will be found to be corrupted in the middle</span><br><span class=\"line\"># the server will still exit with an error. This option only applies when</span><br><span class=\"line\"># Redis will try to read more data from the AOF file but not enough bytes</span><br><span class=\"line\"># will be found.</span><br><span class=\"line\">aof-load-truncated yes</span><br><span class=\"line\"></span><br><span class=\"line\"># When rewriting the AOF file, Redis is able to use an RDB preamble in the</span><br><span class=\"line\"># AOF file for faster rewrites and recoveries. When this option is turned</span><br><span class=\"line\"># on the rewritten AOF file is composed of two different stanzas:</span><br><span class=\"line\">#</span><br><span class=\"line\"># [RDB file][AOF tail]</span><br><span class=\"line\">#</span><br><span class=\"line\"># When loading Redis recognizes that the AOF file starts with the &quot;REDIS&quot;</span><br><span class=\"line\"># string and loads the prefixed RDB file, and continues loading the AOF</span><br><span class=\"line\"># tail.</span><br><span class=\"line\">aof-use-rdb-preamble yes</span><br><span class=\"line\"></span><br><span class=\"line\">################################ LUA SCRIPTING ###############################</span><br><span class=\"line\"></span><br><span class=\"line\"># Max execution time of a Lua script in milliseconds.</span><br><span class=\"line\">#</span><br><span class=\"line\"># If the maximum execution time is reached Redis will log that a script is</span><br><span class=\"line\"># still in execution after the maximum allowed time and will start to</span><br><span class=\"line\"># reply to queries with an error.</span><br><span class=\"line\">#</span><br><span class=\"line\"># When a long running script exceeds the maximum execution time only the</span><br><span class=\"line\"># SCRIPT KILL and SHUTDOWN NOSAVE commands are available. The first can be</span><br><span class=\"line\"># used to stop a script that did not yet called write commands. The second</span><br><span class=\"line\"># is the only way to shut down the server in the case a write command was</span><br><span class=\"line\"># already issued by the script but the user doesn&#39;t want to wait for the natural</span><br><span class=\"line\"># termination of the script.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Set it to 0 or a negative value for unlimited execution without warnings.</span><br><span class=\"line\">lua-time-limit 5000</span><br><span class=\"line\"></span><br><span class=\"line\">################################ REDIS CLUSTER ###############################</span><br><span class=\"line\"></span><br><span class=\"line\"># Normal Redis instances can&#39;t be part of a Redis Cluster; only nodes that are</span><br><span class=\"line\"># started as cluster nodes can. In order to start a Redis instance as a</span><br><span class=\"line\"># cluster node enable the cluster support uncommenting the following:</span><br><span class=\"line\">#</span><br><span class=\"line\">cluster-enabled yes</span><br><span class=\"line\"></span><br><span class=\"line\"># Every cluster node has a cluster configuration file. This file is not</span><br><span class=\"line\"># intended to be edited by hand. It is created and updated by Redis nodes.</span><br><span class=\"line\"># Every Redis Cluster node requires a different cluster configuration file.</span><br><span class=\"line\"># Make sure that instances running in the same system do not have</span><br><span class=\"line\"># overlapping cluster configuration file names.</span><br><span class=\"line\">#</span><br><span class=\"line\">cluster-config-file nodes-6379.conf</span><br><span class=\"line\"># Cluster node timeout is the amount of milliseconds a node must be unreachable</span><br><span class=\"line\"># for it to be considered in failure state.</span><br><span class=\"line\"># Most other internal time limits are multiple of the node timeout.</span><br><span class=\"line\">#</span><br><span class=\"line\">cluster-node-timeout 15000</span><br><span class=\"line\"></span><br><span class=\"line\"># A replica of a failing master will avoid to start a failover if its data</span><br><span class=\"line\"># looks too old.</span><br><span class=\"line\">#</span><br><span class=\"line\"># There is no simple way for a replica to actually have an exact measure of</span><br><span class=\"line\"># its &quot;data age&quot;, so the following two checks are performed:</span><br><span class=\"line\">#</span><br><span class=\"line\"># 1) If there are multiple replicas able to failover, they exchange messages</span><br><span class=\"line\"># in order to try to give an advantage to the replica with the best</span><br><span class=\"line\"># replication offset (more data from the master processed).</span><br><span class=\"line\"># Replicas will try to get their rank by offset, and apply to the start</span><br><span class=\"line\"># of the failover a delay proportional to their rank.</span><br><span class=\"line\">#</span><br><span class=\"line\"># 2) Every single replica computes the time of the last interaction with</span><br><span class=\"line\"># its master. This can be the last ping or command received (if the master</span><br><span class=\"line\"># is still in the &quot;connected&quot; state), or the time that elapsed since the</span><br><span class=\"line\"># disconnection with the master (if the replication link is currently down).</span><br><span class=\"line\"># If the last interaction is too old, the replica will not try to failover</span><br><span class=\"line\"># at all.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The point &quot;2&quot; can be tuned by user. Specifically a replica will not perform</span><br><span class=\"line\"># the failover if, since the last interaction with the master, the time</span><br><span class=\"line\"># elapsed is greater than:</span><br><span class=\"line\">#</span><br><span class=\"line\"># (node-timeout * replica-validity-factor) + repl-ping-replica-period</span><br><span class=\"line\">#</span><br><span class=\"line\"># So for example if node-timeout is 30 seconds, and the replica-validity-factor</span><br><span class=\"line\"># is 10, and assuming a default repl-ping-replica-period of 10 seconds, the</span><br><span class=\"line\"># replica will not try to failover if it was not able to talk with the master</span><br><span class=\"line\"># for longer than 310 seconds.</span><br><span class=\"line\">#</span><br><span class=\"line\"># A large replica-validity-factor may allow replicas with too old data to failover</span><br><span class=\"line\"># a master, while a too small value may prevent the cluster from being able to</span><br><span class=\"line\"># elect a replica at all.</span><br><span class=\"line\">#</span><br><span class=\"line\"># For maximum availability, it is possible to set the replica-validity-factor</span><br><span class=\"line\"># to a value of 0, which means, that replicas will always try to failover the</span><br><span class=\"line\"># master regardless of the last time they interacted with the master.</span><br><span class=\"line\"># (However they&#39;ll always try to apply a delay proportional to their</span><br><span class=\"line\"># offset rank).</span><br><span class=\"line\">#</span><br><span class=\"line\"># Zero is the only value able to guarantee that when all the partitions heal</span><br><span class=\"line\"># the cluster will always be able to continue.</span><br><span class=\"line\">#</span><br><span class=\"line\"># cluster-replica-validity-factor 10</span><br><span class=\"line\"></span><br><span class=\"line\"># Cluster replicas are able to migrate to orphaned masters, that are masters</span><br><span class=\"line\"># that are left without working replicas. This improves the cluster ability</span><br><span class=\"line\"># to resist to failures as otherwise an orphaned master can&#39;t be failed over</span><br><span class=\"line\"># in case of failure if it has no working replicas.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Replicas migrate to orphaned masters only if there are still at least a</span><br><span class=\"line\"># given number of other working replicas for their old master. This number</span><br><span class=\"line\"># is the &quot;migration barrier&quot;. A migration barrier of 1 means that a replica</span><br><span class=\"line\"># will migrate only if there is at least 1 other working replica for its master</span><br><span class=\"line\"># and so forth. It usually reflects the number of replicas you want for every</span><br><span class=\"line\"># master in your cluster.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Default is 1 (replicas migrate only if their masters remain with at least</span><br><span class=\"line\"># one replica). To disable migration just set it to a very large value.</span><br><span class=\"line\"># A value of 0 can be set but is useful only for debugging and dangerous</span><br><span class=\"line\"># in production.</span><br><span class=\"line\">#</span><br><span class=\"line\"># cluster-migration-barrier 1</span><br><span class=\"line\"></span><br><span class=\"line\"># By default Redis Cluster nodes stop accepting queries if they detect there</span><br><span class=\"line\"># is at least an hash slot uncovered (no available node is serving it).</span><br><span class=\"line\"># This way if the cluster is partially down (for example a range of hash slots</span><br><span class=\"line\"># are no longer covered) all the cluster becomes, eventually, unavailable.</span><br><span class=\"line\"># It automatically returns available as soon as all the slots are covered again.</span><br><span class=\"line\">#</span><br><span class=\"line\"># However sometimes you want the subset of the cluster which is working,</span><br><span class=\"line\"># to continue to accept queries for the part of the key space that is still</span><br><span class=\"line\"># covered. In order to do so, just set the cluster-require-full-coverage</span><br><span class=\"line\"># option to no.</span><br><span class=\"line\">#</span><br><span class=\"line\"># cluster-require-full-coverage yes</span><br><span class=\"line\"></span><br><span class=\"line\"># This option, when set to yes, prevents replicas from trying to failover its</span><br><span class=\"line\"># master during master failures. However the master can still perform a</span><br><span class=\"line\"># manual failover, if forced to do so.</span><br><span class=\"line\">#</span><br><span class=\"line\"># This is useful in different scenarios, especially in the case of multiple</span><br><span class=\"line\"># data center operations, where we want one side to never be promoted if not</span><br><span class=\"line\"># in the case of a total DC failure.</span><br><span class=\"line\">#</span><br><span class=\"line\"># cluster-replica-no-failover no</span><br><span class=\"line\"></span><br><span class=\"line\"># In order to setup your cluster make sure to read the documentation</span><br><span class=\"line\"># available at http:&#x2F;&#x2F;redis.io web site.</span><br><span class=\"line\"></span><br><span class=\"line\">########################## CLUSTER DOCKER&#x2F;NAT support ########################</span><br><span class=\"line\"></span><br><span class=\"line\"># In certain deployments, Redis Cluster nodes address discovery fails, because</span><br><span class=\"line\"># addresses are NAT-ted or because ports are forwarded (the typical case is</span><br><span class=\"line\"># Docker and other containers).</span><br><span class=\"line\">#</span><br><span class=\"line\"># In order to make Redis Cluster working in such environments, a static</span><br><span class=\"line\"># configuration where each node knows its public address is needed. The</span><br><span class=\"line\"># following two options are used for this scope, and are:</span><br><span class=\"line\">#</span><br><span class=\"line\"># * cluster-announce-ip</span><br><span class=\"line\"># * cluster-announce-port</span><br><span class=\"line\"># * cluster-announce-bus-port</span><br><span class=\"line\">#</span><br><span class=\"line\"># Each instruct the node about its address, client port, and cluster message</span><br><span class=\"line\"># bus port. The information is then published in the header of the bus packets</span><br><span class=\"line\"># so that other nodes will be able to correctly map the address of the node</span><br><span class=\"line\"># publishing the information.</span><br><span class=\"line\">#</span><br><span class=\"line\"># If the above options are not used, the normal Redis Cluster auto-detection</span><br><span class=\"line\"># will be used instead.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Note that when remapped, the bus port may not be at the fixed offset of</span><br><span class=\"line\"># clients port + 10000, so you can specify any port and bus-port depending</span><br><span class=\"line\"># on how they get remapped. If the bus-port is not set, a fixed offset of</span><br><span class=\"line\"># 10000 will be used as usually.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Example:</span><br><span class=\"line\">#</span><br><span class=\"line\"># cluster-announce-ip 10.1.1.5</span><br><span class=\"line\"># cluster-announce-port 6379</span><br><span class=\"line\"># cluster-announce-bus-port 6380</span><br><span class=\"line\"></span><br><span class=\"line\">################################## SLOW LOG ###################################</span><br><span class=\"line\"></span><br><span class=\"line\"># The Redis Slow Log is a system to log queries that exceeded a specified</span><br><span class=\"line\"># execution time. The execution time does not include the I&#x2F;O operations</span><br><span class=\"line\"># like talking with the client, sending the reply and so forth,</span><br><span class=\"line\"># but just the time needed to actually execute the command (this is the only</span><br><span class=\"line\"># stage of command execution where the thread is blocked and can not serve</span><br><span class=\"line\"># other requests in the meantime).</span><br><span class=\"line\">#</span><br><span class=\"line\"># You can configure the slow log with two parameters: one tells Redis</span><br><span class=\"line\"># what is the execution time, in microseconds, to exceed in order for the</span><br><span class=\"line\"># command to get logged, and the other parameter is the length of the</span><br><span class=\"line\"># slow log. When a new command is logged the oldest one is removed from the</span><br><span class=\"line\"># queue of logged commands.</span><br><span class=\"line\"></span><br><span class=\"line\"># The following time is expressed in microseconds, so 1000000 is equivalent</span><br><span class=\"line\"># to one second. Note that a negative number disables the slow log, while</span><br><span class=\"line\"># a value of zero forces the logging of every command.</span><br><span class=\"line\">slowlog-log-slower-than 10000</span><br><span class=\"line\"></span><br><span class=\"line\"># There is no limit to this length. Just be aware that it will consume memory.</span><br><span class=\"line\"># You can reclaim memory used by the slow log with SLOWLOG RESET.</span><br><span class=\"line\">slowlog-max-len 128</span><br><span class=\"line\"></span><br><span class=\"line\">################################ LATENCY MONITOR ##############################</span><br><span class=\"line\"></span><br><span class=\"line\"># The Redis latency monitoring subsystem samples different operations</span><br><span class=\"line\"># at runtime in order to collect data related to possible sources of</span><br><span class=\"line\"># latency of a Redis instance.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Via the LATENCY command this information is available to the user that can</span><br><span class=\"line\"># print graphs and obtain reports.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The system only logs operations that were performed in a time equal or</span><br><span class=\"line\"># greater than the amount of milliseconds specified via the</span><br><span class=\"line\"># latency-monitor-threshold configuration directive. When its value is set</span><br><span class=\"line\"># to zero, the latency monitor is turned off.</span><br><span class=\"line\">#</span><br><span class=\"line\"># By default latency monitoring is disabled since it is mostly not needed</span><br><span class=\"line\"># if you don&#39;t have latency issues, and collecting data has a performance</span><br><span class=\"line\"># impact, that while very small, can be measured under big load. Latency</span><br><span class=\"line\"># monitoring can easily be enabled at runtime using the command</span><br><span class=\"line\"># &quot;CONFIG SET latency-monitor-threshold &lt;milliseconds&gt;&quot; if needed.</span><br><span class=\"line\">latency-monitor-threshold 0</span><br><span class=\"line\"></span><br><span class=\"line\">############################# EVENT NOTIFICATION ##############################</span><br><span class=\"line\"></span><br><span class=\"line\"># Redis can notify Pub&#x2F;Sub clients about events happening in the key space.</span><br><span class=\"line\"># This feature is documented at http:&#x2F;&#x2F;redis.io&#x2F;topics&#x2F;notifications</span><br><span class=\"line\">#</span><br><span class=\"line\"># For instance if keyspace events notification is enabled, and a client</span><br><span class=\"line\"># performs a DEL operation on key &quot;foo&quot; stored in the Database 0, two</span><br><span class=\"line\"># messages will be published via Pub&#x2F;Sub:</span><br><span class=\"line\">#</span><br><span class=\"line\"># PUBLISH __keyspace@0__:foo del</span><br><span class=\"line\"># PUBLISH __keyevent@0__:del foo</span><br><span class=\"line\">#</span><br><span class=\"line\"># It is possible to select the events that Redis will notify among a set</span><br><span class=\"line\"># of classes. Every class is identified by a single character:</span><br><span class=\"line\">#</span><br><span class=\"line\"># K Keyspace events, published with __keyspace@&lt;db&gt;__ prefix.</span><br><span class=\"line\"># E Keyevent events, published with __keyevent@&lt;db&gt;__ prefix.</span><br><span class=\"line\"># g Generic commands (non-type specific) like DEL, EXPIRE, RENAME, ...</span><br><span class=\"line\"># $ String commands</span><br><span class=\"line\"># l List commands</span><br><span class=\"line\"># s Set commands</span><br><span class=\"line\"># h Hash commands</span><br><span class=\"line\"># z Sorted set commands</span><br><span class=\"line\"># x Expired events (events generated every time a key expires)</span><br><span class=\"line\"># e Evicted events (events generated when a key is evicted for maxmemory)</span><br><span class=\"line\"># A Alias for g$lshzxe, so that the &quot;AKE&quot; string means all the events.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The &quot;notify-keyspace-events&quot; takes as argument a string that is composed</span><br><span class=\"line\"># of zero or multiple characters. The empty string means that notifications</span><br><span class=\"line\"># are disabled.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Example: to enable list and generic events, from the point of view of the</span><br><span class=\"line\"># event name, use:</span><br><span class=\"line\">#</span><br><span class=\"line\"># notify-keyspace-events Elg</span><br><span class=\"line\">#</span><br><span class=\"line\"># Example 2: to get the stream of the expired keys subscribing to channel</span><br><span class=\"line\"># name __keyevent@0__:expired use:</span><br><span class=\"line\">#</span><br><span class=\"line\"># notify-keyspace-events Ex</span><br><span class=\"line\">#</span><br><span class=\"line\"># By default all notifications are disabled because most users don&#39;t need</span><br><span class=\"line\"># this feature and the feature has some overhead. Note that if you don&#39;t</span><br><span class=\"line\"># specify at least one of K or E, no events will be delivered.</span><br><span class=\"line\">notify-keyspace-events &quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">############################### ADVANCED CONFIG ###############################</span><br><span class=\"line\"></span><br><span class=\"line\"># Hashes are encoded using a memory efficient data structure when they have a</span><br><span class=\"line\"># small number of entries, and the biggest entry does not exceed a given</span><br><span class=\"line\"># threshold. These thresholds can be configured using the following directives.</span><br><span class=\"line\">hash-max-ziplist-entries 512</span><br><span class=\"line\">hash-max-ziplist-value 64</span><br><span class=\"line\"></span><br><span class=\"line\"># Lists are also encoded in a special way to save a lot of space.</span><br><span class=\"line\"># The number of entries allowed per internal list node can be specified</span><br><span class=\"line\"># as a fixed maximum size or a maximum number of elements.</span><br><span class=\"line\"># For a fixed maximum size, use -5 through -1, meaning:</span><br><span class=\"line\"># -5: max size: 64 Kb &lt;-- not recommended for normal workloads</span><br><span class=\"line\"># -4: max size: 32 Kb &lt;-- not recommended</span><br><span class=\"line\"># -3: max size: 16 Kb &lt;-- probably not recommended</span><br><span class=\"line\"># -2: max size: 8 Kb &lt;-- good</span><br><span class=\"line\"># -1: max size: 4 Kb &lt;-- good</span><br><span class=\"line\"># Positive numbers mean store up to _exactly_ that number of elements</span><br><span class=\"line\"># per list node.</span><br><span class=\"line\"># The highest performing option is usually -2 (8 Kb size) or -1 (4 Kb size),</span><br><span class=\"line\"># but if your use case is unique, adjust the settings as necessary.</span><br><span class=\"line\">list-max-ziplist-size -2</span><br><span class=\"line\"></span><br><span class=\"line\"># Lists may also be compressed.</span><br><span class=\"line\"># Compress depth is the number of quicklist ziplist nodes from *each* side of</span><br><span class=\"line\"># the list to *exclude* from compression. The head and tail of the list</span><br><span class=\"line\"># are always uncompressed for fast push&#x2F;pop operations. Settings are:</span><br><span class=\"line\"># 0: disable all list compression</span><br><span class=\"line\"># 1: depth 1 means &quot;don&#39;t start compressing until after 1 node into the list,</span><br><span class=\"line\"># going from either the head or tail&quot;</span><br><span class=\"line\"># So: [head]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[tail]</span><br><span class=\"line\"># [head], [tail] will always be uncompressed; inner nodes will compress.</span><br><span class=\"line\"># 2: [head]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[tail]</span><br><span class=\"line\"># 2 here means: don&#39;t compress head or head-&gt;next or tail-&gt;prev or tail,</span><br><span class=\"line\"># but compress all nodes between them.</span><br><span class=\"line\"># 3: [head]-&gt;[next]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[prev]-&gt;[tail]</span><br><span class=\"line\"># etc.</span><br><span class=\"line\">list-compress-depth 0</span><br><span class=\"line\"></span><br><span class=\"line\"># Sets have a special encoding in just one case: when a set is composed</span><br><span class=\"line\"># of just strings that happen to be integers in radix 10 in the range</span><br><span class=\"line\"># of 64 bit signed integers.</span><br><span class=\"line\"># The following configuration setting sets the limit in the size of the</span><br><span class=\"line\"># set in order to use this special memory saving encoding.</span><br><span class=\"line\">set-max-intset-entries 512</span><br><span class=\"line\"></span><br><span class=\"line\"># Similarly to hashes and lists, sorted sets are also specially encoded in</span><br><span class=\"line\"># order to save a lot of space. This encoding is only used when the length and</span><br><span class=\"line\"># elements of a sorted set are below the following limits:</span><br><span class=\"line\">zset-max-ziplist-entries 128</span><br><span class=\"line\">zset-max-ziplist-value 64</span><br><span class=\"line\"></span><br><span class=\"line\"># HyperLogLog sparse representation bytes limit. The limit includes the</span><br><span class=\"line\"># 16 bytes header. When an HyperLogLog using the sparse representation crosses</span><br><span class=\"line\"># this limit, it is converted into the dense representation.</span><br><span class=\"line\">#</span><br><span class=\"line\"># A value greater than 16000 is totally useless, since at that point the</span><br><span class=\"line\"># dense representation is more memory efficient.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The suggested value is ~ 3000 in order to have the benefits of</span><br><span class=\"line\"># the space efficient encoding without slowing down too much PFADD,</span><br><span class=\"line\"># which is O(N) with the sparse encoding. The value can be raised to</span><br><span class=\"line\"># ~ 10000 when CPU is not a concern, but space is, and the data set is</span><br><span class=\"line\"># composed of many HyperLogLogs with cardinality in the 0 - 15000 range.</span><br><span class=\"line\">hll-sparse-max-bytes 3000</span><br><span class=\"line\"></span><br><span class=\"line\"># Streams macro node max size &#x2F; items. The stream data structure is a radix</span><br><span class=\"line\"># tree of big nodes that encode multiple items inside. Using this configuration</span><br><span class=\"line\"># it is possible to configure how big a single node can be in bytes, and the</span><br><span class=\"line\"># maximum number of items it may contain before switching to a new node when</span><br><span class=\"line\"># appending new stream entries. If any of the following settings are set to</span><br><span class=\"line\"># zero, the limit is ignored, so for instance it is possible to set just a</span><br><span class=\"line\"># max entires limit by setting max-bytes to 0 and max-entries to the desired</span><br><span class=\"line\"># value.</span><br><span class=\"line\">stream-node-max-bytes 4096</span><br><span class=\"line\">stream-node-max-entries 100</span><br><span class=\"line\"></span><br><span class=\"line\"># Active rehashing uses 1 millisecond every 100 milliseconds of CPU time in</span><br><span class=\"line\"># order to help rehashing the main Redis hash table (the one mapping top-level</span><br><span class=\"line\"># keys to values). The hash table implementation Redis uses (see dict.c)</span><br><span class=\"line\"># performs a lazy rehashing: the more operation you run into a hash table</span><br><span class=\"line\"># that is rehashing, the more rehashing &quot;steps&quot; are performed, so if the</span><br><span class=\"line\"># server is idle the rehashing is never complete and some more memory is used</span><br><span class=\"line\"># by the hash table.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The default is to use this millisecond 10 times every second in order to</span><br><span class=\"line\"># actively rehash the main dictionaries, freeing memory when possible.</span><br><span class=\"line\">#</span><br><span class=\"line\"># If unsure:</span><br><span class=\"line\"># use &quot;activerehashing no&quot; if you have hard latency requirements and it is</span><br><span class=\"line\"># not a good thing in your environment that Redis can reply from time to time</span><br><span class=\"line\"># to queries with 2 milliseconds delay.</span><br><span class=\"line\">#</span><br><span class=\"line\"># use &quot;activerehashing yes&quot; if you don&#39;t have such hard requirements but</span><br><span class=\"line\"># want to free memory asap when possible.</span><br><span class=\"line\">activerehashing yes</span><br><span class=\"line\"></span><br><span class=\"line\"># The client output buffer limits can be used to force disconnection of clients</span><br><span class=\"line\"># that are not reading data from the server fast enough for some reason (a</span><br><span class=\"line\"># common reason is that a Pub&#x2F;Sub client can&#39;t consume messages as fast as the</span><br><span class=\"line\"># publisher can produce them).</span><br><span class=\"line\">#</span><br><span class=\"line\"># The limit can be set differently for the three different classes of clients:</span><br><span class=\"line\">#</span><br><span class=\"line\"># normal -&gt; normal clients including MONITOR clients</span><br><span class=\"line\"># replica -&gt; replica clients</span><br><span class=\"line\"># pubsub -&gt; clients subscribed to at least one pubsub channel or pattern</span><br><span class=\"line\">#</span><br><span class=\"line\"># The syntax of every client-output-buffer-limit directive is the following:</span><br><span class=\"line\">#</span><br><span class=\"line\"># client-output-buffer-limit &lt;class&gt; &lt;hard limit&gt; &lt;soft limit&gt; &lt;soft seconds&gt;</span><br><span class=\"line\">#</span><br><span class=\"line\"># A client is immediately disconnected once the hard limit is reached, or if</span><br><span class=\"line\"># the soft limit is reached and remains reached for the specified number of</span><br><span class=\"line\"># seconds (continuously).</span><br><span class=\"line\"># So for instance if the hard limit is 32 megabytes and the soft limit is</span><br><span class=\"line\"># 16 megabytes &#x2F; 10 seconds, the client will get disconnected immediately</span><br><span class=\"line\"># if the size of the output buffers reach 32 megabytes, but will also get</span><br><span class=\"line\"># disconnected if the client reaches 16 megabytes and continuously overcomes</span><br><span class=\"line\"># the limit for 10 seconds.</span><br><span class=\"line\">#</span><br><span class=\"line\"># By default normal clients are not limited because they don&#39;t receive data</span><br><span class=\"line\"># without asking (in a push way), but just after a request, so only</span><br><span class=\"line\"># asynchronous clients may create a scenario where data is requested faster</span><br><span class=\"line\"># than it can read.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Instead there is a default limit for pubsub and replica clients, since</span><br><span class=\"line\"># subscribers and replicas receive data in a push fashion.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Both the hard or the soft limit can be disabled by setting them to zero.</span><br><span class=\"line\">client-output-buffer-limit normal 0 0 0</span><br><span class=\"line\">client-output-buffer-limit replica 256mb 64mb 60</span><br><span class=\"line\">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class=\"line\"></span><br><span class=\"line\"># Client query buffers accumulate new commands. They are limited to a fixed</span><br><span class=\"line\"># amount by default in order to avoid that a protocol desynchronization (for</span><br><span class=\"line\"># instance due to a bug in the client) will lead to unbound memory usage in</span><br><span class=\"line\"># the query buffer. However you can configure it here if you have very special</span><br><span class=\"line\"># needs, such us huge multi&#x2F;exec requests or alike.</span><br><span class=\"line\">#</span><br><span class=\"line\"># client-query-buffer-limit 1gb</span><br><span class=\"line\"></span><br><span class=\"line\"># In the Redis protocol, bulk requests, that are, elements representing single</span><br><span class=\"line\"># strings, are normally limited ot 512 mb. However you can change this limit</span><br><span class=\"line\"># here.</span><br><span class=\"line\">#</span><br><span class=\"line\"># proto-max-bulk-len 512mb</span><br><span class=\"line\"></span><br><span class=\"line\"># Redis calls an internal function to perform many background tasks, like</span><br><span class=\"line\"># closing connections of clients in timeout, purging expired keys that are</span><br><span class=\"line\"># never requested, and so forth.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Not all tasks are performed with the same frequency, but Redis checks for</span><br><span class=\"line\"># tasks to perform according to the specified &quot;hz&quot; value.</span><br><span class=\"line\">#</span><br><span class=\"line\"># By default &quot;hz&quot; is set to 10. Raising the value will use more CPU when</span><br><span class=\"line\"># Redis is idle, but at the same time will make Redis more responsive when</span><br><span class=\"line\"># there are many keys expiring at the same time, and timeouts may be</span><br><span class=\"line\"># handled with more precision.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The range is between 1 and 500, however a value over 100 is usually not</span><br><span class=\"line\"># a good idea. Most users should use the default of 10 and raise this up to</span><br><span class=\"line\"># 100 only in environments where very low latency is required.</span><br><span class=\"line\">hz 10</span><br><span class=\"line\"></span><br><span class=\"line\"># Normally it is useful to have an HZ value which is proportional to the</span><br><span class=\"line\"># number of clients connected. This is useful in order, for instance, to</span><br><span class=\"line\"># avoid too many clients are processed for each background task invocation</span><br><span class=\"line\"># in order to avoid latency spikes.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Since the default HZ value by default is conservatively set to 10, Redis</span><br><span class=\"line\"># offers, and enables by default, the ability to use an adaptive HZ value</span><br><span class=\"line\"># which will temporary raise when there are many connected clients.</span><br><span class=\"line\">#</span><br><span class=\"line\"># When dynamic HZ is enabled, the actual configured HZ will be used as</span><br><span class=\"line\"># as a baseline, but multiples of the configured HZ value will be actually</span><br><span class=\"line\"># used as needed once more clients are connected. In this way an idle</span><br><span class=\"line\"># instance will use very little CPU time while a busy instance will be</span><br><span class=\"line\"># more responsive.</span><br><span class=\"line\">dynamic-hz yes</span><br><span class=\"line\"></span><br><span class=\"line\"># When a child rewrites the AOF file, if the following option is enabled</span><br><span class=\"line\"># the file will be fsync-ed every 32 MB of data generated. This is useful</span><br><span class=\"line\"># in order to commit the file to the disk more incrementally and avoid</span><br><span class=\"line\"># big latency spikes.</span><br><span class=\"line\">aof-rewrite-incremental-fsync yes</span><br><span class=\"line\"></span><br><span class=\"line\"># When redis saves RDB file, if the following option is enabled</span><br><span class=\"line\"># the file will be fsync-ed every 32 MB of data generated. This is useful</span><br><span class=\"line\"># in order to commit the file to the disk more incrementally and avoid</span><br><span class=\"line\"># big latency spikes.</span><br><span class=\"line\">rdb-save-incremental-fsync yes</span><br><span class=\"line\"></span><br><span class=\"line\"># Redis LFU eviction (see maxmemory setting) can be tuned. However it is a good</span><br><span class=\"line\"># idea to start with the default settings and only change them after investigating</span><br><span class=\"line\"># how to improve the performances and how the keys LFU change over time, which</span><br><span class=\"line\"># is possible to inspect via the OBJECT FREQ command.</span><br><span class=\"line\">#</span><br><span class=\"line\"># There are two tunable parameters in the Redis LFU implementation: the</span><br><span class=\"line\"># counter logarithm factor and the counter decay time. It is important to</span><br><span class=\"line\"># understand what the two parameters mean before changing them.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The LFU counter is just 8 bits per key, it&#39;s maximum value is 255, so Redis</span><br><span class=\"line\"># uses a probabilistic increment with logarithmic behavior. Given the value</span><br><span class=\"line\"># of the old counter, when a key is accessed, the counter is incremented in</span><br><span class=\"line\"># this way:</span><br><span class=\"line\">#</span><br><span class=\"line\"># 1. A random number R between 0 and 1 is extracted.</span><br><span class=\"line\"># 2. A probability P is calculated as 1&#x2F;(old_value*lfu_log_factor+1).</span><br><span class=\"line\"># 3. The counter is incremented only if R &lt; P.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The default lfu-log-factor is 10. This is a table of how the frequency</span><br><span class=\"line\"># counter changes with a different number of accesses with different</span><br><span class=\"line\"># logarithmic factors:</span><br><span class=\"line\">#</span><br><span class=\"line\"># +--------+------------+------------+------------+------------+------------+</span><br><span class=\"line\"># | factor | 100 hits | 1000 hits | 100K hits | 1M hits | 10M hits |</span><br><span class=\"line\"># +--------+------------+------------+------------+------------+------------+</span><br><span class=\"line\"># | 0 | 104 | 255 | 255 | 255 | 255 |</span><br><span class=\"line\"># +--------+------------+------------+------------+------------+------------+</span><br><span class=\"line\"># | 1 | 18 | 49 | 255 | 255 | 255 |</span><br><span class=\"line\"># +--------+------------+------------+------------+------------+------------+</span><br><span class=\"line\"># | 10 | 10 | 18 | 142 | 255 | 255 |</span><br><span class=\"line\"># +--------+------------+------------+------------+------------+------------+</span><br><span class=\"line\"># | 100 | 8 | 11 | 49 | 143 | 255 |</span><br><span class=\"line\"># +--------+------------+------------+------------+------------+------------+</span><br><span class=\"line\">#</span><br><span class=\"line\"># NOTE: The above table was obtained by running the following commands:</span><br><span class=\"line\">#</span><br><span class=\"line\"># redis-benchmark -n 1000000 incr foo</span><br><span class=\"line\"># redis-cli object freq foo</span><br><span class=\"line\">#</span><br><span class=\"line\"># NOTE 2: The counter initial value is 5 in order to give new objects a chance</span><br><span class=\"line\"># to accumulate hits.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The counter decay time is the time, in minutes, that must elapse in order</span><br><span class=\"line\"># for the key counter to be divided by two (or decremented if it has a value</span><br><span class=\"line\"># less &lt;&#x3D; 10).</span><br><span class=\"line\">#</span><br><span class=\"line\"># The default value for the lfu-decay-time is 1. A Special value of 0 means to</span><br><span class=\"line\"># decay the counter every time it happens to be scanned.</span><br><span class=\"line\">#</span><br><span class=\"line\"># lfu-log-factor 10</span><br><span class=\"line\"># lfu-decay-time 1</span><br><span class=\"line\"></span><br><span class=\"line\">########################### ACTIVE DEFRAGMENTATION #######################</span><br><span class=\"line\">#</span><br><span class=\"line\"># WARNING THIS FEATURE IS EXPERIMENTAL. However it was stress tested</span><br><span class=\"line\"># even in production and manually tested by multiple engineers for some</span><br><span class=\"line\"># time.</span><br><span class=\"line\">#</span><br><span class=\"line\"># What is active defragmentation?</span><br><span class=\"line\"># -------------------------------</span><br><span class=\"line\">#</span><br><span class=\"line\"># Active (online) defragmentation allows a Redis server to compact the</span><br><span class=\"line\"># spaces left between small allocations and deallocations of data in memory,</span><br><span class=\"line\"># thus allowing to reclaim back memory.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Fragmentation is a natural process that happens with every allocator (but</span><br><span class=\"line\"># less so with Jemalloc, fortunately) and certain workloads. Normally a server</span><br><span class=\"line\"># restart is needed in order to lower the fragmentation, or at least to flush</span><br><span class=\"line\"># away all the data and create it again. However thanks to this feature</span><br><span class=\"line\"># implemented by Oran Agra for Redis 4.0 this process can happen at runtime</span><br><span class=\"line\"># in an &quot;hot&quot; way, while the server is running.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Basically when the fragmentation is over a certain level (see the</span><br><span class=\"line\"># configuration options below) Redis will start to create new copies of the</span><br><span class=\"line\"># values in contiguous memory regions by exploiting certain specific Jemalloc</span><br><span class=\"line\"># features (in order to understand if an allocation is causing fragmentation</span><br><span class=\"line\"># and to allocate it in a better place), and at the same time, will release the</span><br><span class=\"line\"># old copies of the data. This process, repeated incrementally for all the keys</span><br><span class=\"line\"># will cause the fragmentation to drop back to normal values.</span><br><span class=\"line\">#</span><br><span class=\"line\"># Important things to understand:</span><br><span class=\"line\">#</span><br><span class=\"line\"># 1. This feature is disabled by default, and only works if you compiled Redis</span><br><span class=\"line\"># to use the copy of Jemalloc we ship with the source code of Redis.</span><br><span class=\"line\"># This is the default with Linux builds.</span><br><span class=\"line\">#</span><br><span class=\"line\"># 2. You never need to enable this feature if you don&#39;t have fragmentation</span><br><span class=\"line\"># issues.</span><br><span class=\"line\">#</span><br><span class=\"line\"># 3. Once you experience fragmentation, you can enable this feature when</span><br><span class=\"line\"># needed with the command &quot;CONFIG SET activedefrag yes&quot;.</span><br><span class=\"line\">#</span><br><span class=\"line\"># The configuration parameters are able to fine tune the behavior of the</span><br><span class=\"line\"># defragmentation process. If you are not sure about what they mean it is</span><br><span class=\"line\"># a good idea to leave the defaults untouched.</span><br><span class=\"line\"></span><br><span class=\"line\"># Enabled active defragmentation</span><br><span class=\"line\"># activedefrag yes</span><br><span class=\"line\"></span><br><span class=\"line\"># Minimum amount of fragmentation waste to start active defrag</span><br><span class=\"line\"># active-defrag-ignore-bytes 100mb</span><br><span class=\"line\"></span><br><span class=\"line\"># Minimum percentage of fragmentation to start active defrag</span><br><span class=\"line\"># active-defrag-threshold-lower 10</span><br><span class=\"line\"></span><br><span class=\"line\"># Maximum percentage of fragmentation at which we use maximum effort</span><br><span class=\"line\"># active-defrag-threshold-upper 100</span><br><span class=\"line\"></span><br><span class=\"line\"># Minimal effort for defrag in CPU percentage</span><br><span class=\"line\"># active-defrag-cycle-min 5</span><br><span class=\"line\"></span><br><span class=\"line\"># Maximal effort for defrag in CPU percentage</span><br><span class=\"line\"># active-defrag-cycle-max 75</span><br><span class=\"line\"></span><br><span class=\"line\"># Maximum number of set&#x2F;hash&#x2F;zset&#x2F;list fields that will be processed from</span><br><span class=\"line\"># the main dictionary scan</span><br><span class=\"line\"># active-defrag-max-scan-fields 1000</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>",
            "tags": [
                "redis"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/07/14/redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/",
            "url": "http://www.startanew.cn/2020/07/14/redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/",
            "title": "redis主从复制",
            "date_published": "2020-07-14T00:29:37.000Z",
            "content_html": "<h4 id=\"基本环境\"><a class=\"markdownIt-Anchor\" href=\"#基本环境\">#</a> 基本环境</h4>\n<h6 id=\"启动3台redis\"><a class=\"markdownIt-Anchor\" href=\"#启动3台redis\">#</a> 启动 3 台 redis</h6>\n<ul>\n<li>redis-1：172.17.0.2:6379</li>\n<li>redis-2：172.17.0.3:6379</li>\n<li>redis-3：172.17.0.4:6379</li>\n</ul>\n<a id=\"more\"></a>  \n<h4 id=\"配置主从复制\"><a class=\"markdownIt-Anchor\" href=\"#配置主从复制\">#</a> 配置主从复制</h4>\n<ul>\n<li>\n<p>分别进入 3 台 redis, 使用   info replication  查看信息</p>\n</li>\n<li>\n<p>可以看到当前 3 台 redis 都是 master 角色，使用 redis-cli 命令修改 redis-6380、redis-6381 的主机为 172.17.0.2:6379</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SLAVEOF host port &#x2F;&#x2F; SLAVEOF 172.17.0.2 6379</span><br></pre></td></tr></table></figure>\n<ul>\n<li>进入 172.17.0.2 使用   info replication  查看信息，看到两个从机说明配置成功。</li>\n</ul>\n<h4 id=\"配置哨兵模式\"><a class=\"markdownIt-Anchor\" href=\"#配置哨兵模式\">#</a> 配置哨兵模式</h4>\n<ul>\n<li>\n<p>分别进入台 redis , 进行以下操作</p>\n</li>\n<li>\n<p>进入根目录创建 sentinel.conf 文件</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F; &amp;&amp; touch sentinel.conf</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul>\n<li>修改文件内容为：</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sentinel monitor mymaster 172.17.0.2 6379 1</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">使用 redis-sentinel &#x2F;sentinel.conf 启动Redis哨兵监控</span><br></pre></td></tr></table></figure>\n<center>\n <img data-src=\"http://vps.startanew.cn/1594686718420om0hf87q.png\" >\n</center>    \n",
            "tags": [
                "redis"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/07/13/mycat-%E9%AB%98%E5%8F%AF%E7%94%A8haproxy/",
            "url": "http://www.startanew.cn/2020/07/13/mycat-%E9%AB%98%E5%8F%AF%E7%94%A8haproxy/",
            "title": "mycat 高可用haproxy",
            "date_published": "2020-07-13T09:05:07.000Z",
            "content_html": "<h4 id=\"haproxy作用\"><a class=\"markdownIt-Anchor\" href=\"#haproxy作用\">#</a> haproxy 作用</h4>\n<p>HAProxy 厉害的点，不需要写 mysql 的健康检测，软件本身可以检测出 mysql 服务停止，然后切换到正常的服务器上，而且当 mysql 服务器重启之后，HAProxy 不需要重启，也能识别并且切换上去。</p>\n<h4 id=\"基本环境\"><a class=\"markdownIt-Anchor\" href=\"#基本环境\">#</a> 基本环境</h4>\n<p>mycat1:172.18.12.5</p>\n<p>mycat2:172.18.12.6</p>\n<a id=\"more\"></a>\n<h4 id=\"haproxycfg-配置文件\"><a class=\"markdownIt-Anchor\" href=\"#haproxycfg-配置文件\">#</a> haproxy.cfg 配置文件</h4>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">global</span><br><span class=\"line\">daemon</span><br><span class=\"line\">#nbproc 1</span><br><span class=\"line\">#pidfile &#x2F;var&#x2F;run&#x2F;haproxy.pid</span><br><span class=\"line\">#工作目录</span><br><span class=\"line\">chroot &#x2F;usr&#x2F;local&#x2F;etc&#x2F;haproxy</span><br><span class=\"line\"></span><br><span class=\"line\">defaults</span><br><span class=\"line\">log 127.0.0.1 local0 err #[err warning info debug]</span><br><span class=\"line\">mode http #默认的模式mode &#123; tcp|http|health &#125;，tcp是4层，http是7层，health只会返回OK</span><br><span class=\"line\">retries 3 #两次连接失败就认为是服务器不可用，也可以通过后面设置</span><br><span class=\"line\">option redispatch #当serverId对应的服务器挂掉后，强制定向到其他健康的服务器</span><br><span class=\"line\">option abortonclose #当服务器负载很高的时候，自动结束掉当前队列处理比较久的链接</span><br><span class=\"line\">option dontlognull #日志中不记录负载均衡的心跳检测记录</span><br><span class=\"line\">maxconn 4096 #默认的最大连接数</span><br><span class=\"line\">timeout connect 5000ms #连接超时</span><br><span class=\"line\">timeout client 30000ms #客户端超时</span><br><span class=\"line\">timeout server 30000ms #服务器超时</span><br><span class=\"line\">#timeout check 2000 #&#x3D;心跳检测超时</span><br><span class=\"line\"></span><br><span class=\"line\">######## 监控界面配置 #################</span><br><span class=\"line\">listen admin_status</span><br><span class=\"line\">#监控界面访问信息</span><br><span class=\"line\">bind 0.0.0.0:8888</span><br><span class=\"line\">mode http</span><br><span class=\"line\">#URI相对地址</span><br><span class=\"line\">stats uri &#x2F;dbs</span><br><span class=\"line\">#统计报告格式</span><br><span class=\"line\">stats realm Global\\ statistics</span><br><span class=\"line\">#登录账户信息</span><br><span class=\"line\">stats auth admin:123456</span><br><span class=\"line\">########frontend配置##############</span><br><span class=\"line\"></span><br><span class=\"line\">######## mysql负载均衡配置 ###############</span><br><span class=\"line\">listen proxy-mysql</span><br><span class=\"line\">bind 0.0.0.0:3306</span><br><span class=\"line\">mode tcp</span><br><span class=\"line\">#负载均衡算法</span><br><span class=\"line\">#static-rr 权重, leastconn 最少连接, source 请求IP, 轮询 roundrobin</span><br><span class=\"line\">balance roundrobin</span><br><span class=\"line\">#日志格式</span><br><span class=\"line\">#option tcplog</span><br><span class=\"line\">#在 mysql 创建一个没有权限的haproxy用户，密码为空。 haproxy用户</span><br><span class=\"line\">#create user &#39;haproxy&#39;@&#39;%&#39; identified by &#39;&#39;; FLUSH PRIVILEGES;</span><br><span class=\"line\">#option mysql-check user haproxy</span><br><span class=\"line\">#这里是容器中的IP地址，由于配置的是轮询roundrobin，weight 权重其实没有生效</span><br><span class=\"line\">server MYSQL_1 172.18.12.5:8066 check weight 1 maxconn 2000</span><br><span class=\"line\">server MYSQL_2 172.18.12.6:8066 check weight 1 maxconn 2000</span><br><span class=\"line\">#server MYSQL_3 192.168.130.102:3306 check weight 1 maxconn 2000</span><br><span class=\"line\">#使用keepalive检测死链</span><br><span class=\"line\">#option tcpka</span><br><span class=\"line\">#########################################</span><br></pre></td></tr></table></figure>\n<h4 id=\"web界面访问haproxy监控界面\"><a class=\"markdownIt-Anchor\" href=\"#web界面访问haproxy监控界面\">#</a> web 界面访问 haproxy 监控界面</h4>\n<p>配置：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> bind 0.0.0.0:8888</span><br><span class=\"line\">mode http</span><br><span class=\"line\">#URI相对地址</span><br><span class=\"line\">stats uri &#x2F;dbs</span><br><span class=\"line\">#统计报告格式</span><br><span class=\"line\">stats realm Global\\ statistics</span><br><span class=\"line\">#登录账户信息</span><br><span class=\"line\">stats auth admin:123456</span><br></pre></td></tr></table></figure>\n<p>启动 haproxy 后，可通过 http://ip:8888/dbs 查看 mycat 状态</p>\n<p>效果图如下</p>\n<center>\n <img data-src=\"http://vps.startanew.cn/1594631222393uq2zb4sw.png\" >\n</center>    \n还需要通过keepalived保证haproxy的高可用，keepalived搭建失败\n",
            "tags": [
                "mysql"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/07/13/mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6-mycat/",
            "url": "http://www.startanew.cn/2020/07/13/mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6-mycat/",
            "title": "mysql主从复制-mycat",
            "date_published": "2020-07-13T08:50:13.000Z",
            "content_html": "<h4 id=\"基本环境\"><a class=\"markdownIt-Anchor\" href=\"#基本环境\">#</a> 基本环境</h4>\n<ul>\n<li>master1：172.18.12.1</li>\n<li>master2：172.18.12.2</li>\n<li>slave1：172.18.12.3</li>\n<li>slave2：172.18.12.4</li>\n<li>架构双主双从</li>\n</ul>\n<a id=\"more\"></a>\n<h4 id=\"mycat-配置\"><a class=\"markdownIt-Anchor\" href=\"#mycat-配置\">#</a> mycat 配置</h4>\n<p>server.xml 配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class=\"line\">&lt;!-- - - Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); </span><br><span class=\"line\">- you may not use this file except in compliance with the License. - You </span><br><span class=\"line\">may obtain a copy of the License at - - http:&#x2F;&#x2F;www.apache.org&#x2F;licenses&#x2F;LICENSE-2.0 </span><br><span class=\"line\">- - Unless required by applicable law or agreed to in writing, software - </span><br><span class=\"line\">distributed under the License is distributed on an &quot;AS IS&quot; BASIS, - WITHOUT </span><br><span class=\"line\">WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. - See the </span><br><span class=\"line\">License for the specific language governing permissions and - limitations </span><br><span class=\"line\">under the License. --&gt;</span><br><span class=\"line\">&lt;!DOCTYPE mycat:server SYSTEM &quot;server.dtd&quot;&gt;</span><br><span class=\"line\">&lt;mycat:server xmlns:mycat&#x3D;&quot;http:&#x2F;&#x2F;io.mycat&#x2F;&quot;&gt;</span><br><span class=\"line\">&lt;system&gt;</span><br><span class=\"line\">&lt;property name&#x3D;&quot;nonePasswordLogin&quot;&gt;0&lt;&#x2F;property&gt; &lt;!-- 0为需要密码登陆、1为不需要密码登陆 ,默认为0，设置为1则需要指定默认账户--&gt;</span><br><span class=\"line\">&lt;property name&#x3D;&quot;useHandshakeV10&quot;&gt;1&lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;property name&#x3D;&quot;useSqlStat&quot;&gt;0&lt;&#x2F;property&gt; &lt;!-- 1为开启实时统计、0为关闭 --&gt;</span><br><span class=\"line\">&lt;property name&#x3D;&quot;useGlobleTableCheck&quot;&gt;0&lt;&#x2F;property&gt; &lt;!-- 1为开启全加班一致性检测、0为关闭 --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;&quot;sequnceHandlerType&quot;&gt;2&lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;property name&#x3D;&quot;subqueryRelationshipCheck&quot;&gt;false&lt;&#x2F;property&gt; &lt;!-- 子查询中存在关联查询的情况下,检查关联字段中是否有分片字段 .默认 false --&gt;</span><br><span class=\"line\">&lt;!-- &lt;property name&#x3D;&quot;useCompression&quot;&gt;1&lt;&#x2F;property&gt;--&gt; &lt;!--1为开启mysql压缩协议--&gt;</span><br><span class=\"line\">&lt;!-- &lt;property name&#x3D;&quot;fakeMySQLVersion&quot;&gt;5.6.20&lt;&#x2F;property&gt;--&gt; &lt;!--设置模拟的MySQL版本号--&gt;</span><br><span class=\"line\">&lt;!-- &lt;property name&#x3D;&quot;processorBufferChunk&quot;&gt;40960&lt;&#x2F;property&gt; --&gt;</span><br><span class=\"line\">&lt;!-- </span><br><span class=\"line\">&lt;property name&#x3D;&quot;processors&quot;&gt;1&lt;&#x2F;property&gt; </span><br><span class=\"line\">&lt;property name&#x3D;&quot;processorExecutor&quot;&gt;32&lt;&#x2F;property&gt; </span><br><span class=\"line\">--&gt;</span><br><span class=\"line\">&lt;!--默认为type 0: DirectByteBufferPool | type 1 ByteBufferArena | type 2 NettyBufferPool --&gt;</span><br><span class=\"line\">&lt;property name&#x3D;&quot;processorBufferPoolType&quot;&gt;0&lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;!--默认是65535 64K 用于sql解析时最大文本长度 --&gt;</span><br><span class=\"line\">&lt;!--&lt;property name&#x3D;&quot;maxStringLiteralLength&quot;&gt;65535&lt;&#x2F;property&gt;--&gt;</span><br><span class=\"line\">&lt;!--&lt;property name&#x3D;&quot;sequnceHandlerType&quot;&gt;0&lt;&#x2F;property&gt;--&gt;</span><br><span class=\"line\">&lt;!--&lt;property name&#x3D;&quot;backSocketNoDelay&quot;&gt;1&lt;&#x2F;property&gt;--&gt;</span><br><span class=\"line\">&lt;!--&lt;property name&#x3D;&quot;frontSocketNoDelay&quot;&gt;1&lt;&#x2F;property&gt;--&gt;</span><br><span class=\"line\">&lt;!--&lt;property name&#x3D;&quot;processorExecutor&quot;&gt;16&lt;&#x2F;property&gt;--&gt;</span><br><span class=\"line\">&lt;!--</span><br><span class=\"line\">&lt;property name&#x3D;&quot;serverPort&quot;&gt;8066&lt;&#x2F;property&gt; &lt;property name&#x3D;&quot;managerPort&quot;&gt;9066&lt;&#x2F;property&gt; </span><br><span class=\"line\">&lt;property name&#x3D;&quot;idleTimeout&quot;&gt;300000&lt;&#x2F;property&gt; &lt;property name&#x3D;&quot;bindIp&quot;&gt;0.0.0.0&lt;&#x2F;property&gt; </span><br><span class=\"line\">&lt;property name&#x3D;&quot;frontWriteQueueSize&quot;&gt;4096&lt;&#x2F;property&gt; &lt;property name&#x3D;&quot;processors&quot;&gt;32&lt;&#x2F;property&gt; --&gt;</span><br><span class=\"line\">&lt;!--分布式事务开关，0为不过滤分布式事务，1为过滤分布式事务（如果分布式事务内只涉及全局表，则不过滤），2为不过滤分布式事务,但是记录分布式事务日志--&gt;</span><br><span class=\"line\">&lt;property name&#x3D;&quot;handleDistributedTransactions&quot;&gt;0&lt;&#x2F;property&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!--</span><br><span class=\"line\">off heap for merge&#x2F;order&#x2F;group&#x2F;limit 1开启 0关闭</span><br><span class=\"line\">--&gt;</span><br><span class=\"line\">&lt;property name&#x3D;&quot;useOffHeapForMerge&quot;&gt;1&lt;&#x2F;property&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!--</span><br><span class=\"line\">单位为m</span><br><span class=\"line\">--&gt;</span><br><span class=\"line\">&lt;property name&#x3D;&quot;memoryPageSize&quot;&gt;64k&lt;&#x2F;property&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!--</span><br><span class=\"line\">单位为k</span><br><span class=\"line\">--&gt;</span><br><span class=\"line\">&lt;property name&#x3D;&quot;spillsFileBufferSize&quot;&gt;1k&lt;&#x2F;property&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;&quot;useStreamOutput&quot;&gt;0&lt;&#x2F;property&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!--</span><br><span class=\"line\">单位为m</span><br><span class=\"line\">--&gt;</span><br><span class=\"line\">&lt;property name&#x3D;&quot;systemReserveMemorySize&quot;&gt;384m&lt;&#x2F;property&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!--是否采用zookeeper协调切换 --&gt;</span><br><span class=\"line\">&lt;property name&#x3D;&quot;useZKSwitch&quot;&gt;false&lt;&#x2F;property&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- XA Recovery Log日志路径 --&gt;</span><br><span class=\"line\">&lt;!--&lt;property name&#x3D;&quot;XARecoveryLogBaseDir&quot;&gt;.&#x2F;&lt;&#x2F;property&gt;--&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- XA Recovery Log日志名称 --&gt;</span><br><span class=\"line\">&lt;!--&lt;property name&#x3D;&quot;XARecoveryLogBaseName&quot;&gt;tmlog&lt;&#x2F;property&gt;--&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;system&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- 全局SQL防火墙设置 --&gt;</span><br><span class=\"line\">&lt;!--白名单可以使用通配符%或着*--&gt;</span><br><span class=\"line\">&lt;!--例如&lt;host host&#x3D;&quot;127.0.0.*&quot; user&#x3D;&quot;root&quot;&#x2F;&gt;--&gt;</span><br><span class=\"line\">&lt;!--例如&lt;host host&#x3D;&quot;127.0.*&quot; user&#x3D;&quot;root&quot;&#x2F;&gt;--&gt;</span><br><span class=\"line\">&lt;!--例如&lt;host host&#x3D;&quot;127.*&quot; user&#x3D;&quot;root&quot;&#x2F;&gt;--&gt;</span><br><span class=\"line\">&lt;!--例如&lt;host host&#x3D;&quot;1*7.*&quot; user&#x3D;&quot;root&quot;&#x2F;&gt;--&gt;</span><br><span class=\"line\">&lt;!--这些配置情况下对于127.0.0.1都能以root账户登录--&gt;</span><br><span class=\"line\">&lt;!--</span><br><span class=\"line\">&lt;firewall&gt;</span><br><span class=\"line\">&lt;whitehost&gt;</span><br><span class=\"line\">&lt;host host&#x3D;&quot;1*7.0.0.*&quot; user&#x3D;&quot;root&quot;&#x2F;&gt;</span><br><span class=\"line\">&lt;&#x2F;whitehost&gt;</span><br><span class=\"line\">&lt;blacklist check&#x3D;&quot;false&quot;&gt;</span><br><span class=\"line\">&lt;&#x2F;blacklist&gt;</span><br><span class=\"line\">&lt;&#x2F;firewall&gt;</span><br><span class=\"line\">--&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;user name&#x3D;&quot;root&quot; defaultAccount&#x3D;&quot;true&quot;&gt;</span><br><span class=\"line\">&lt;property name&#x3D;&quot;password&quot;&gt;1234567&lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;property name&#x3D;&quot;schemas&quot;&gt;TESTDB&lt;&#x2F;property&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- 表级 DML 权限设置 --&gt;</span><br><span class=\"line\">&lt;!-- </span><br><span class=\"line\">&lt;privileges check&#x3D;&quot;false&quot;&gt;</span><br><span class=\"line\">&lt;schema name&#x3D;&quot;TESTDB&quot; dml&#x3D;&quot;0110&quot; &gt;</span><br><span class=\"line\">&lt;table name&#x3D;&quot;tb01&quot; dml&#x3D;&quot;0000&quot;&gt;&lt;&#x2F;table&gt;</span><br><span class=\"line\">&lt;table name&#x3D;&quot;tb02&quot; dml&#x3D;&quot;1111&quot;&gt;&lt;&#x2F;table&gt;</span><br><span class=\"line\">&lt;&#x2F;schema&gt;</span><br><span class=\"line\">&lt;&#x2F;privileges&gt; </span><br><span class=\"line\">--&gt;</span><br><span class=\"line\">&lt;&#x2F;user&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;user name&#x3D;&quot;user&quot;&gt;</span><br><span class=\"line\">&lt;property name&#x3D;&quot;password&quot;&gt;user&lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;property name&#x3D;&quot;schemas&quot;&gt;TESTDB&lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;property name&#x3D;&quot;readOnly&quot;&gt;true&lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;&#x2F;user&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;mycat:server&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>scheam.xml   配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE mycat:schema SYSTEM &quot;schema.dtd&quot;&gt;</span><br><span class=\"line\">&lt;mycat:schema xmlns:mycat&#x3D;&quot;http:&#x2F;&#x2F;io.mycat&#x2F;&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;schema name&#x3D;&quot;TESTDB&quot; checkSQLschema&#x3D;&quot;false&quot; sqlMaxLimit&#x3D;&quot;100&quot; dataNode&#x3D;&quot;dn1&quot;&gt;</span><br><span class=\"line\">&lt;&#x2F;schema&gt;</span><br><span class=\"line\">&lt;dataNode name&#x3D;&quot;dn1&quot; dataHost&#x3D;&quot;localhost1&quot; database&#x3D;&quot;test&quot; &#x2F;&gt;</span><br><span class=\"line\">&lt;!--&lt;dataNode name&#x3D;&quot;dn4&quot; dataHost&#x3D;&quot;sequoiadb1&quot; database&#x3D;&quot;SAMPLE&quot; &#x2F;&gt;</span><br><span class=\"line\">&lt;dataNode name&#x3D;&quot;jdbc_dn1&quot; dataHost&#x3D;&quot;jdbchost&quot; database&#x3D;&quot;db1&quot; &#x2F;&gt;</span><br><span class=\"line\">&lt;dataNode name&#x3D;&quot;jdbc_dn2&quot; dataHost&#x3D;&quot;jdbchost&quot; database&#x3D;&quot;db2&quot; &#x2F;&gt;</span><br><span class=\"line\">&lt;dataNode name&#x3D;&quot;jdbc_dn3&quot; dataHost&#x3D;&quot;jdbchost&quot; database&#x3D;&quot;db3&quot; &#x2F;&gt; --&gt;</span><br><span class=\"line\">&lt;dataHost name&#x3D;&quot;localhost1&quot; maxCon&#x3D;&quot;1000&quot; minCon&#x3D;&quot;10&quot; balance&#x3D;&quot;1&quot;</span><br><span class=\"line\">writeType&#x3D;&quot;0&quot; dbType&#x3D;&quot;mysql&quot; dbDriver&#x3D;&quot;native&quot; switchType&#x3D;&quot;1&quot; slaveThreshold&#x3D;&quot;100&quot;&gt;</span><br><span class=\"line\">&lt;heartbeat&gt;select user()&lt;&#x2F;heartbeat&gt;</span><br><span class=\"line\">&lt;!-- can have multi write hosts --&gt;</span><br><span class=\"line\">&lt;writeHost host&#x3D;&quot;hostM1&quot; url&#x3D;&quot;172.18.12.1:3306&quot; user&#x3D;&quot;root&quot;</span><br><span class=\"line\">password&#x3D;&quot;root&quot;&gt;</span><br><span class=\"line\">&lt;!-- can have multi read hosts --&gt;</span><br><span class=\"line\">&lt;readHost host&#x3D;&quot;hostS2&quot; url&#x3D;&quot;172.18.12.3:3306&quot; user&#x3D;&quot;root&quot; password&#x3D;&quot;root&quot; &#x2F;&gt;</span><br><span class=\"line\">&lt;&#x2F;writeHost&gt;</span><br><span class=\"line\">&lt;writeHost host&#x3D;&quot;hostM2&quot; url&#x3D;&quot;172.18.12.2:3306&quot; user&#x3D;&quot;root&quot;</span><br><span class=\"line\">password&#x3D;&quot;root&quot;&gt;</span><br><span class=\"line\">&lt;!-- can have multi read hosts --&gt;</span><br><span class=\"line\">&lt;readHost host&#x3D;&quot;hostS2&quot; url&#x3D;&quot;172.18.12.4:3306&quot; user&#x3D;&quot;root&quot; password&#x3D;&quot;root&quot; &#x2F;&gt;</span><br><span class=\"line\">&lt;&#x2F;writeHost&gt;</span><br><span class=\"line\">&lt;!-- &lt;writeHost host&#x3D;&quot;hostM2&quot; url&#x3D;&quot;localhost:3316&quot; user&#x3D;&quot;root&quot; password&#x3D;&quot;123456&quot;&#x2F;&gt; --&gt;</span><br><span class=\"line\">&lt;&#x2F;dataHost&gt;</span><br><span class=\"line\">&lt;!--</span><br><span class=\"line\">&lt;dataHost name&#x3D;&quot;sequoiadb1&quot; maxCon&#x3D;&quot;1000&quot; minCon&#x3D;&quot;1&quot; balance&#x3D;&quot;0&quot; dbType&#x3D;&quot;sequoiadb&quot; dbDriver&#x3D;&quot;jdbc&quot;&gt;</span><br><span class=\"line\">&lt;heartbeat&gt; &lt;&#x2F;heartbeat&gt;</span><br><span class=\"line\">&lt;writeHost host&#x3D;&quot;hostM1&quot; url&#x3D;&quot;sequoiadb:&#x2F;&#x2F;1426587161.dbaas.sequoialab.net:11920&#x2F;SAMPLE&quot; user&#x3D;&quot;jifeng&quot; password&#x3D;&quot;jifeng&quot;&gt;&lt;&#x2F;writeHost&gt;</span><br><span class=\"line\">&lt;&#x2F;dataHost&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;dataHost name&#x3D;&quot;oracle1&quot; maxCon&#x3D;&quot;1000&quot; minCon&#x3D;&quot;1&quot; balance&#x3D;&quot;0&quot; writeType&#x3D;&quot;0&quot; dbType&#x3D;&quot;oracle&quot; dbDriver&#x3D;&quot;jdbc&quot;&gt; &lt;heartbeat&gt;select 1 from dual&lt;&#x2F;heartbeat&gt;</span><br><span class=\"line\">&lt;connectionInitSql&gt;alter session set nls_date_format&#x3D;&#39;yyyy-mm-dd hh24:mi:ss&#39;&lt;&#x2F;connectionInitSql&gt;</span><br><span class=\"line\">&lt;writeHost host&#x3D;&quot;hostM1&quot; url&#x3D;&quot;jdbc:oracle:thin:@127.0.0.1:1521:nange&quot; user&#x3D;&quot;base&quot; password&#x3D;&quot;123456&quot; &gt; &lt;&#x2F;writeHost&gt; &lt;&#x2F;dataHost&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;dataHost name&#x3D;&quot;jdbchost&quot; maxCon&#x3D;&quot;1000&quot; minCon&#x3D;&quot;1&quot; balance&#x3D;&quot;0&quot; writeType&#x3D;&quot;0&quot; dbType&#x3D;&quot;mongodb&quot; dbDriver&#x3D;&quot;jdbc&quot;&gt;</span><br><span class=\"line\">&lt;heartbeat&gt;select user()&lt;&#x2F;heartbeat&gt;</span><br><span class=\"line\">&lt;writeHost host&#x3D;&quot;hostM&quot; url&#x3D;&quot;mongodb:&#x2F;&#x2F;192.168.0.99&#x2F;test&quot; user&#x3D;&quot;admin&quot; password&#x3D;&quot;123456&quot; &gt;&lt;&#x2F;writeHost&gt; &lt;&#x2F;dataHost&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;dataHost name&#x3D;&quot;sparksql&quot; maxCon&#x3D;&quot;1000&quot; minCon&#x3D;&quot;1&quot; balance&#x3D;&quot;0&quot; dbType&#x3D;&quot;spark&quot; dbDriver&#x3D;&quot;jdbc&quot;&gt;</span><br><span class=\"line\">&lt;heartbeat&gt; &lt;&#x2F;heartbeat&gt;</span><br><span class=\"line\">&lt;writeHost host&#x3D;&quot;hostM1&quot; url&#x3D;&quot;jdbc:hive2:&#x2F;&#x2F;feng01:10000&quot; user&#x3D;&quot;jifeng&quot; password&#x3D;&quot;jifeng&quot;&gt;&lt;&#x2F;writeHost&gt; &lt;&#x2F;dataHost&gt; --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- &lt;dataHost name&#x3D;&quot;jdbchost&quot; maxCon&#x3D;&quot;1000&quot; minCon&#x3D;&quot;10&quot; balance&#x3D;&quot;0&quot; dbType&#x3D;&quot;mysql&quot;</span><br><span class=\"line\">dbDriver&#x3D;&quot;jdbc&quot;&gt; &lt;heartbeat&gt;select user()&lt;&#x2F;heartbeat&gt; &lt;writeHost host&#x3D;&quot;hostM1&quot;</span><br><span class=\"line\">url&#x3D;&quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&quot; user&#x3D;&quot;root&quot; password&#x3D;&quot;123456&quot;&gt; &lt;&#x2F;writeHost&gt;</span><br><span class=\"line\">&lt;&#x2F;dataHost&gt; --&gt;</span><br><span class=\"line\">&lt;&#x2F;mycat:schema&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>MyCAT 配置解析</p>\n<p>server.xml Mycat 的配置文件，设置账号、参数等<br>\n schema.xml Mycat 对应的物理数据库和数据库表的配置<br>\n rule.xml Mycat 分片（分库分表）规则</p>\n<p>一 ：wrapper.conf<br>\n–配置 jdk<br>\nwrapper.java.command=D:/Program Files/Java/jdk1.8.0_131/bin/java.exe</p>\n<p>二：server.xml</p>\n<ol>\n<li>user 标签</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;user name&#x3D;”root”&gt;  </span><br><span class=\"line\">     &lt;property name&#x3D;”password”&gt;&lt;&#x2F;property&gt;</span><br><span class=\"line\">      &lt;property name&#x3D;”schemas”&gt;TESTDB&lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;&#x2F;user&gt;</span><br></pre></td></tr></table></figure>\n<p>user 用户配置节点<br>\n–name 登录的用户名，也就是连接 Mycat 的用户名<br>\n–password 登录的密码，也就是连接 Mycat 的密码<br>\n–schemas 数据库名，这里会和 schema.xml 中的配置关联，多个用逗号分开，例如需要这个用户需要管理两个数据库 db1,db2，则配置 db1,dbs</p>\n<p>2、privileges 标签<br>\n对用户的 schema 以及表进行精细化的 DML 权限控制</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;privileges check&#x3D;”false”&gt;</span><br><span class=\"line\">&lt;&#x2F;privileges&gt;</span><br></pre></td></tr></table></figure>\n<p>–check 表示是否开启 DML 权限检查。默认是关闭。server.dtd 文件中 <!ELEMENT privileges (schema)*> 说明可以有多个 schema 的配置。<br>\n–dml 顺序说明：insert,update,select,delete</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;schema name&#x3D;”db1″ dml&#x3D;”0110″ &gt;</span><br><span class=\"line\">&lt;table name&#x3D;”tb01″ dml&#x3D;”0000″&gt;&lt;&#x2F;table&gt;</span><br><span class=\"line\">&lt;table name&#x3D;”tb02″ dml&#x3D;”1111″&gt;&lt;&#x2F;table&gt;</span><br><span class=\"line\">&lt;&#x2F;schema&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>db1 的权限是 update,select。<br>\ntb01 的权限是啥都不能干。<br>\ntb02 的权限是 insert,update,select,delete。<br>\n其他表默认是 udpate,select。</p>\n<ol start=\"2\">\n<li>system 标签</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">这个标签内嵌套的所有 property 标签都与系统配置有关。</span><br><span class=\"line\">&lt;property name&#x3D;”charset”&gt;utf8&lt;&#x2F;property&gt;</span><br><span class=\"line\">字符集</span><br><span class=\"line\">&lt;property name&#x3D;”processors”&gt;1&lt;&#x2F;property&gt;</span><br><span class=\"line\">处理线程数量，默认是cpu数量。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”processorBufferChunk”&gt;4096&lt;&#x2F;property&gt;</span><br><span class=\"line\">每次读取留的数量，默认4096。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”processorBufferPool”&gt;409600&lt;&#x2F;property&gt;</span><br><span class=\"line\">创建共享buffer需要占用的总空间大小。processorBufferChunk*processors*100。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”processorBufferPoolType”&gt;0&lt;&#x2F;property&gt;</span><br><span class=\"line\">默认为0。0表示DirectByteBufferPool，1表示ByteBufferArena。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”processorBufferLocalPercent”&gt;100&lt;&#x2F;property&gt;</span><br><span class=\"line\">二级共享buffer是processorBufferPool的百分比，这里设置的是百分比。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”sequnceHandlerType”&gt;100&lt;&#x2F;property&gt;</span><br><span class=\"line\">全局ID生成方式。(0:为本地文件方式，1:为数据库方式；2:为时间戳序列方式；3:为ZK生成ID；4:为ZK递增ID生成。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”useCompression”&gt;1&lt;&#x2F;property&gt;</span><br><span class=\"line\">是否开启mysql压缩协议。1为开启，0为关闭，默认关闭。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”packetHeaderSize”&gt;4&lt;&#x2F;property&gt;</span><br><span class=\"line\">指定 Mysql 协议中的报文头长度。默认 4。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”maxPacketSize”&gt;16M&lt;&#x2F;property&gt;</span><br><span class=\"line\">指定 Mysql 协议可以携带的数据最大长度。默认 16M。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”idleTimeout”&gt;1800000&lt;&#x2F;property&gt;</span><br><span class=\"line\">指定连接的空闲超时时间。某连接在发起空闲检查下，发现距离上次使用超过了空闲时间，那么这个连接会被回收，就是被直接的关闭掉。默认 30 分钟，单位毫秒。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”txIsolation”&gt;3&lt;&#x2F;property&gt;</span><br><span class=\"line\">前端连接的初始化事务隔离级别，只在初始化的时候使用，后续会根据客户端传递过来的属性对后端数据库连接进行同步。默认为 REPEATED_READ，设置值为数字默认 3。</span><br><span class=\"line\">READ_UNCOMMITTED &#x3D; 1;</span><br><span class=\"line\">READ_COMMITTED &#x3D; 2;</span><br><span class=\"line\">REPEATED_READ &#x3D; 3;</span><br><span class=\"line\">SERIALIZABLE &#x3D; 4;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”sqlExecuteTimeout”&gt;300&lt;&#x2F;property&gt;</span><br><span class=\"line\">SQL 执行超时的时间，Mycat 会检查连接上最后一次执行 SQL 的时间，若超过这个时间则会直接关闭这连接。默认时间为 300 秒，单位秒。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”processorCheckPeriod”&gt;1000&lt;&#x2F;property&gt;</span><br><span class=\"line\">清理 NIOProcessor 上前后端空闲、超时和关闭连接的间隔时间。默认是 1 秒，单</span><br><span class=\"line\">位毫秒。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”dataNodeIdleCheckPeriod”&gt;300000&lt;&#x2F;property&gt;</span><br><span class=\"line\">对后端连接进行空闲、超时检查的时间间隔，默认是 300 秒，单位毫秒。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”dataNodeHeartbeatPeriod”&gt;10000&lt;&#x2F;property&gt;</span><br><span class=\"line\">对后端所有读、写库发起心跳的间隔时间，默认是 10 秒，单位毫秒。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”bindIp”&gt;0.0.0.0&lt;&#x2F;property&gt;</span><br><span class=\"line\">mycat 服务监听的 IP 地址，默认值为 0.0.0.0。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”serverPort”&gt;8066&lt;&#x2F;property&gt;</span><br><span class=\"line\">定义 mycat 的使用端口，默认值为 8066。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”managerPort”&gt;9066&lt;&#x2F;property&gt;</span><br><span class=\"line\">定义 mycat 的管理端口，默认值为 9066。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”fakeMySQLVersion”&gt;5.6&lt;&#x2F;property&gt;</span><br><span class=\"line\">mycat 模拟的 mysql 版本号，默认值为 5.6 版本，如非特需，不要修改这个值，目前支持设置 5.5,5.6,5.7 版本，其他版本可能会有问题。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”useSqlStat”&gt;0&lt;&#x2F;property&gt;</span><br><span class=\"line\">是否开启实时统计。1为开启；0为关闭 。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”useGlobleTableCheck”&gt;0&lt;&#x2F;property&gt;</span><br><span class=\"line\">是否开启全局表一致性检测。1为开启；0为关闭 。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”handleDistributedTransactions”&gt;0&lt;&#x2F;property&gt;</span><br><span class=\"line\">分布式事务开关。0为不过滤分布式事务；1为过滤分布式事务；2 为不过滤分布式事务,但是记录分布式事务日志。</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property name&#x3D;”maxStringLiteralLength”&gt;65535&lt;&#x2F;property&gt;</span><br><span class=\"line\">默认是65535。 64K 用于sql解析时最大文本长度</span><br><span class=\"line\">以上举例的属性仅仅是一部分，可以配置的变量很多，具体可以查看SystemConfig这个类的属性内容。</span><br><span class=\"line\">System标签下的属性，一般是上线后，需要根据实际运行的情况，分析后调优的时候进行修改。</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>Firewall 标签<br>\n顾名思义，这个就是关于防火墙的设置，也就是在网络层对请求的地址进行限制，主要是从安全角度来保证 Mycat 不被匿名 IP 进行访问</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;firewall&gt;</span><br><span class=\"line\">&lt;whitehost&gt;</span><br><span class=\"line\">&lt;host host&#x3D;”127.0.0.1″ user&#x3D;”mycat”&#x2F;&gt;</span><br><span class=\"line\">&lt;host host&#x3D;”127.0.0.2″ user&#x3D;”mycat”&#x2F;&gt;</span><br><span class=\"line\">&lt;&#x2F;whitehost&gt;</span><br><span class=\"line\">&lt;blacklist check&#x3D;”false”&gt;</span><br><span class=\"line\">&lt;&#x2F;blacklist&gt;</span><br><span class=\"line\">&lt;&#x2F;firewall&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>设置很简单，很容易理解，只要设置了白名单，表示开启了防火墙，只有白名单的连接才可以进行连接。</p>\n<p>三：schema.xml<br>\n–schema 数据库设置，此数据库为逻辑数据库，name 与 server.xml 中 schema 对应<br>\n–dataNode 分片信息，也就是分库相关配置<br>\n–dataHost 物理数据库，真正存储数据的数据库<br>\n 1、schema 标签</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;schema name&#x3D;”TESTDB” checkSQLschema&#x3D;”false” sqlMaxLimit&#x3D;”10″&gt;</span><br><span class=\"line\">&lt;&#x2F;schema&gt;</span><br></pre></td></tr></table></figure>\n<p>schema 标签用来定义 mycat 实例中的逻辑库，mycat 可以有多个逻辑库，每个逻辑库都有自己的相关配置。可以使用 schema 标签来划分这些不同的逻辑库<br>\n如果不配置 schema 标签，所有表的配置会属于同一个默认的逻辑库。逻辑库的概念和 MySql 的 database 的概念一样，我们在查询两个不同逻辑库中的表的时候，需要切换到该逻辑库下进行查询。</p>\n<p>–name 逻辑数据库名，与 server.xml 中的 schema 对应<br>\n–checkSQLschema 数据库前缀相关设置，当该值为 true 时，例如我们执行语句 select * from TESTDB.company 。mycat 会把语句修改为 select * from company 去掉 TESTDB。<br>\n–sqlMaxLimit 当该值设置为某个数值时，每条执行的 sql 语句，如果没有加上 limit 语句，Mycat 会自动加上对应的值。不写的话，默认返回所有的值。<br>\n需要注意的是，如果运行的 schema 为非拆分库的，那么该属性不会生效。需要自己 sql 语句加 limit。<br>\n2、table 标签</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;table name&#x3D;”travelrecord” dataNode&#x3D;”dn1,dn2,dn3″ rule&#x3D;”auto-sharding-long” &#x2F;&gt;</span><br><span class=\"line\">&lt;table name&#x3D;”company” primaryKey&#x3D;”ID” type&#x3D;”global” dataNode&#x3D;”dn1,dn2,dn3″ &#x2F;&gt;</span><br></pre></td></tr></table></figure>\n<p>–name 表名，物理数据库中表名<br>\n–dataNode 表存储到哪些节点，多个节点用逗号分隔。节点为下文 dataNode 设置的 name<br>\n–primaryKey 主键字段名，自动生成主键时需要设置<br>\n–autoIncrement 是否自增<br>\n–rule 分片规则名，具体规则下文 rule 详细介绍<br>\n–type 该属性定义了逻辑表的类型，目前逻辑表只有全局表和普通表。全局表： global 普通表：无<br>\n注：全局表查询任意节点，普通表查询所有节点效率低<br>\n–autoIncrement mysql 对非自增长主键，使用 last_insert_id () 是不会返回结果的，只会返回 0. 所以，只有定义了自增长主键的表，才可以用 last_insert_id () 返回主键值。<br>\nmycat 提供了自增长主键功能，但是对应的 mysql 节点上数据表，没有 auto_increment, 那么在 mycat 层调用 last_insert_id () 也是不会返回结果的。<br>\n–needAddLimit 指定表是否需要自动的在每个语句后面加上 limit 限制，由于使用了分库分表，数据量有时候会特别庞大，这时候执行查询语句，<br>\n忘记加上 limt 就会等好久，所以 mycat 自动为我们加上了 limit 100，这个属性默认为 true，可以自己设置为 false 禁用。如果使用这个功能，最好配合使用数据库模式的全局序列。<br>\n–subTables 分表，分表目前不支持 Join。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1) childTable标签</span><br><span class=\"line\">&lt;table name&#x3D;”customer” primaryKey&#x3D;”ID” dataNode&#x3D;”dn1,dn2″ rule&#x3D;”sharding-by-intfile”&gt;</span><br><span class=\"line\">&lt;childTable name&#x3D;”c_a” primaryKey&#x3D;”ID” joinKey&#x3D;”customer_id” parentKey&#x3D;”id” &#x2F;&gt;</span><br><span class=\"line\">&lt;&#x2F;table&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>–childTable 标签用于定义 E-R 分片的子表。通过标签上的属性与父表进行关联。<br>\n–name 子表的名称<br>\n–joinKey 子表中字段的名称<br>\n–parentKey 父表中字段名称<br>\n–primaryKey 同 Table<br>\n–needAddLimit 同 Table</p>\n<p>3、dataNode 标签</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dataNode name&#x3D;”dn1″ dataHost&#x3D;”localhost1″ database&#x3D;”db1″ &#x2F;&gt; </span><br><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;  </span><br><span class=\"line\"></span><br><span class=\"line\">datanode标签定义了mycat中的数据节点，也就是我们所说的数据分片。一个datanode标签就是一个独立的数据分片。</span><br><span class=\"line\">例子中的表述的意思为，使用名字为localhost1数据库实例上的db1物理数据库，这就组成一个数据分片，最后我们用dn1来标示这个分片。  </span><br><span class=\"line\">–name 定义数据节点的名字，这个名字需要唯一。我们在table标签上用这个名字来建立表与分片对应的关系  </span><br><span class=\"line\">–dataHost 用于定义该分片属于哪个数据库实例，属性与datahost标签上定义的name对应  </span><br><span class=\"line\">–database 用于定义该分片属于数据库实例上 的具体库。  </span><br><span class=\"line\"></span><br><span class=\"line\">4、dataHost标签  </span><br><span class=\"line\">这个标签直接定义了具体数据库实例，读写分离配置和心跳语句。  </span><br></pre></td></tr></table></figure>\n<dataHost name=”localhost1″ maxCon=”1000″ minCon=”10″ balance=”0″ writeType=”0″ dbType=”mysql” dbDriver=”native” switchType=”1″ slaveThreshold=”100″>\n<heartbeat>select user()</heartbeat>\n<writeHost host=”hostM1″ url=”192.168.1.100:3306″ user=”root” password=”123456″>\n<readHost host=”hostS1″ url=”192.168.1.101:3306″ user=”root” password=”123456″ />\n</writeHost>\n</dataHost>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">–name 唯一标示dataHost标签，供上层使用  </span><br><span class=\"line\">–maxCon 指定每个读写实例连接池的最大连接  </span><br><span class=\"line\">–minCon 指定每个读写实例连接池的最小连接，初始化连接池的大小  </span><br><span class=\"line\">–balance 负载均称类型  </span><br><span class=\"line\">balance&#x3D;”0″：不开启读写分离机制，所有读操作都发送到当前可用的writeHost上  </span><br><span class=\"line\">balance&#x3D;”1″：全部的readHost与stand by writeHost参与select语句的负载均衡，简单的说，当双主双从模式（M1-S1，M2-S2 并且M1 M2互为主备），正常情况下，M2,S1,S2都参与select语句的负载均衡。</span><br><span class=\"line\">balance&#x3D;”2″：所有读操作都随机的在writeHost、readHost上分发</span><br><span class=\"line\">balance&#x3D;”3″：所有读请求随机的分发到writeHst对应的readHost执行，writeHost不负担读写压力。（1.4之后版本有）  </span><br><span class=\"line\">–writeType 负载均衡类型   </span><br><span class=\"line\">writeType&#x3D;”0″, 所有写操作发送到配置的第一个 writeHost，第一个挂了切到还生存的第二个writeHost，重新启动后已切换后的为准，切换记录在配置文件中:dnindex.properties .</span><br><span class=\"line\">writeType&#x3D;”1″，所有写操作都随机的发送到配置的 writeHost。1.5以后版本废弃不推荐。</span><br><span class=\"line\">–switchType -1不自动切换  </span><br><span class=\"line\">1 默认值 自动切换  </span><br><span class=\"line\">2 基于MySql主从同步的状态决定是否切换心跳语句为 show slave status  </span><br><span class=\"line\">3 基于mysql galary cluster 的切换机制（适合集群）  1.4.1 心跳语句为 show status like ‘wsrep%’</span><br><span class=\"line\">–dbType 指定后端链接的数据库类型目前支持二进制的mysql协议，还有其他使用jdbc链接的数据库，例如：mongodb，oracle，spark等    </span><br><span class=\"line\">–dbDriver 指定连接后段数据库使用的driver，目前可选的值有native和JDBC。使用native的话，因为这个值执行的是二进制的mysql协议，所以可以使用mysql和maridb，其他类型的则需要使用JDBC驱动来支持。  </span><br><span class=\"line\">如果使用JDBC的话需要符合JDBC4标准的驱动jar 放到mycat\\lib目录下，并检查驱动jar包中包括如下目录结构文件 META-INF\\services\\java.sql.Driver。 在这个文件写上具体的driver类名，例如com.mysql.jdbc.Driver</span><br><span class=\"line\">writeHost readHost指定后端数据库的相关配置给mycat，用于实例化后端连接池。  </span><br><span class=\"line\">–tempReadHostAvailable  </span><br><span class=\"line\">如果配置了这个属性 writeHost 下面的 readHost 仍旧可用，默认 0 可配置（0、1）。  </span><br><span class=\"line\"></span><br><span class=\"line\">1）heartbeat标签  </span><br><span class=\"line\">这个标签内指明用于和后端数据库进行心跳检查的语句。</span><br><span class=\"line\">例如：MYSQL 可以使用 select user()，Oracle 可以使用 select 1 from dual 等。  </span><br><span class=\"line\">2） writeHost &#x2F;readHost 标签  </span><br><span class=\"line\">这两个标签都指定后端数据库的相关配置，用于实例化后端连接池。唯一不同的是，writeHost 指定写实例、readHost 指定读实例。  </span><br><span class=\"line\">在一个 dataHost 内可以定义多个 writeHost 和 readHost。但是，如果 writeHost 指定的后端数据库宕机，那么这个 writeHost 绑定的所有 readHost 都将不可用。  </span><br><span class=\"line\">另一方面，由于这个 writeHost 宕机，系统会自动的检测到，并切换到备用的 writeHost 上去。这两个标签的属性相同，这里就一起介绍。  </span><br><span class=\"line\"></span><br><span class=\"line\">–host 用于标识不同实例，一般 writeHost 我们使用*M1，readHost 我们用*S1。  </span><br><span class=\"line\">–url 后端实例连接地址。Native：地址：端口 JDBC：jdbc的url  </span><br><span class=\"line\">–password 后端存储实例需要的密码  </span><br><span class=\"line\">–user 后端存储实例需要的用户名字  </span><br><span class=\"line\">–weight 权重 配置在 readhost 中作为读节点的权重  </span><br><span class=\"line\">–usingDecrypt 是否对密码加密，默认0。具体加密方法看官方文档。  </span><br><span class=\"line\">四： Rule.xml  </span><br><span class=\"line\">ule.xml 里面就定义了我们对表进行拆分所涉及到的规则定义。我们可以灵活的对表使用不同的分片算法，或者对表使用相同的算法但具体的参数不同。 包含的标签 tableRule 和 function。  </span><br><span class=\"line\"></span><br><span class=\"line\">1.tableRule 标签</span><br><span class=\"line\"></span><br><span class=\"line\">这个标签定义表规则。  </span><br><span class=\"line\">定义的表规则，在 schema.xml：  </span><br></pre></td></tr></table></figure>\n<tableRule name=”rule1″>\n<rule>\n<columns>id</columns>\n<algorithm>func1</algorithm>\n</rule>\n</tableRule>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">–name 属性指定唯一的名字，用于标识不同的表规则。 内嵌的 rule 标签则指定对物理表中的哪一列进行拆分和使用什么路由算法。  </span><br><span class=\"line\">–columns 内指定要拆分的列名字。  </span><br><span class=\"line\">–algorithm 使用 function 标签中的 name 属性。连接表规则和具体路由算法。当然，多个表规则可以连接到 同一个路由算法上。table 标签内使用。让逻辑表使用这个规则进行分片。  </span><br><span class=\"line\">2.function 标签  </span><br></pre></td></tr></table></figure>\n<function name=”hash-int” class=”org.opencloudb.route.function.PartitionByFileMap”>\n<property name=”mapFile”>partition-hash-int.txt</property>\n</function>\n```\n<p>–name 指定算法的名字。<br>\n–class 制定路由算法具体的类名字。<br>\n–property 为具体算法需要用到的一些属性</p>\n",
            "tags": [
                "mysql"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/07/13/docker-%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85-1/",
            "url": "http://www.startanew.cn/2020/07/13/docker-%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85-1/",
            "title": "docker 知识补充",
            "date_published": "2020-07-13T08:46:29.000Z",
            "content_html": "<h3 id=\"docker-给容器指定ip\"><a class=\"markdownIt-Anchor\" href=\"#docker-给容器指定ip\">#</a> docker 给容器指定 ip</h3>\n<p>查看网络模式</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker network ls</span><br></pre></td></tr></table></figure>\n<p>创建新的 bridge 网络</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker network create --driver bridge --subnet&#x3D;172.18.12.0&#x2F;16 --gateway&#x3D;172.18.1.1</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>  \n<p>启动容器时 通过–network=bridge 网络名称  –ip 指定 ip</p>\n<p>查看容器 ip</p>\n<p>docker inspect 容器名称或 id</p>\n<p>创建集群 docker 命令备份</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -it --name mysql-master -p 3308:3306 -e MYSQL_ROOT_PASSWORD&#x3D;root --privileged&#x3D;true -v E:&#x2F;mysql&#x2F;master&#x2F;conf&#x2F;my.cnf:&#x2F;etc&#x2F;mysql&#x2F;my.cnf -v E:&#x2F;mysql&#x2F;master&#x2F;data:&#x2F;var&#x2F;lib&#x2F;mysql -v E:&#x2F;mysql&#x2F;master&#x2F;logs:&#x2F;var&#x2F;log&#x2F;mysql -d --restart&#x3D;always --network&#x3D;mynet --ip 172.18.12.1 mysql:5.7</span><br><span class=\"line\">docker run -it --name mysql-master1 -p 3318:3306 -e MYSQL_ROOT_PASSWORD&#x3D;root --privileged&#x3D;true -v E:&#x2F;mysql&#x2F;master1&#x2F;conf&#x2F;my.cnf:&#x2F;etc&#x2F;mysql&#x2F;my.cnf -v E:&#x2F;mysql&#x2F;master1&#x2F;data:&#x2F;var&#x2F;lib&#x2F;mysql -v E:&#x2F;mysql&#x2F;master1&#x2F;logs:&#x2F;var&#x2F;log&#x2F;mysql -d --restart&#x3D;always --network&#x3D;mynet --ip 172.18.12.2 mysql:5.7</span><br><span class=\"line\">docker run -it --name mysql-slave -p 3309:3306 -e MYSQL_ROOT_PASSWORD&#x3D;root --privileged&#x3D;true -v E:&#x2F;mysql&#x2F;slave&#x2F;conf&#x2F;my.cnf:&#x2F;etc&#x2F;mysql&#x2F;my.cnf -v E:&#x2F;mysql&#x2F;slave&#x2F;data:&#x2F;var&#x2F;lib&#x2F;mysql -v E:&#x2F;mysql&#x2F;slave&#x2F;logs:&#x2F;var&#x2F;log&#x2F;mysql -d --restart&#x3D;always --network&#x3D;mynet --ip 172.18.12.3 mysql:5.7</span><br><span class=\"line\">docker run -it --name mysql-slave1 -p 3319:3306 -e MYSQL_ROOT_PASSWORD&#x3D;root --privileged&#x3D;true -v E:&#x2F;mysql&#x2F;slave1&#x2F;conf&#x2F;my.cnf:&#x2F;etc&#x2F;mysql&#x2F;my.cnf -v E:&#x2F;mysql&#x2F;slave1&#x2F;data:&#x2F;var&#x2F;lib&#x2F;mysql -v E:&#x2F;mysql&#x2F;slave1&#x2F;logs:&#x2F;var&#x2F;log&#x2F;mysql -d --restart&#x3D;always --network&#x3D;mynet --ip 172.18.12.4 mysql:5.7</span><br><span class=\"line\">docker run -it -p:8166:8066 --name mycat1 -p 9166:9066 -v E:&#x2F;mysql&#x2F;mycat1&#x2F;logs:&#x2F;mycat&#x2F;logs -v E:&#x2F;mysql&#x2F;mycat1&#x2F;conf:&#x2F;mycat&#x2F;conf -d --network&#x3D;mynet --ip 172.18.12.6 mycat:1.6.5</span><br><span class=\"line\">docker run -it -p:8066:8066 --name mycat -p 9066:9066 -v E:&#x2F;mysql&#x2F;mycat&#x2F;logs:&#x2F;mycat&#x2F;logs -v E:&#x2F;mysql&#x2F;mycat&#x2F;conf:&#x2F;mycat&#x2F;conf -d --network&#x3D;mynet --ip 172.18.12.5 mycat:1.6.5</span><br><span class=\"line\">docker run -d --name haproxy -p 8888:8888 -p 13306:3306 --network&#x3D;mynet --ip 172.18.12.7 -v e:&#x2F;mysql&#x2F;haproxy:&#x2F;usr&#x2F;local&#x2F;etc&#x2F;haproxy haproxy:1.9.6</span><br><span class=\"line\">docker run --name redis-6379 -p 6379:6379 --network&#x3D;mynet --ip 172.18.12.10 --privileged&#x3D;true -v E:&#x2F;mysql&#x2F;redis&#x2F;sentinel.conf:&#x2F;sentinel.conf --restart&#x3D;always -d daocloud.io&#x2F;library&#x2F;redis</span><br><span class=\"line\">docker run --name redis-6380 -p 6380:6379 --network&#x3D;mynet --ip 172.18.12.11 --privileged&#x3D;true -v E:&#x2F;mysql&#x2F;redis&#x2F;sentinel.conf:&#x2F;sentinel.conf --restart&#x3D;always -d daocloud.io&#x2F;library&#x2F;redis</span><br><span class=\"line\">docker run --name redis-6381 -p 6381:6379 --network&#x3D;mynet --ip 172.18.12.12 --privileged&#x3D;true -v E:&#x2F;mysql&#x2F;redis&#x2F;sentinel.conf:&#x2F;sentinel.conf --restart&#x3D;always -d daocloud.io&#x2F;library&#x2F;redis</span><br></pre></td></tr></table></figure>\n<p>mycat dockerfile  备份</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FROM java:8</span><br><span class=\"line\">USER root</span><br><span class=\"line\">COPY Mycat-server-1.6.5-release-20180122220033-linux.tar.gz &#x2F;</span><br><span class=\"line\">RUN tar -zxf &#x2F;Mycat-server-1.6.5-release-20180122220033-linux.tar.gz</span><br><span class=\"line\">ENV MYCAT_HOME&#x3D;&#x2F;mycat</span><br><span class=\"line\">ENV PATH&#x3D;$PATH:$&#123;MYCAT_HOME&#125;&#x2F;bin</span><br><span class=\"line\">WORKDIR $MYCAT_HOME&#x2F;bin</span><br><span class=\"line\">RUN chmod u+x .&#x2F;mycat</span><br><span class=\"line\">EXPOSE 8066 9066</span><br><span class=\"line\">CMD [&quot;.&#x2F;mycat&quot;, &quot;console&quot;]</span><br></pre></td></tr></table></figure>",
            "tags": [
                "docker"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/07/13/mysql-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/",
            "url": "http://www.startanew.cn/2020/07/13/mysql-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/",
            "title": "mysql 主从复制",
            "date_published": "2020-07-13T08:19:27.000Z",
            "content_html": "<h4 id=\"复制原理\"><a class=\"markdownIt-Anchor\" href=\"#复制原理\">#</a> 复制原理</h4>\n<ol>\n<li>Master 将数据改变记录到二进制日志 (binary log) 中，也就是配置文件 log-bin 指定的文件，这些记录叫做二进制日志事件 (binary log events)</li>\n<li>Slave 通过 I/O 线程读取 Master 中的 binary log events 并写入到它的中继日志 (relay log)</li>\n<li>Slave 重做中继日志中的事件，把中继日志中的事件信息一条一条的在本地执行一次，完成数据在本地的存储，从而实现将改变反映到它自己的数据 (数据重放)</li>\n</ol>\n<a id=\"more\"></a>\n<p>要求</p>\n<ol>\n<li>主从服务器操作系统版本和位数一致</li>\n<li>Master 和 Slave 数据库的版本要一致</li>\n<li>Master 和 Slave 数据库中的数据要一致</li>\n<li>Master 开启二进制日志，Master 和 Slave 的 server_id 在局域网内必须唯一</li>\n</ol>\n<h4 id=\"一主一从配置\"><a class=\"markdownIt-Anchor\" href=\"#一主一从配置\">#</a> 一主一从配置</h4>\n<p>进入 conf 目录中编辑 my.cnf<br>\n 主：172…18.12.1<br>\n 从：172…18.12.2</p>\n<p>主配置文件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[client] </span><br><span class=\"line\">port&#x3D;3306 </span><br><span class=\"line\">default-character-set&#x3D;utf8</span><br><span class=\"line\">[mysql] </span><br><span class=\"line\">default-character-set&#x3D;utf8</span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">character_set_server&#x3D;utf8</span><br><span class=\"line\">sql_mode&#x3D;NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class=\"line\">#配置大小写不敏感</span><br><span class=\"line\">lower_case_table_names&#x3D;1</span><br><span class=\"line\">server_id&#x3D;1 ###服务器id</span><br><span class=\"line\">log-bin&#x3D;mysql-bin ###开启日志文件</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">配置说明:# </span><br><span class=\"line\">不同步哪些数据库  </span><br><span class=\"line\">binlog-ignore-db &#x3D; mysql  </span><br><span class=\"line\">binlog-ignore-db &#x3D; test  </span><br><span class=\"line\">binlog-ignore-db &#x3D; information_schema  </span><br><span class=\"line\">#只同步哪些数据库，除此之外，其他不同步  </span><br><span class=\"line\">binlog-do-db &#x3D; order</span><br><span class=\"line\">##设置server_id，一般设置为IP,注意要唯一</span><br><span class=\"line\">server_id&#x3D;1</span><br><span class=\"line\">##复制过滤：也就是指定哪个数据库不用同步（mysql库一般不同步）</span><br><span class=\"line\">binlog-ignore-db&#x3D;mysql</span><br><span class=\"line\">##开启二进制日志功能，可以随便取，最好有含义（关键就是这里了）</span><br><span class=\"line\">log-bin&#x3D;mysql-bin</span><br><span class=\"line\">##为每个session 分配的内存，在事务过程中用来存储二进制日志的缓存</span><br><span class=\"line\">binlog_cache_size&#x3D;1M</span><br><span class=\"line\">##主从复制的格式（mixed,statement,row，默认格式是statement）</span><br><span class=\"line\">binlog_format&#x3D;mixed</span><br><span class=\"line\">##二进制日志自动删除&#x2F;过期的天数。默认值为0，表示不自动删除。</span><br><span class=\"line\">expire_logs_days&#x3D;7</span><br><span class=\"line\">##跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span><br><span class=\"line\">##如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span><br><span class=\"line\">slave_skip_errors&#x3D;1062</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>授予从机权限</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt;ALTER USER &#39;root&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;密码&#39;;</span><br><span class=\"line\">mysql&gt;flush privileges; #刷新权限</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>指定 ip</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt;CREATE USER &#39;用户名&#39;@&#39;%&#39; IDENTIFIED BY &#39;密码&#39;; #创建用户</span><br><span class=\"line\">mysql&gt;GRANT REPLICATION SLAVE ON *.* TO &#39;用户名&#39;@&#39;%&#39;; #分配REPLICATION(主从复制)权限</span><br><span class=\"line\">mysql&gt;flush privileges; #刷新权限</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>从配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port&#x3D;3306 </span><br><span class=\"line\">default-character-set&#x3D;utf8</span><br><span class=\"line\">[mysql] </span><br><span class=\"line\">default-character-set&#x3D;utf8</span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">character_set_server&#x3D;utf8</span><br><span class=\"line\">sql_mode&#x3D;NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class=\"line\">#配置大小写不敏感</span><br><span class=\"line\">lower_case_table_names&#x3D;1</span><br><span class=\"line\">server_id&#x3D;2 ###服务器id </span><br><span class=\"line\">log-bin&#x3D;mysql-bin ###开启日志文件</span><br></pre></td></tr></table></figure>\n<p>连接到主服务器</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show master status;（查询主状态信息）</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>连接从服务器</p>\n<p>同步主服务器配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">change master to master_host&#x3D;&#39;172.18.12.1&#39;,master_user&#x3D;&#39;root&#39;,master_password&#x3D;&#39;root&#39;,</span><br><span class=\"line\">master_log_file&#x3D;&#39;mysql-bin.000005&#39;,master_log_pos&#x3D;1188;</span><br></pre></td></tr></table></figure>\n<p>配置说明</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">master_host为主库IP，master_user,master_password为主库用户名和密码，master_log_file和master_log_pos就是上图的这个File和Position</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>开始同步 start slave;</p>\n<p>检查从服务器复制功能状态 SHOW SLAVE STATUS; （Slave_IO_Running 、Slave_SQL_Running 都为 Yes 说明配置成功）</p>\n<p>从机挂掉后重启后，可能会复制失败，可用执行 reset slave; 清空然后再  start slave; 重新配置主机时，需要先 stop slave; 再 change master to  …</p>\n<h4 id=\"双主双从配置\"><a class=\"markdownIt-Anchor\" href=\"#双主双从配置\">#</a> 双主双从配置</h4>\n<p>主配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[client] </span><br><span class=\"line\">port&#x3D;3306 </span><br><span class=\"line\">default-character-set&#x3D;utf8</span><br><span class=\"line\">[mysql] </span><br><span class=\"line\">default-character-set&#x3D;utf8</span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">character_set_server&#x3D;utf8</span><br><span class=\"line\">sql_mode&#x3D;NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class=\"line\">#配置大小写不敏感</span><br><span class=\"line\">lower_case_table_names&#x3D;1</span><br><span class=\"line\">server_id&#x3D;2 ###服务器id</span><br><span class=\"line\">log-bin&#x3D;mysql-bin ###开启日志文件</span><br><span class=\"line\">auto_increment_increment&#x3D;2</span><br><span class=\"line\">auto_increment_offset&#x3D;2</span><br><span class=\"line\">binlog_format&#x3D;mixed</span><br><span class=\"line\">expire_logs_days&#x3D;7</span><br><span class=\"line\">##relay_log配置中继日志</span><br><span class=\"line\">relay_log&#x3D;edu-mysql-relay-bin</span><br><span class=\"line\">##log_slave_updates表示slave将复制事件写进自己的二进制日志2</span><br><span class=\"line\">log_slave_updates&#x3D;1</span><br><span class=\"line\">##防止改变数据(除了特殊的线程) </span><br><span class=\"line\">read_only&#x3D;1</span><br><span class=\"line\">slave_skip_errors&#x3D;1062</span><br></pre></td></tr></table></figure>\n<p>在两个主机上都执行一次主从复制的步骤即可</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">主从复制语句备份</span><br><span class=\"line\"></span><br><span class=\"line\">CREATE TABLE &#96;user&#96; ( </span><br><span class=\"line\">&#96;user_id&#96; bigint(20) AUTO_INCREMENT,</span><br><span class=\"line\">&#96;username&#96; varchar(30) NOT NULL,</span><br><span class=\"line\">&#96;password&#96; varchar(30) DEFAULT NULL,</span><br><span class=\"line\">PRIMARY KEY (&#96;user_id&#96;)</span><br><span class=\"line\">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br><span class=\"line\"></span><br><span class=\"line\">grant replication slave, replication client on *.* to &#39;root&#39;@&#39;172.18.12.2&#39; identified by &#39;root&#39;;</span><br><span class=\"line\">grant replication slave, replication client on *.* to &#39;slave&#39;@&#39;172.18.12.3&#39; identified by &#39;slave&#39;;</span><br><span class=\"line\">ALTER USER &#39;root&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;root&#39;;</span><br><span class=\"line\">flush privileges;</span><br><span class=\"line\">show master status;</span><br><span class=\"line\">change master to </span><br><span class=\"line\">master_host&#x3D;&#39;172.18.12.2&#39;, </span><br><span class=\"line\">master_port&#x3D;3306, </span><br><span class=\"line\">master_user&#x3D;&#39;root&#39;,</span><br><span class=\"line\">master_password&#x3D;&#39;root&#39;,</span><br><span class=\"line\">master_log_file&#x3D;&#39;mysql-bin.000003&#39;,</span><br><span class=\"line\">master_log_pos&#x3D;588;</span><br><span class=\"line\">start slave;</span><br><span class=\"line\">stop slave;</span><br><span class=\"line\">show slave status;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>",
            "tags": [
                "mysql"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/07/13/mysql%E4%BC%98%E5%8C%96-%EF%BC%88%E4%B8%89%EF%BC%89/",
            "url": "http://www.startanew.cn/2020/07/13/mysql%E4%BC%98%E5%8C%96-%EF%BC%88%E4%B8%89%EF%BC%89/",
            "title": "mysql优化-（三）",
            "date_published": "2020-07-13T08:08:59.000Z",
            "content_html": "<h4 id=\"sql优化技巧\"><a class=\"markdownIt-Anchor\" href=\"#sql优化技巧\">#</a> SQL 优化技巧</h4>\n<ul>\n<li>使用 group by 分组查询是，默认分组后，还会排序，可能会降低速度，<br>\n在 group by 后面增加 order by null 就可以防止排序.</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">explain select * from emp  group by deptno order by null;</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<ul>\n<li>有些情况下，可以使用连接来替代子查询。因为使用 join，MySQL 不需要在内存中创建临时表。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><