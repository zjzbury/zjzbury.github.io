{
    "version": "https://jsonfeed.org/version/1",
    "title": "JAVA • All posts by \"springboot\" tag",
    "description": "爱编程，爱生活",
    "home_page_url": "http://www.startanew.cn",
    "items": [
        {
            "id": "http://www.startanew.cn/2020/12/30/%E9%9A%8F%E6%9C%BA%E7%94%9F%E6%88%90%E5%AF%86%E7%A0%81/",
            "url": "http://www.startanew.cn/2020/12/30/%E9%9A%8F%E6%9C%BA%E7%94%9F%E6%88%90%E5%AF%86%E7%A0%81/",
            "title": "随机生成密码",
            "date_published": "2020-12-30T05:10:37.000Z",
            "content_html": "<h3 id=\"java代码\"><a class=\"markdownIt-Anchor\" href=\"#java代码\">#</a> java 代码</h3>\n<p><span class=\"rainbow\">工具类</span></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RandomStringUtils</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">char</span>[] codeSequence = <span class=\"keyword\">new</span> <span class=\"keyword\">char</span>[]&#123;<span class=\"string\">&#x27;1&#x27;</span>, <span class=\"string\">&#x27;2&#x27;</span>, <span class=\"string\">&#x27;3&#x27;</span>, <span class=\"string\">&#x27;4&#x27;</span>, <span class=\"string\">&#x27;5&#x27;</span>, <span class=\"string\">&#x27;6&#x27;</span>, <span class=\"string\">&#x27;7&#x27;</span>, <span class=\"string\">&#x27;8&#x27;</span>, <span class=\"string\">&#x27;9&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;A&#x27;</span>, <span class=\"string\">&#x27;B&#x27;</span>, <span class=\"string\">&#x27;C&#x27;</span>, <span class=\"string\">&#x27;D&#x27;</span>, <span class=\"string\">&#x27;E&#x27;</span>, <span class=\"string\">&#x27;F&#x27;</span>, <span class=\"string\">&#x27;G&#x27;</span>, <span class=\"string\">&#x27;H&#x27;</span>, <span class=\"string\">&#x27;I&#x27;</span>, <span class=\"string\">&#x27;J&#x27;</span>, <span class=\"string\">&#x27;K&#x27;</span>, <span class=\"string\">&#x27;L&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;N&#x27;</span>, <span class=\"string\">&#x27;P&#x27;</span>, <span class=\"string\">&#x27;Q&#x27;</span>, <span class=\"string\">&#x27;R&#x27;</span>, <span class=\"string\">&#x27;S&#x27;</span>, <span class=\"string\">&#x27;T&#x27;</span>, <span class=\"string\">&#x27;U&#x27;</span>, <span class=\"string\">&#x27;V&#x27;</span>, <span class=\"string\">&#x27;W&#x27;</span>, <span class=\"string\">&#x27;X&#x27;</span>, <span class=\"string\">&#x27;Y&#x27;</span>, <span class=\"string\">&#x27;Z&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;c&#x27;</span>, <span class=\"string\">&#x27;d&#x27;</span>, <span class=\"string\">&#x27;e&#x27;</span>, <span class=\"string\">&#x27;f&#x27;</span>, <span class=\"string\">&#x27;g&#x27;</span>, <span class=\"string\">&#x27;h&#x27;</span>, <span class=\"string\">&#x27;i&#x27;</span>, <span class=\"string\">&#x27;j&#x27;</span>, <span class=\"string\">&#x27;k&#x27;</span>, <span class=\"string\">&#x27;l&#x27;</span>, <span class=\"string\">&#x27;m&#x27;</span>, <span class=\"string\">&#x27;n&#x27;</span>, <span class=\"string\">&#x27;p&#x27;</span>, <span class=\"string\">&#x27;q&#x27;</span>, <span class=\"string\">&#x27;r&#x27;</span>, <span class=\"string\">&#x27;s&#x27;</span>, <span class=\"string\">&#x27;t&#x27;</span>, <span class=\"string\">&#x27;u&#x27;</span>, <span class=\"string\">&#x27;v&#x27;</span>, <span class=\"string\">&#x27;w&#x27;</span>, <span class=\"string\">&#x27;x&#x27;</span>, <span class=\"string\">&#x27;y&#x27;</span>, <span class=\"string\">&#x27;z&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;.&#x27;</span>,<span class=\"string\">&#x27;$&#x27;</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取随机密码</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> digits 位数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span>  String <span class=\"title\">getCode</span><span class=\"params\">(<span class=\"keyword\">int</span>  digits)</span> </span>&#123;</span><br><span class=\"line\">        Random random = <span class=\"keyword\">new</span> Random();</span><br><span class=\"line\">        StringBuilder randomCode = <span class=\"keyword\">new</span> StringBuilder();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; digits; i++) &#123;</span><br><span class=\"line\">            randomCode.append(String.valueOf(codeSequence[random.nextInt(codeSequence.length)]));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> randomCode.toString();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>",
            "tags": [
                "springboot",
                "javaweb"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/11/12/Excel%E5%AF%BC%E5%87%BA/",
            "url": "http://www.startanew.cn/2020/11/12/Excel%E5%AF%BC%E5%87%BA/",
            "title": "Excel导出",
            "date_published": "2020-11-12T07:16:08.000Z",
            "content_html": "<h3 id=\"后端代码\"><a class=\"markdownIt-Anchor\" href=\"#后端代码\">#</a> 后端代码</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Excel 生成代码 </span></span><br><span class=\"line\"><span class=\"comment\">//   -------------------------------</span></span><br><span class=\"line\"><span class=\"comment\">// 发送到前端</span></span><br><span class=\"line\">ByteArrayOutputStream os = <span class=\"keyword\">new</span> ByteArrayOutputStream();</span><br><span class=\"line\">       ServletOutputStream sout = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">       BufferedInputStream bis = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">       BufferedOutputStream bos = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">       InputStream is = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">       <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">           wb.write(os);</span><br><span class=\"line\">           <span class=\"keyword\">byte</span>[] content = os.toByteArray();</span><br><span class=\"line\">           is = <span class=\"keyword\">new</span> ByteArrayInputStream(content);</span><br><span class=\"line\">           <span class=\"comment\">// 设置response参数，可以打开下载页面</span></span><br><span class=\"line\">           response.reset();</span><br><span class=\"line\">           response.setContentType(<span class=\"string\">&quot;application/octet-stream;charset=UTF-8&quot;</span>);</span><br><span class=\"line\">           response.setHeader(<span class=\"string\">&quot;Content-Disposition&quot;</span>, <span class=\"string\">&quot;attachment;filename=&quot;</span> + URLEncoder.encode(excelName, <span class=\"string\">&quot;utf-8&quot;</span>));</span><br><span class=\"line\">           response.setHeader(<span class=\"string\">&quot;Content-Length&quot;</span>, String.valueOf(is.available()));</span><br><span class=\"line\">           response.setCharacterEncoding(<span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">           sout = response.getOutputStream();</span><br><span class=\"line\">           bis = <span class=\"keyword\">new</span> BufferedInputStream(is);</span><br><span class=\"line\">           bos = <span class=\"keyword\">new</span> BufferedOutputStream(sout);</span><br><span class=\"line\">           <span class=\"keyword\">byte</span>[] buff = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[<span class=\"number\">2048</span>];</span><br><span class=\"line\">           <span class=\"keyword\">int</span> bytesRead;</span><br><span class=\"line\">           <span class=\"keyword\">while</span> (-<span class=\"number\">1</span> != (bytesRead = bis.read(buff, <span class=\"number\">0</span>, buff.length))) &#123;</span><br><span class=\"line\">               bos.write(buff, <span class=\"number\">0</span>, bytesRead);</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">       &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">           <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (bis != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                   bis.close();</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (bos != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                   bos.close();</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (os != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                   os.close();</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (is != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                   is.close();</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (sout != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                   sout.close();</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">           &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"前端下载\"><a class=\"markdownIt-Anchor\" href=\"#前端下载\">#</a> 前端下载</h3>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">window</span>.location.href=<span class=\"string\">&quot;下载地址&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>",
            "tags": [
                "springboot",
                "javaweb"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/10/24/Log4j2%E5%85%A5%E9%97%A8/",
            "url": "http://www.startanew.cn/2020/10/24/Log4j2%E5%85%A5%E9%97%A8/",
            "title": "Log4j2入门",
            "date_published": "2020-10-24T14:34:58.000Z",
            "content_html": "<h3 id=\"添加依赖\"><a class=\"markdownIt-Anchor\" href=\"#添加依赖\">#</a> 添加依赖</h3>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- Log4j2 门面API--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.11.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- Log4j2 日志实现 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.11.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"java代码\"><a class=\"markdownIt-Anchor\" href=\"#java代码\">#</a> JAVA 代码</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Log4j2Test</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger LOGGER = LogManager.getLogger(Log4j2Test.class);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testQuick</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">                LOGGER.fatal(<span class=\"string\">&quot;fatal&quot;</span>);</span><br><span class=\"line\">                LOGGER.error(<span class=\"string\">&quot;error&quot;</span>);</span><br><span class=\"line\">                LOGGER.warn(<span class=\"string\">&quot;warn&quot;</span>);</span><br><span class=\"line\">                LOGGER.info(<span class=\"string\">&quot;info&quot;</span>);</span><br><span class=\"line\">                LOGGER.debug(<span class=\"string\">&quot;debug&quot;</span>);</span><br><span class=\"line\">                LOGGER.trace(<span class=\"string\">&quot;trace&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"使用slf4j作为日志的门面使用log4j2作为日志的实现\"><a class=\"markdownIt-Anchor\" href=\"#使用slf4j作为日志的门面使用log4j2作为日志的实现\">#</a> 使用 slf4j 作为日志的门面，使用 log4j2 作为日志的实现</h3>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- Log4j2 门面API--&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.apache.logging.log4j&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;log4j-api&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;2.11.1&lt;&#x2F;version&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br><span class=\"line\">&lt;!-- Log4j2 日志实现 --&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.apache.logging.log4j&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;log4j-core&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;2.11.1&lt;&#x2F;version&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br><span class=\"line\">&lt;!--使用slf4j作为日志的门面,使用log4j2来记录日志 --&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.slf4j&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;slf4j-api&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;1.7.25&lt;&#x2F;version&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br><span class=\"line\">&lt;!--为slf4j绑定日志实现 log4j2的适配器 --&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.apache.logging.log4j&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;log4j-slf4j-impl&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;2.10.0&lt;&#x2F;version&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"log4j2配置\"><a class=\"markdownIt-Anchor\" href=\"#log4j2配置\">#</a> Log4j2 配置</h3>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class=\"line\">&lt;!--</span><br><span class=\"line\">    status&#x3D;&quot;warn&quot; 日志框架本身的输出日志级别</span><br><span class=\"line\">    monitorInterval&#x3D;&quot;5&quot; 自动加载配置文件的间隔时间，不低于 5 秒</span><br><span class=\"line\">--&gt;</span><br><span class=\"line\">&lt;Configuration status&#x3D;&quot;debug&quot; monitorInterval&#x3D;&quot;5&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!--</span><br><span class=\"line\">        集中配置属性进行管理</span><br><span class=\"line\">        使用时通过:$&#123;name&#125;</span><br><span class=\"line\">    --&gt;</span><br><span class=\"line\">    &lt;properties&gt;</span><br><span class=\"line\">        &lt;property name&#x3D;&quot;LOG_HOME&quot;&gt;&#x2F;logs&lt;&#x2F;property&gt;</span><br><span class=\"line\">    &lt;&#x2F;properties&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!--日志处理--&gt;</span><br><span class=\"line\">    &lt;Appenders&gt;</span><br><span class=\"line\">        &lt;!--控制台输出 appender--&gt;</span><br><span class=\"line\">        &lt;Console name&#x3D;&quot;Console&quot; target&#x3D;&quot;SYSTEM_ERR&quot;&gt;</span><br><span class=\"line\">            &lt;PatternLayout pattern&#x3D;&quot;%d&#123;HH:mm:ss.SSS&#125; [%t] [%-5level] %c&#123;36&#125;:%L --- %m%n&quot; &#x2F;&gt;</span><br><span class=\"line\">        &lt;&#x2F;Console&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!--日志文件输出 appender--&gt;</span><br><span class=\"line\">        &lt;File name&#x3D;&quot;file&quot; fileName&#x3D;&quot;$&#123;LOG_HOME&#125;&#x2F;myfile.log&quot;&gt;</span><br><span class=\"line\">            &lt;PatternLayout pattern&#x3D;&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l %c&#123;36&#125; - %m%n&quot; &#x2F;&gt;</span><br><span class=\"line\">        &lt;&#x2F;File&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!--&lt;Async name&#x3D;&quot;Async&quot;&gt;--&gt;</span><br><span class=\"line\">            &lt;!--&lt;AppenderRef ref&#x3D;&quot;file&quot;&#x2F;&gt;--&gt;</span><br><span class=\"line\">        &lt;!--&lt;&#x2F;Async&gt;--&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!--使用随机读写刘的日志文件输出 appender，性能提高--&gt;</span><br><span class=\"line\">        &lt;RandomAccessFile name&#x3D;&quot;accessFile&quot; fileName&#x3D;&quot;$&#123;LOG_HOME&#125;&#x2F;myAcclog.log&quot;&gt;</span><br><span class=\"line\">            &lt;PatternLayout pattern&#x3D;&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l %c&#123;36&#125; - %m%n&quot; &#x2F;&gt;</span><br><span class=\"line\">        &lt;&#x2F;RandomAccessFile&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!--按照一定规则拆分的日志文件的 appender--&gt;</span><br><span class=\"line\">        &lt;RollingFile name&#x3D;&quot;rollingFile&quot; fileName&#x3D;&quot;$&#123;LOG_HOME&#125;&#x2F;myrollog.log&quot;</span><br><span class=\"line\">                     filePattern&#x3D;&quot;&#x2F;logs&#x2F;$$&#123;date:yyyy-MM-dd&#125;&#x2F;myrollog-%d&#123;yyyy-MM-dd-HH-mm&#125;-%i.log&quot;&gt;</span><br><span class=\"line\">            &lt;!--日志级别过滤器--&gt;</span><br><span class=\"line\">            &lt;ThresholdFilter level&#x3D;&quot;debug&quot; onMatch&#x3D;&quot;ACCEPT&quot; onMismatch&#x3D;&quot;DENY&quot; &#x2F;&gt;</span><br><span class=\"line\">            &lt;!--日志消息格式--&gt;</span><br><span class=\"line\">            &lt;PatternLayout pattern&#x3D;&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l %c&#123;36&#125; - %msg%n&quot; &#x2F;&gt;</span><br><span class=\"line\">            &lt;Policies&gt;</span><br><span class=\"line\">                &lt;!--在系统启动时，出发拆分规则，生产一个新的日志文件--&gt;</span><br><span class=\"line\">                &lt;OnStartupTriggeringPolicy &#x2F;&gt;</span><br><span class=\"line\">                &lt;!--按照文件大小拆分，10MB --&gt;</span><br><span class=\"line\">                &lt;SizeBasedTriggeringPolicy size&#x3D;&quot;10 MB&quot; &#x2F;&gt;</span><br><span class=\"line\">                &lt;!--按照时间节点拆分，规则根据filePattern定义的--&gt;</span><br><span class=\"line\">                &lt;TimeBasedTriggeringPolicy &#x2F;&gt;</span><br><span class=\"line\">            &lt;&#x2F;Policies&gt;</span><br><span class=\"line\">            &lt;!--在同一个目录下，文件的个数限定为 30 个，超过进行覆盖--&gt;</span><br><span class=\"line\">            &lt;DefaultRolloverStrategy max&#x3D;&quot;30&quot; &#x2F;&gt;</span><br><span class=\"line\">        &lt;&#x2F;RollingFile&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;&#x2F;Appenders&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!--logger 定义--&gt;</span><br><span class=\"line\">    &lt;Loggers&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!--自定义异步 logger 对象</span><br><span class=\"line\">            includeLocation&#x3D;&quot;false&quot; 关闭日志记录的行号信息</span><br><span class=\"line\">            additivity&#x3D;&quot;false&quot; 不在继承 rootlogger 对象</span><br><span class=\"line\">        --&gt;</span><br><span class=\"line\">        &lt;AsyncLogger name&#x3D;&quot;cn.startanew&quot; level&#x3D;&quot;trace&quot; includeLocation&#x3D;&quot;false&quot; additivity&#x3D;&quot;false&quot;&gt;</span><br><span class=\"line\">            &lt;AppenderRef ref&#x3D;&quot;Console&quot;&#x2F;&gt;</span><br><span class=\"line\">        &lt;&#x2F;AsyncLogger&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!--使用 rootLogger 配置 日志级别 level&#x3D;&quot;trace&quot;--&gt;</span><br><span class=\"line\">        &lt;Root level&#x3D;&quot;trace&quot;&gt;</span><br><span class=\"line\">            &lt;!--指定日志使用的处理器--&gt;</span><br><span class=\"line\">            &lt;AppenderRef ref&#x3D;&quot;Console&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">            &lt;!--使用异步 appender--&gt;</span><br><span class=\"line\">            &lt;AppenderRef ref&#x3D;&quot;Async&quot; &#x2F;&gt;</span><br><span class=\"line\">        &lt;&#x2F;Root&gt;</span><br><span class=\"line\">    &lt;&#x2F;Loggers&gt;</span><br><span class=\"line\">&lt;&#x2F;Configuration&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"log4j2异步日志\"><a class=\"markdownIt-Anchor\" href=\"#log4j2异步日志\">#</a> Log4j2 异步日志</h3>\n<p><code>配置异步日志需要添加依赖</code></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--异步日志依赖--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lmax<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>disruptor<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.3.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><code> AsyncAppender方式</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Appenders&gt;</span><br><span class=\"line\">    &lt;!--控制台输出 appender--&gt;</span><br><span class=\"line\">    &lt;Console name&#x3D;&quot;Console&quot; target&#x3D;&quot;SYSTEM_ERR&quot;&gt;</span><br><span class=\"line\">        &lt;PatternLayout pattern&#x3D;&quot;%d&#123;HH:mm:ss.SSS&#125; [%t] [%-5level] %c&#123;36&#125;:%L --- %m%n&quot; &#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;Console&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!--日志文件输出 appender--&gt;</span><br><span class=\"line\">    &lt;File name&#x3D;&quot;file&quot; fileName&#x3D;&quot;$&#123;LOG_HOME&#125;&#x2F;myfile.log&quot;&gt;</span><br><span class=\"line\">        &lt;PatternLayout pattern&#x3D;&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l %c&#123;36&#125; - %m%n&quot; &#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;File&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;Async name&#x3D;&quot;Async&quot;&gt;</span><br><span class=\"line\">        &lt;AppenderRef ref&#x3D;&quot;file&quot;&#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;Async&gt;</span><br><span class=\"line\">&lt;&#x2F;Appenders&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"> &lt;Loggers&gt;</span><br><span class=\"line\">        &lt;!--自定义异步 logger 对象</span><br><span class=\"line\">            includeLocation&#x3D;&quot;false&quot; 关闭日志记录的行号信息</span><br><span class=\"line\">            additivity&#x3D;&quot;false&quot; 不在继承 rootlogger 对象</span><br><span class=\"line\">        --&gt;</span><br><span class=\"line\">        &lt;AsyncLogger name&#x3D;&quot;cn.startanew&quot; level&#x3D;&quot;trace&quot; includeLocation&#x3D;&quot;false&quot; additivity&#x3D;&quot;false&quot;&gt;</span><br><span class=\"line\">            &lt;AppenderRef ref&#x3D;&quot;Console&quot;&#x2F;&gt;</span><br><span class=\"line\">        &lt;&#x2F;AsyncLogger&gt;</span><br><span class=\"line\">    &lt;&#x2F;Loggers&gt;</span><br></pre></td></tr></table></figure>\n<p><code>AsyncLogger方式</code></p>\n<ol>\n<li>全局异步<br>\n <code>添加一个log4j2.component.properties 配置</code></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Log4jContextSelector=org.apache.logging.log4j.core.async.AsyncLoggerContextSelecto</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>混合异步</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!--日志处理--&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">Appenders</span>&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--日志文件输出 appender--&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">File</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;file&quot;</span> <span class=\"attr\">fileName</span>=<span class=\"string\">&quot;$&#123;LOG_HOME&#125;/myfile.log&quot;</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">PatternLayout</span> <span class=\"attr\">pattern</span>=<span class=\"string\">&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l %c&#123;36&#125; - %m%n&quot;</span> /&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">File</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">Async</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Async&quot;</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;file&quot;</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">Async</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">Appenders</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--logger 定义--&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">Loggers</span>&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--自定义异步 logger 对象</span></span><br><span class=\"line\"><span class=\"comment\">          includeLocation=&quot;false&quot; 关闭日志记录的行号信息</span></span><br><span class=\"line\"><span class=\"comment\">          additivity=&quot;false&quot; 不在继承 rootlogger 对象</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">AsyncLogger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;cn.startanew&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;trace&quot;</span> <span class=\"attr\">includeLocation</span>=<span class=\"string\">&quot;false&quot;</span> <span class=\"attr\">additivity</span>=<span class=\"string\">&quot;false&quot;</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;Console&quot;</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">AsyncLogger</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--使用 rootLogger 配置 日志级别 level=&quot;trace&quot;--&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">Root</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;trace&quot;</span>&gt;</span></span><br><span class=\"line\">          <span class=\"comment\">&lt;!--指定日志使用的处理器--&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;Console&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">&lt;!--使用异步 appender--&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;Async&quot;</span> /&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">Root</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">Loggers</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"spring-boot-使用log4j2\"><a class=\"markdownIt-Anchor\" href=\"#spring-boot-使用log4j2\">#</a> spring  boot  使用 log4j2</h3>\n<p>项目地址:<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3pqemJ1cnkvbG9nNGotbGVhcm4uZ2l0\">https://github.com/zjzbury/log4j-learn.git</span></p>\n",
            "tags": [
                "springboot",
                "javaweb"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/10/16/springboot-%E9%9B%86%E6%88%90redis%E7%BC%93%E5%AD%98/",
            "url": "http://www.startanew.cn/2020/10/16/springboot-%E9%9B%86%E6%88%90redis%E7%BC%93%E5%AD%98/",
            "title": "springboot 集成redis缓存",
            "date_published": "2020-10-16T08:34:02.000Z",
            "content_html": "<h3 id=\"pom文件\"><a class=\"markdownIt-Anchor\" href=\"#pom文件\">#</a> pom 文件</h3>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-boot-starter-cache&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"yml配置\"><a class=\"markdownIt-Anchor\" href=\"#yml配置\">#</a> yml 配置</h3>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">spring:</span><br><span class=\"line\">  redis:</span><br><span class=\"line\">    database: 0</span><br><span class=\"line\">    host: localhost</span><br><span class=\"line\">    port: 6379</span><br><span class=\"line\">    jedis:</span><br><span class=\"line\">      pool:</span><br><span class=\"line\">        max-active: 8</span><br><span class=\"line\">        max-wait: 1ms</span><br><span class=\"line\">        max-idle: 8</span><br><span class=\"line\">        min-idle: 0</span><br><span class=\"line\">    timeout: 5000</span><br><span class=\"line\">  cache:</span><br><span class=\"line\">    type: redis</span><br></pre></td></tr></table></figure>\n<h3 id=\"redisconfig-配置\"><a class=\"markdownIt-Anchor\" href=\"#redisconfig-配置\">#</a> redisConfig 配置</h3>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Configuration</span><br><span class=\"line\">public class RedisConfig  extends CachingConfigurerSupport &#123;</span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public CacheManager cacheManager(RedisConnectionFactory factory) &#123;</span><br><span class=\"line\">        &#x2F;&#x2F;对象的序列化</span><br><span class=\"line\">        RedisSerializationContext.SerializationPair valueSerializationPair</span><br><span class=\"line\">                &#x3D; RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer());</span><br><span class=\"line\">        &#x2F;&#x2F;全局redis缓存过期时间</span><br><span class=\"line\">        RedisCacheConfiguration redisCacheConfiguration &#x3D; RedisCacheConfiguration.defaultCacheConfig()</span><br><span class=\"line\">                .serializeValuesWith(valueSerializationPair);</span><br><span class=\"line\"></span><br><span class=\"line\">        Set&lt;String&gt; cacheNames &#x3D; new HashSet&lt;&gt;();</span><br><span class=\"line\">        cacheNames.add(&quot;testCache&quot;);</span><br><span class=\"line\">        cacheNames.add(&quot;testCache2&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">        ConcurrentHashMap&lt;String, RedisCacheConfiguration&gt; configMap &#x3D; new ConcurrentHashMap&lt;&gt;();</span><br><span class=\"line\">        configMap.put(&quot;testCache&quot;, redisCacheConfiguration.entryTtl(Duration.ofSeconds(30)));&#x2F;&#x2F;有效期30秒</span><br><span class=\"line\">        configMap.put(&quot;testCache2&quot;, redisCacheConfiguration);&#x2F;&#x2F;永久</span><br><span class=\"line\">        return RedisCacheManager.builder(factory).initialCacheNames(cacheNames).withInitialCacheConfigurations(configMap).build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    private Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer() &#123;</span><br><span class=\"line\">        Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer &#x3D; new Jackson2JsonRedisSerializer&lt;&gt;(Object.class);</span><br><span class=\"line\">        jackson2JsonRedisSerializer.setObjectMapper(objectMapper());</span><br><span class=\"line\">        return jackson2JsonRedisSerializer;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    private ObjectMapper objectMapper() &#123;</span><br><span class=\"line\">        ObjectMapper objectMapper &#x3D; new ObjectMapper();</span><br><span class=\"line\">        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class=\"line\">        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class=\"line\">        return objectMapper;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    @Bean   &#x2F;&#x2F;在没有指定缓存Key的情况下，key生成策略</span><br><span class=\"line\">    public KeyGenerator keyGenerator() &#123;</span><br><span class=\"line\">        return new KeyGenerator() &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public Object generate(Object target, Method method, Object... params) &#123;</span><br><span class=\"line\">                StringBuilder sb &#x3D; new StringBuilder();</span><br><span class=\"line\">                sb.append(target.getClass().getName());</span><br><span class=\"line\">                sb.append(&quot;#&quot; + method.getName());</span><br><span class=\"line\">                for (Object obj : params) &#123;</span><br><span class=\"line\">                    sb.append(obj.toString());</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                return sb.toString();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"service层用法\"><a class=\"markdownIt-Anchor\" href=\"#service层用法\">#</a> service 层用法</h3>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Service</span><br><span class=\"line\">@CacheConfig(cacheNames &#x3D; &quot;testCache&quot;)</span><br><span class=\"line\">public class CachingServiceImpl  implements CachingService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    @Cacheable(key &#x3D; &quot;#i&quot;)  </span><br><span class=\"line\">    public int getId(int i) &#123;</span><br><span class=\"line\">        System.out.println(&quot;执行 getId  i &#x3D; &quot; + i);</span><br><span class=\"line\">        return i*1000;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    @CachePut(key &#x3D; &quot;#i&quot;)</span><br><span class=\"line\">    public int update(int i) &#123;</span><br><span class=\"line\">        System.out.println(&quot;执行  update  i &#x3D; &quot; + i);</span><br><span class=\"line\">        return i*3000;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    @CacheEvict(key &#x3D; &quot;#i&quot;)</span><br><span class=\"line\">    public int delete(int i) &#123;</span><br><span class=\"line\">        return i;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>",
            "tags": [
                "springboot",
                "javaweb"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/07/14/%E8%A7%A3%E5%86%B3SpringBoot%E9%9B%86%E6%88%90WebSocket%E6%89%93%E5%8C%85%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98/",
            "url": "http://www.startanew.cn/2020/07/14/%E8%A7%A3%E5%86%B3SpringBoot%E9%9B%86%E6%88%90WebSocket%E6%89%93%E5%8C%85%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98/",
            "title": "解决SpringBoot集成WebSocket打包失败问题",
            "date_published": "2020-07-14T01:00:22.000Z",
            "content_html": "<h5 id=\"第一种\"><a class=\"markdownIt-Anchor\" href=\"#第一种\">#</a> 第一种:</h5>\n<ul>\n<li>\n<p>在打包时使用 mvn clean package -DskipTests 就可以完美打包，运行.</p>\n</li>\n<li>\n<p>这种每次打包时都需要输入命令，比较繁琐，个人倾向第二种，在 pom 中添加配置即可</p>\n</li>\n</ul>\n<a id=\"more\"></a>\n<h5 id=\"第二种\"><a class=\"markdownIt-Anchor\" href=\"#第二种\">#</a> 第二种:</h5>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">在pom文件的&lt;bulid&gt;的&lt;plugins&gt;中加入如下配置,即可直接package成功</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;plugin&gt;</span><br><span class=\"line\">   &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">   &lt;artifactId&gt;maven-surefire-plugin&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">   &lt;configuration&gt;</span><br><span class=\"line\">   &lt;skip&gt;true&lt;&#x2F;skip&gt;</span><br><span class=\"line\">   &lt;&#x2F;configuration&gt;</span><br><span class=\"line\">&lt;&#x2F;plugin&gt;</span><br></pre></td></tr></table></figure>",
            "tags": [
                "springboot",
                "javaweb"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/07/14/jwt%E7%A7%81%E9%92%A5%E7%94%9F%E6%88%90/",
            "url": "http://www.startanew.cn/2020/07/14/jwt%E7%A7%81%E9%92%A5%E7%94%9F%E6%88%90/",
            "title": "jwt私钥生成",
            "date_published": "2020-07-14T00:41:17.000Z",
            "content_html": "<ul>\n<li>第一步：生成私钥，这里我们指定私钥的长度为 2048</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl genrsa -out rsa_private_key.pem 2048</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>  \n<ul>\n<li>第二步：根据私钥生成对应的公钥：下面两个都可以</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1: openssl rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem</span><br><span class=\"line\">2: openssl rsa -in rsa_private_key.pem -pubout -out rsa_public_key_2048.pub </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul>\n<li>第三步：私钥转化成 pkcs8 格式，尖括号的意思是：将转化好的私钥写到 rsa_private_key_pkcs8.pem 文件里</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl pkcs8 -topk8 -inform PEM -in rsa_private_key.pem -outform PEM -nocrypt &gt; rsa_private_key_pkcs8.pem</span><br></pre></td></tr></table></figure>\n<p>链接 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC9kMWJkMWRiYTIzYTM=\">https://www.jianshu.com/p/d1bd1dba23a3</span></p>\n",
            "tags": [
                "springboot"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/07/13/ssm-%E9%9B%86%E6%88%90-websocket/",
            "url": "http://www.startanew.cn/2020/07/13/ssm-%E9%9B%86%E6%88%90-websocket/",
            "title": "ssm 集成 websocket",
            "date_published": "2020-07-13T06:50:00.000Z",
            "content_html": "<h3 id=\"添加架包\"><a class=\"markdownIt-Anchor\" href=\"#添加架包\">#</a> 添加架包</h3>\n<blockquote>\n<p>在 pom 文件中添加一下坐标</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> &lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-websocket&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;$&#123;spring.version&#125;&lt;&#x2F;version&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-messaging&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;$&#123;spring.version&#125;&lt;&#x2F;version&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;jackson-core&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;2.9.5&lt;&#x2F;version&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;jackson-databind&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;2.9.5&lt;&#x2F;version&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;jackson-annotations&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;2.9.5&lt;&#x2F;version&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.fasterxml.jackson.module&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;jackson-module-jaxb-annotations&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;2.9.5&lt;&#x2F;version&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a> \n<blockquote>\n<p>编写 config 类</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.yuyun.elevator.controller.websocket;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.WebSocketHandler;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.config.annotation.EnableWebSocket;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.config.annotation.WebSocketConfigurer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.config.annotation.WebSocketHandlerRegistry;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.handler.TextWebSocketHandler;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.server.support.HttpSessionHandshakeInterceptor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableWebMvc</span></span><br><span class=\"line\"><span class=\"meta\">@EnableWebSocket</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WebSocketConfig</span> <span class=\"keyword\">extends</span> <span class=\"title\">WebMvcConfigurationSupport</span> <span class=\"keyword\">implements</span> <span class=\"title\">WebSocketConfigurer</span> </span>&#123;</span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">registerWebSocketHandlers</span><span class=\"params\">(WebSocketHandlerRegistry webSocketHandlerRegistry)</span> </span>&#123;</span><br><span class=\"line\">webSocketHandlerRegistry.addHandler(webSocketHandler(), <span class=\"string\">&quot;/websocket&quot;</span>).addInterceptors(<span class=\"keyword\">new</span> HttpSessionHandshakeInterceptor()).setAllowedOrigins(<span class=\"string\">&quot;*&quot;</span>);</span><br><span class=\"line\">webSocketHandlerRegistry.addHandler(webSocketHandler(), <span class=\"string\">&quot;/sockjs&quot;</span>).addInterceptors(<span class=\"keyword\">new</span> HttpSessionHandshakeInterceptor()).withSockJS();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> TextWebSocketHandler <span class=\"title\">webSocketHandler</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">SpringWebSocketHandler springWebSocketHandler = <span class=\"keyword\">new</span> SpringWebSocketHandler();</span><br><span class=\"line\"><span class=\"keyword\">return</span> springWebSocketHandler;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">编写SpringWebSocketHandler</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.yuyun.elevator.controller.websocket;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.handler.TextWebSocketHandler;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpringWebSocketHandler</span> <span class=\"keyword\">extends</span> <span class=\"title\">TextWebSocketHandler</span> </span>&#123;</span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterConnectionEstablished</span><span class=\"params\">(WebSocketSession session)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;连接成功!&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">super</span>.afterConnectionEstablished(session);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">handleMessage</span><span class=\"params\">(WebSocketSession session, WebSocketMessage&lt;?&gt; message)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">session.sendMessage(message);</span><br><span class=\"line\"><span class=\"keyword\">super</span>.handleMessage(session, message);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">handleTextMessage</span><span class=\"params\">(WebSocketSession session, TextMessage message)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\"><span class=\"keyword\">super</span>.handleTextMessage(session, message);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>注意:spring 默认会给一个 OriginHandshakeInterceptor 的拦截器</p>\n</blockquote>\n<blockquote>\n<p>解决办法</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">（setAllowedOrigins(“*”)）</span><br><span class=\"line\">webSocketHandlerRegistry.addHandler(webSocketHandler(), “/websocket”).addInterceptors(<span class=\"keyword\">new</span> HttpSessionHandshakeInterceptor()).setAllowedOrigins(“*”);</span><br></pre></td></tr></table></figure>",
            "tags": [
                "springboot"
            ]
        },
        {
            "id": "http://www.startanew.cn/2020/07/13/SpringBoot-%E9%9B%86%E6%88%90Websocket%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%EF%BC%88%E4%B8%80%EF%BC%89/",
            "url": "http://www.startanew.cn/2020/07/13/SpringBoot-%E9%9B%86%E6%88%90Websocket%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%EF%BC%88%E4%B8%80%EF%BC%89/",
            "title": "SpringBoot 集成Websocket问题解决（一）",
            "date_published": "2020-07-13T06:41:00.000Z",
            "content_html": "<h3 id=\"一-spring-boot-打包war包时-websocket报错问题\"><a class=\"markdownIt-Anchor\" href=\"#一-spring-boot-打包war包时-websocket报错问题\">#</a> 一 Spring boot  打包 war 包时   websocket 报错问题</h3>\n<blockquote>\n<p>错误信息:’serverEndpointExporter’ defined in class path resource [red/bury/rtc/WebSocketConfig.class]: Invocation of init method failed;</p>\n</blockquote>\n<blockquote>\n<p>解决办法：当使用外部 Tomcat 时，需要注释掉一下代码，即可正常启动</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Bean</span><br><span class=\"line\">public ServerEndpointExporter serverEndpointExporter() &#123;</span><br><span class=\"line\">    return new ServerEndpointExporter();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a> \n<p>pom 配置如下:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class=\"line\">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class=\"line\">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 https:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class=\"line\">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class=\"line\">    &lt;parent&gt;</span><br><span class=\"line\">        &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">        &lt;version&gt;2.2.2.RELEASE&lt;&#x2F;version&gt;</span><br><span class=\"line\">        &lt;relativePath&#x2F;&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class=\"line\">    &lt;&#x2F;parent&gt;</span><br><span class=\"line\">    &lt;groupId&gt;red.bury&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;rtc&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class=\"line\">    &lt;packaging&gt;war&lt;&#x2F;packaging&gt;</span><br><span class=\"line\">    &lt;name&gt;rtc&lt;&#x2F;name&gt;</span><br><span class=\"line\">    &lt;description&gt;Demo project for Spring Boot&lt;&#x2F;description&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;properties&gt;</span><br><span class=\"line\">        &lt;java.version&gt;1.8&lt;&#x2F;java.version&gt;</span><br><span class=\"line\">    &lt;&#x2F;properties&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;dependencies&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">        &lt;&#x2F;dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-tomcat&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">            &lt;scope&gt;provided&lt;&#x2F;scope&gt;</span><br><span class=\"line\">        &lt;&#x2F;dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-websocket&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">        &lt;&#x2F;dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.apache.tomcat.embed&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;tomcat-embed-websocket&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;8.5.23&lt;&#x2F;version&gt;</span><br><span class=\"line\">        &lt;&#x2F;dependency&gt;</span><br><span class=\"line\">    &lt;&#x2F;dependencies&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;build&gt;</span><br><span class=\"line\">        &lt;plugins&gt;</span><br><span class=\"line\">            &lt;plugin&gt;</span><br><span class=\"line\">                &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">            &lt;&#x2F;plugin&gt;</span><br><span class=\"line\">        &lt;&#x2F;plugins&gt;</span><br><span class=\"line\">    &lt;&#x2F;build&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>",
            "tags": [
                "springboot",
                "javaweb"
            ]
        }
    ]
}